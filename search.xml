<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title><![CDATA[æ¼«è°ˆWeb--JWT]]></title>
    <url>%2Fweb%2FLP20190709A%2F</url>
    <content type="text"><![CDATA[â€œThe most amazing achievement of the computer software industry is its continuing cancellation of the steady and staggering gains made by the computer hardware industry.â€ â€”Henry Petroski å‰è¨€éšç€æŠ€æœ¯çš„å‘å±•ï¼Œåˆ†å¸ƒå¼webåº”ç”¨çš„æ™®åŠï¼Œé€šè¿‡sessionç®¡ç†ç”¨æˆ·ç™»å½•çŠ¶æ€æˆæœ¬è¶Šæ¥è¶Šé«˜ï¼Œå› æ­¤æ…¢æ…¢å‘å±•æˆä¸ºtokençš„æ–¹å¼åšç™»å½•èº«ä»½æ ¡éªŒï¼Œç„¶åŽé€šè¿‡tokenåŽ»å–redisä¸­çš„ç¼“å­˜çš„ç”¨æˆ·ä¿¡æ¯ï¼Œéšç€ä¹‹åŽjwtçš„å‡ºçŽ°ï¼Œæ ¡éªŒæ–¹å¼æ›´åŠ ç®€å•ä¾¿æ·åŒ–ï¼Œæ— éœ€é€šè¿‡redisç¼“å­˜ï¼Œè€Œæ˜¯æ‰€æœ‰æ•°æ®éƒ½ä¿å­˜åœ¨å®¢æˆ·ç«¯ï¼Œæ¯æ¬¡è¯·æ±‚éƒ½å‘å›žæœåŠ¡å™¨ï¼ŒéšåŽæœåŠ¡å™¨ç›´æŽ¥æ ¹æ®tokenå–å‡ºä¿å­˜çš„ç”¨æˆ·ä¿¡æ¯ï¼Œä»¥åŠå¯¹tokenå¯ç”¨æ€§æ ¡éªŒï¼Œå•ç‚¹ç™»å½•æ›´ä¸ºç®€å•ã€‚ è¿™ç¯‡æ–‡ç« ä¸­ä¸»è¦è®²è§£äº†å…³äºŽJSON Web Tokensï¼ˆJWTï¼‰çš„åŸºç¡€æ¦‚å¿µï¼Œä»¥åŠè§£é‡ŠJWTä¸ºä»€ä¹ˆä¼šè¢«å¹¿æ³›åº”ç”¨ã€‚JWTæ˜¯ç¡®ä¿åº”ç”¨ç¨‹åºä¿¡ä»»å’Œå®‰å…¨çš„é‡è¦éƒ¨åˆ†ï¼Œå®ƒå…è®¸ä»¥è¯¸å¦‚ç”¨æˆ·æ•°æ®ä¹‹ç±»çš„å®‰å…¨çš„æ–¹å¼å£°æ˜Žè¡¨ç¤ºã€‚ ä¸ºäº†JWTçš„å·¥ä½œåŽŸç†ï¼Œæˆ‘ä»¬å…ˆæ¥çœ‹ä¸€çœ‹å…³äºŽå®ƒçš„æŠ½è±¡å®šä¹‰ï¼š JSON Web Tokenï¼ˆJWTï¼‰æ˜¯ä¸€ç§JSONå¯¹è±¡ï¼Œåœ¨RFC 7519ä¸­å®šä¹‰ä¸ºè¡¨ç¤ºåŒæ–¹ä¹‹é—´çš„ä¸€ç»„ä¿¡æ¯çš„å®‰å…¨æ–¹å¼ï¼›å®ƒç”±å¤´éƒ¨ã€æœ‰æ•ˆè´Ÿè½½å’Œç­¾åä¸‰éƒ¨åˆ†ç»„æˆã€‚ æˆ‘ä»¬å®Œå…¨å¯ä»¥æŠŠJWTç®€å•åœ°çœ‹æˆä»…ä»…æ˜¯ç¬¦åˆä»¥ä¸‹æ ¼å¼çš„å­—ç¬¦ä¸² header.payload.signature Notes: åˆæ³•çš„JSONå¿…é¡»æ˜¯ä½¿ç”¨åŒå¼•å·çš„å­—ç¬¦ä¸² ä¸ºäº†ç†è§£JWTæ˜¯å¦‚ä½•è¢«ä½¿ç”¨çš„ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨Userï¼ˆç”¨æˆ·ï¼‰ã€Application Serverï¼ˆåº”ç”¨æœåŠ¡å™¨ï¼‰ã€Authentication Serverï¼ˆæŽˆæƒæœåŠ¡å™¨ï¼‰3ä¸ªç®€å•çš„å®žä½“åŠ ä»¥è§£é‡Šè¯´æ˜Žã€‚å…¶ä¸­Authentication Serverå°†æä¾›JWTç»™ç”¨æˆ·ï¼Œç”¨æˆ·æ‹¿åˆ°JWTåŽå°±å¯ä»¥å’Œåº”ç”¨ï¼ˆapp/websiteï¼‰å®‰å…¨åœ°é€šä¿¡ã€‚ ä¸Šå›¾ä¸­ï¼ŒUseræºå¸¦ç”¨æˆ·å/å¯†ç ç­‰å¯è¯æ˜Žèº«ä»½çš„å†…å®¹åŽ»æŽˆæƒæœåŠ¡å™¨èŽ·å–JWTä¿¡æ¯ï¼Œæ¯æ¬¡æœåŠ¡éƒ½æºå¸¦è¯¥Tokenå†…å®¹ä¸Žåº”ç”¨æœåŠ¡å™¨è¿›è¡Œäº¤äº’ï¼Œç”±åº”ç”¨æœåŠ¡å™¨æ¥éªŒè¯Tokenæ˜¯å¦æ˜¯æŽˆæƒç³»ç»Ÿå‘æ”¾çš„æœ‰æ•ˆTokenï¼Œæ¥éªŒè¯å½“å‰ä¸šåŠ¡æ˜¯å¦è¯·æ±‚æ˜¯å¦åˆæ³•ã€‚ æŽ¥ä¸‹æ¥æˆ‘ä»¬æ·±å…¥ç†è§£JWTæ˜¯å¦‚ä½•æž„é€ ä»¥åŠå¦‚ä½•éªŒè¯çš„ã€‚ ç¬¬ä¸€æ­¥ åˆ›å»ºå¤´éƒ¨ï¼ˆheaderï¼‰JWTçš„å¤´éƒ¨åŒ…å«äº†JWTè‡ªèº«çš„ç­¾åç®—æ³•ä¿¡æ¯ï¼Œå®ƒæ˜¯ä¸€ä¸ªå…·æœ‰å¦‚ä¸‹æ ¼å¼çš„JSONå¯¹è±¡ï¼š 1234&#123; "typ": "JWT", "alg": "HS256"&#125; è¿™ä¸ªJSONä¸­, typå±žæ€§è¡¨ç¤ºä»¤ç‰Œçš„ç±»åž‹ï¼ŒJWTä»¤ç‰Œç»Ÿä¸€å†™ä¸ºJWTã€‚algå±žæ€§è¡¨ç¤ºç­¾åä½¿ç”¨çš„ç®—æ³•ï¼Œé»˜è®¤ä¸ºHMAC SHA256ï¼ˆå†™ä¸ºHS256ï¼‰ ç¬¬äºŒéƒ¨ åˆ›å»ºæœ‰æ•ˆè½½è·ï¼ˆpayloadï¼‰JWTçš„æœ‰æ•ˆè½½è·å³æ˜¯JWTçš„ä¸»ä½“å†…å®¹éƒ¨åˆ†,åŒ…å«äº†éœ€è¦ä¼ é€’çš„æ•°æ®ï¼ˆè¿™äº›æ•°æ®ä¹Ÿè¢«ç§°ä¸ºJWTçš„å£°æ˜Žï¼‰ã€‚åœ¨æˆ‘ä»¬çš„ðŸŒ°ä¸­ï¼ŒJWTä¸­å­˜å‚¨äº†ç”¨æˆ·IDä¿¡æ¯ã€‚ 123&#123; "userId": "b08f86af-35da-48f2-8fab-cef3904660bd"&#125; ä¸Šé¢çš„ðŸŒ°ä¸­ï¼Œæˆ‘ä»¬çš„JWTä»…ä»…å­˜å‚¨äº†ä¸€ä¸ªä¿¡æ¯ã€‚ç„¶è€ŒJWT è§„å®šäº†7ä¸ªå®˜æ–¹å­—æ®µï¼Œä¾›é€‰ç”¨ iss (issuer)ï¼šç­¾å‘äºº exp (expiration time)ï¼šè¿‡æœŸæ—¶é—´ sub (subject)ï¼šä¸»é¢˜ aud (audience)ï¼šå—ä¼— nbf (Not Before)ï¼šç”Ÿæ•ˆæ—¶é—´ iat (Issued At)ï¼šç­¾å‘æ—¶é—´ jti (JWT ID)ï¼šç¼–å· å½“ç„¶é™¤äº†å®˜æ–¹å­—æ®µï¼Œä½ è¿˜å¯ä»¥åœ¨è¿™ä¸ªéƒ¨åˆ†å®šä¹‰ç§æœ‰å­—æ®µï¼Œè¯¸å¦‚ï¼š 12345&#123; "sub": "1234567890", "name": "John Doe", "admin": true&#125; å€¼å¾—æ³¨æ„çš„æ˜¯æœ‰æ•ˆè½½è·çš„å­˜å‚¨æ•°æ®çš„å¤§å°ä¼šå½±å“æ•´ä¸ªJWTçš„å¤§å°ï¼Œä¸€èˆ¬æ¥è¯´å¯¹JWTçš„å¤§å°æ²¡æœ‰é™åˆ¶ä½†æ˜¯è¿‡å¤§çš„JWTå¯èƒ½ä¼šå½±å“æ€§èƒ½æˆ–é€ æˆæ½œåœ¨çš„é—®é¢˜ã€‚ ç¬¬ä¸‰æ­¥ åˆ›å»ºç­¾åï¼ˆsignatureï¼‰ç­¾åæ˜¯ä¸ºäº†é˜²æ­¢æ•°æ®è¢«ç¯¡æ”¹ã€‚ JWTçš„ç­¾åä½¿ç”¨ä»¥ä¸‹ä¼ªä»£ç å®žçŽ°ï¼š 1234// signature algorithmdata = base64urlEncode( header ) + â€œ.â€ + base64urlEncode( payload )hashedData = hash( data, secret )signature = base64urlEncode( hashedData ) è¯¥ç®—æ³•æ‰€åšçš„ä½¿ç”¨base64urlEncodeå¯¹åœ¨ç¬¬ä¸€æ­¥åˆ›å»ºçš„å¤´éƒ¨å’Œç¬¬äºŒéƒ¨ä¸­çš„æœ‰æ•ˆè´Ÿè½½åˆ†åˆ«è¿›è¡Œç¼–ç å¹¶ç”¨â€.â€å·æ‹¼æŽ¥æˆå­—ç¬¦ä¸²ã€‚éšåŽä½¿ç”¨JWTå¤´ä¸­æŒ‡å®šçš„æ•£åˆ—ç®—æ³•å¯¹å­—ç¬¦ä¸²ä½¿ç”¨å¯†é’¥è¿›è¡Œæ•£åˆ—ã€‚æœ€åŽå†ä½¿ç”¨base64urlEncodeå¯¹ç”Ÿæˆçš„æ•£åˆ—æ•°æ®è¿›è¡Œç¼–ç ä»¥äº§ç”ŸJWTç­¾åã€‚ï¼ˆå¯†é’¥åªæœ‰æœåŠ¡å™¨æ‰çŸ¥é“ï¼Œä¸èƒ½æ³„éœ²ç»™ç”¨æˆ·ï¼‰ è¿™ç¯‡æ–‡ç« ä¸­ï¼Œä½¿ç”¨base64urlEncodeå¯¹headerå’Œpayloadè¿›è¡Œç¼–ç åŽå¾—åˆ°å¦‚ä¸‹ç»“æžœï¼š 1234567891011// headerbase64urlEncode(&#123; "typ": "JWT", "alg": "HS256"&#125;)eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9// payload// base64urlEncode(&#123; "userId": "b08f86af-35da-48f2-8fab-cef3904660bd"&#125;)eyJ1c2VySWQiOiJiMDhmODZhZi0zNWRhLTQ4ZjItOGZhYi1jZWYzOTA0NjYwYmQifQ ç„¶åŽå°†ç»“æžœä»£å…¥ä¸Šé¢çš„ä¼ªä»£ç ä¼šå¾—åˆ°å¦‚ä¸‹ç­¾åï¼š 12// signature-xN_h82PHVTCMA9vdoHrcZxH-x5mb11y1537t3rGzcM ç¬¬å››æ­¥ ç”ŸæˆJWTçŽ°åœ¨æˆ‘ä»¬å·²ç»åˆ›å»ºå®Œæˆäº†JWTçš„headerã€payloadã€signature3ä¸ªéƒ¨åˆ†ï¼Œé‚£ä¹ˆå†æŒ‰ç…§ header.payload.signature çš„æ ¼å¼å°†3ä¸ªéƒ¨åˆ†ç»„åˆèµ·æ¥å°±æ˜¯æ‰€è°“çš„JWTäº†ã€‚å¦‚ä¸‹å°±æ˜¯æˆ‘ä»¬ðŸŒ°ä¸­çš„JWT 12// JWTeyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJ1c2VySWQiOiJiMDhmODZhZi0zNWRhLTQ4ZjItOGZhYi1jZWYzOTA0NjYwYmQifQ.-xN_h82PHVTCMA9vdoHrcZxH-x5mb11y1537t3rGzcM åœ¨JWTå®˜æ–¹ç½‘ç«™ï¼Œä½ å¯ä»¥å°è¯•åˆ›å»ºè‡ªå·±çš„JWTã€‚ å›žåˆ°æˆ‘ä»¬çš„æ¡ˆä¾‹ï¼Œè¿™ä¸ªAuthentication Server å·²ç»åˆ›å»ºäº†ä¸€ä¸ªJWTï¼Œå¹¶ä¸”å‘ç»™äº†ç”¨æˆ·ã€‚ JWTæ˜¯æ€Žä¹ˆä¿æŠ¤æ•°æ®çš„æ³¨æ„ï¼Œè¿™é‡Œç»å¸¸ä¼šæœ‰ä¸€ä¸ªè¯¯åŒºï¼ŒJWTæœ¬èº«å’Œå®‰å…¨æ²¡å…³ç³»ï¼Œå®ƒå°±ä»…ä»…åªæ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œä½¿ç”¨å®ƒæ¥åšå®‰å…¨è¿œä¸å¦‚ç±»ä¼¼äºŽRSA2è¿™æ ·çš„éžå¯¹ç§°åŠ å¯†çš„å½¢å¼æ¥çš„å®žåœ¨ï¼Œç”±äºŽå®¢æˆ·ç«¯çš„ç¨‹åºå¯¹ç”¨æˆ·å‡ ä¹Žå®Œå…¨é€æ˜Žï¼ŒéªŒç­¾çš„è¿‡ç¨‹å¯¹äºŽä»–ä»¬æ¥è®²ä¹Ÿæ˜¯é€æ˜Žçš„ï¼Œæ‰€ä»¥å®‰å…¨æ€§è‚¯å®šä¸ä¼šé è¿™ä¸ªæ¥å®žçŽ°ï¼Œå¦‚æžœå®žåœ¨æ€•JWTçš„è¢«ç›—å–ï¼Œå¯ä»¥è€ƒè™‘åœ¨Payloadéƒ¨åˆ†åŠ å…¥ä¸€äº›å®¢æˆ·ç«¯ç‹¬æœ‰çš„éžæ•æ„Ÿä¿¡æ¯ï¼Œç”¨äºŽåœ¨æœåŠ¡ç«¯æ¥è¿›è¡Œæ ¸éªŒï¼Œæ¯”å¦‚ä½¿ç”¨MAC-Message Authentication Codeã€æˆ–è€…å…¬é’¥ä¹‹ç±»çš„ç­‰ç­‰; æˆ–è€…å¹²è„†å°±æŠŠç”Ÿæ•ˆæ—¶é—´è®¾ç½®çš„çŸ­ä¸€äº›ï¼Œä¹Ÿå¯ä»¥å‡å°‘æš´éœ²çš„é£Žé™©ã€‚ JWTçš„æ•°æ®è¢«ç¼–ç å’Œè¢«ç­¾åï¼Œä½†æ˜¯æ²¡æœ‰è¢«åŠ å¯†ã€‚ç¼–ç çš„ç›®çš„æ˜¯è½¬åŒ–æ•°æ®ç»“æž„ï¼Œç­¾åæ˜¯ä¸ºäº†æ•°æ®çš„æŽ¥æ”¶è€…éªŒè¯æ•°æ®çš„æƒå¨æ€§ã€‚æ‰€ä»¥ç¼–ç å’Œç­¾åå¹¶ä¸ä¼šä¿æŠ¤æ•°æ®çš„å®‰å…¨æ€§ã€‚è€ŒåŠ å¯†çš„ä¸»è¦ç›®çš„æ‰æ˜¯ä¸ºäº†ä¿æŠ¤æ•°æ®å®‰å…¨é˜²æ­¢æœªæŽˆæƒè®¿é—®ã€‚å¯¹äºŽè¯¦ç»†æè¿°ç¼–ç ä¸ŽåŠ å¯†çš„åŒºåˆ«ï¼Œå¯ä»¥å‚è€ƒè¿™ç¯‡æ–‡ç« ã€‚ Since JWT are signed and encoded only, and since JWT are not encrypted, JWT do not guarantee any security for sensitive data. ç”±äºŽJWTä»…ä»…è¢«ç¼–ç å’Œç­¾åè€Œæ²¡æœ‰è¢«åŠ å¯†è¿‡çš„ï¼Œæ‰€ä»¥å®ƒæ— æ³•ä¿è¯ä»»ä½•æ•æ„Ÿä¿¡æ¯çš„å®‰å…¨æ€§ã€‚ ç¬¬äº”æ­¥ éªŒè¯JWTç¬¬å››æ­¥ä¸­æˆ‘ä»¬å·²ç»çŸ¥é“JWTçš„ç­¾åç”Ÿæˆéœ€è¦ç”¨å¯†é’¥ï¼ˆsecretï¼‰ï¼Œè¿™ä¸ªå¯†é’¥åªæœ‰æŽˆæƒæœåŠ¡å™¨çŸ¥é“ã€‚åº”ä¸ŽæœåŠ¡å™¨å¼€å¯è®¤è¯å¤„ç†æ—¶ï¼Œéœ€è¦ä»ŽæŽˆæƒæœåŠ¡å™¨èŽ·å–æ­¤å¯†é’¥ã€‚æ­¤åŽå½“ç”¨æˆ·æºå¸¦JWTè®¿é—®åº”ç”¨æœåŠ¡å™¨æ—¶ï¼Œåº”ç”¨æœåŠ¡å™¨æ‹¿åˆ°JWTåŽå¯ä»¥é€šè¿‡ç±»ä¼¼ç¬¬ä¸‰æ­¥çš„æ–¹æ³•ç”Ÿæˆä¸€ä¸ªç­¾åï¼Œç„¶åŽä¸Žç”¨æˆ·æºå¸¦çš„JWTçš„ç­¾åè¿›è¡Œå¯¹æ¯”ä»Žè€ŒéªŒè¯ç”¨æˆ·JWTæ˜¯å¦æœ‰æ•ˆã€‚ ç»“æŸè¯­æœ¬æ–‡ä¸­æè¿°çš„JWTè®¤è¯è®¾ç½®ä½¿ç”¨å¯¹ç§°å¯†é’¥ç®—æ³•ï¼ˆHS256ï¼‰ã€‚æ‚¨ä¹Ÿå¯ä»¥ä½¿ç”¨éžå¯¹ç§°ç®—æ³•ï¼ˆä¾‹å¦‚RS256ï¼‰ï¼Œå³æŽˆæƒæœåŠ¡å™¨å…·æœ‰å¯†é’¥ï¼Œå¹¶ä¸”åº”ç”¨ç¨‹åºæœåŠ¡å™¨å…·æœ‰å…¬é’¥ã€‚äº†è§£ä½¿ç”¨å¯¹ç§°å’Œéžå¯¹ç§°ç®—æ³•ä¹‹é—´å·®å¼‚çš„è¯¦ç»†åˆ†ç±»ã€‚ è¿˜åº”è¯¥æ³¨æ„ï¼ŒJWTåº”è¯¥é€šè¿‡HTTPSè¿žæŽ¥ï¼ˆè€Œä¸æ˜¯HTTPï¼‰å‘é€ã€‚HTTPSæœ‰åŠ©äºŽé˜²æ­¢æœªç»æŽˆæƒçš„ç”¨æˆ·çªƒå–æ‰€å‘é€çš„JWTï¼Œä»Žè€Œæ— æ³•æ‹¦æˆªæœåŠ¡å™¨å’Œç”¨æˆ·ä¹‹é—´çš„é€šä¿¡ã€‚ åŒæ—¶ï¼ŒJWTåº”è¯¥è®¾ç½®æœ‰æ•ˆæœŸï¼Œå¹¶ä¸”æœ‰æ•ˆæœŸä¸è¦å¤ªé•¿ã€‚]]></content>
      <categories>
        <category>web</category>
      </categories>
      <tags>
        <tag>JWT</tag>
        <tag>HTTPS</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[JSè¿›é˜¶--bindå‡½æ•°]]></title>
    <url>%2Fweb%2FLP20190705A%2F</url>
    <content type="text"><![CDATA[â€œProgrammers are in a race with the Universe to create bigger and better idiot-proof programs, while the Universe is trying to create bigger and better idiots. So far the Universe is winning.â€ â€”Rich Cook å®˜æ–¹æè¿°é¦–å…ˆæˆ‘ä»¬å…ˆæ¥çœ‹çœ‹MDNä¸Šå¯¹äºŽbindå‡½æ•°çš„å®šä¹‰ï¼Œä¸»è¦æœ‰ä¸‰ä¸ªç‰¹ç‚¹: bindå‡½æ•°ä¼šåˆ›å»ºä¸€ä¸ªæ–°å‡½æ•°ï¼ˆç§°ä¸ºç»‘å®šå‡½æ•°ï¼‰ï¼Œæ–°å‡½æ•°ä¸ŽåŽŸå‡½æ•°å…·æœ‰ç›¸åŒçš„å‡½æ•°ä½“ï¼ˆåœ¨ ECMAScript 5 è§„èŒƒä¸­å†…ç½®çš„callå±žæ€§ï¼‰ å½“ç”Ÿæˆçš„æ–°å‡½æ•°è¢«è°ƒç”¨æ‰§è¡Œæ—¶ï¼Œå…¶thiså€¼å§‹ç»ˆæŒ‡å‘bindå‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°ä¸”æ— æ³•æ”¹å˜ binå‡½æ•°å¯ä»¥æŽ¥å—é¢„è®¾çš„å‚æ•°ï¼Œè¯¥å‚æ•°æœ€ç»ˆæä¾›ç»™åŽŸå‡½æ•° æ–°å‡½æ•°ä¹Ÿèƒ½ä½¿ç”¨newæ“ä½œç¬¦åˆ›å»ºå¯¹è±¡,è¿™ç§è¡Œä¸ºå°±åƒæŠŠåŽŸå‡½æ•°å½“æˆæž„é€ å™¨ã€‚æä¾›çš„ thiså€¼è¢«å¿½ç•¥ï¼ŒåŒæ—¶è°ƒç”¨æ—¶çš„å‚æ•°è¢«æä¾›ç»™æ¨¡æ‹Ÿå‡½æ•° ç”¨ä¾‹è¯´æ˜Žä¼—æ‰€å‘¨çŸ¥ï¼ŒJSä¸­å‡½æ•°(ES6ç®­å¤´å‡½æ•°é™¤å¤–)çš„thisæŒ‡å‘æ˜¯åœ¨å‡½æ•°æ‰§è¡Œæ—¶åŠ¨æ€ç»‘å®šçš„ï¼Œå‡½æ•°å®šä¹‰å’Œå®žé™…è¿è¡Œæ—¶çš„æ‰€å¤„çš„çŽ¯å¢ƒä¸ä¸€æ ·ï¼Œå¾€å¾€å¯¼è‡´æœªçŸ¥çš„bugã€‚ å°¤å…¶æ˜¯åœ¨Reactç»„ä»¶ä¸­ï¼Œç»å¸¸ä¼šç”±äºŽthisæŒ‡å‘é—®é¢˜å¯¼è‡´æ— æ³•è°ƒç”¨åˆ°å‡½æ•°ï¼Œæ‰€ä»¥é€šå¸¸æˆ‘ä»¬ä¼šåœ¨constructorå‡½æ•°ä¸­ä½¿ç”¨bindå‡½æ•°æ¥ç»‘å®šthis(å½“ç„¶ä¸€èˆ¬æˆ‘ä»¬éƒ½ä¼šä½¿ç”¨ç®­å¤´å‡½æ•°æ¥é¿å…æ­¤ç±»æƒ…å†µ)ã€‚ 123456789101112131415var name = "paopaolee"function test()&#123; console.log(this.name)&#125;var obj = &#123; name: "lepaopao", print: test,&#125;test(); // paopaoleeobj.print(); // lepaopaovar obj1 = &#123; name: 'xxxxxx', print: test.bind(this) // è¿”å›žäº†ä¸€ä¸ªæ–°å‡½æ•°å¹¶ä¸”thisæŒ‡å‘window&#125;obj1.print(); // paopaolee åŠ¨æ‰‹å®žçŽ°ç¬¬ä¸€ç‰ˆç›®æ ‡ï¼šå®žçŽ°æè¿°ä¸­çš„ç‰¹å¾1ã€2ã€3 åˆ†æžï¼šè¿”å›žçš„ç»“æžœæ˜¯ä¸€ä¸ªå‡½æ•°ï¼›æ–°å‡½æ•°è°ƒç”¨æ—¶thisæŒ‡å‘ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œ å¯ä»¥é€šè¿‡call/applyå‡½æ•°è§£å†³ï¼Œcall/applyå‡½æ•°çš„åŒºåˆ«åœ¨äºŽå‚æ•°ä¼ é€’ï¼Œå‰è€…éœ€é€ä¸€åˆ—å‡ºï¼ŒåŽè€…å¯ä»¥ä¼ é€’æ•°ç»„ï¼›bindå‡½æ•°å¯æŽ¥å—é¢„è®¾å‚æ•°æœ€ç»ˆæä¾›åŽŸå‡½æ•°ï¼Œç”±äºŽå‚æ•°ä¸ç¡®å®šï¼Œæ‰€ä»¥é€‰ç”¨applyå®žçŽ°ã€‚ å®žçŽ°ï¼š 12345678Function.prototype.paopaoleeBind = function (Othat) &#123; var slice = Array.prototype.slice; var self = this; //æ™®é€šè°ƒç”¨æ—¶ï¼Œ thisæŒ‡å‘bindè°ƒç”¨è€… var args = slice(arguments, 1); return function () &#123; self.apply(Othat, args); &#125;&#125; ç¬¬äºŒç‰ˆé—®é¢˜ï¼šç¬¬ä¸€ç‰ˆä¸­åˆæ­¥å®žçŽ°äº†å‰ä¸‰ä¸ªç‰¹å¾ï¼Œå½“ç„¶è¿˜æœ‰è¯¸å¤šé—®é¢˜ï¼Œä¾‹å¦‚å¦‚æžœæ–°å‡½æ•°æ‰§è¡Œæ—¶éœ€è¦æœ‰è¿”å›žå€¼ã€ç¬¬ä¸€ç‰ˆä¸­å®žçŽ°äº†ç»‘å®šæ—¶ä¼ å‚ï¼Œé‚£æ–°å‡½æ•°è°ƒç”¨æ—¶ä¼ å‚æ•°å‘¢ï¼Ÿä»¥åŠbindå‡½æ•°è°ƒç”¨ä¸æ­£ç¡®ç­‰ç­‰ã€‚ ä¼˜åŒ–ï¼š 1234567891011121314Function.prototype.paopaoleeBind = function (Othat) &#123; var slice = Array.prototype.slice; var toString = Array.portotype.toString; var self = this; // è§£å†³: éžæ³•è°ƒç”¨ if(typeof self !=== 'function' || toString(self) !== [object Function])&#123; throw new TypeError("incorrectly call"); &#125; var args = slice(arguments, 1); return function () &#123; // è§£å†³: æ–°å‡½æ•°æ‰§è¡Œæ—¶returnè¿”å›žå€¼ return self.apply(Othat, args.concat(slice.call(arguments))); // è§£å†³: æ–°å‡½æ•°æ‰§è¡Œå¯æŽ¥å—å‚æ•° &#125;&#125; ç¬¬ä¸‰ç‰ˆç›®æ ‡ï¼š è§£å†³bindå‡½æ•°çš„ç¬¬ä¸‰ä¸ªç‰¹å¾: ä¸€ä¸ªç»‘å®šå‡½æ•°ä¹Ÿèƒ½ä½¿ç”¨newæ“ä½œç¬¦åˆ›å»ºå¯¹è±¡ï¼šè¿™ç§è¡Œä¸ºå°±åƒæŠŠåŽŸå‡½æ•°å½“æˆæž„é€ å™¨ã€‚æä¾›çš„ this å€¼è¢«å¿½ç•¥ï¼ŒåŒæ—¶è°ƒç”¨æ—¶çš„å‚æ•°è¢«æä¾›ç»™æ¨¡æ‹Ÿå‡½æ•°ã€‚ ä¹Ÿå°±æ˜¯è¯´bindæ‰§è¡Œè¿”å›žçš„æ–°å‡½æ•°ä½œä¸ºæž„é€ å‡½æ•°æ‰§è¡Œæ—¶ï¼Œbindæ—¶æŒ‡å®šçš„å¯¹è±¡(å‚æ•°Othat)ä¼šå¤±æ•ˆï¼Œä½†æ˜¯ä¼ å…¥çš„å‚æ•°ä¾ç„¶æœ‰æ•ˆã€‚ ä¸¾ä¸ªðŸŒ°ï¼š 123456789101112131415161718var vaule = 2var obj = &#123; value: 1&#125;function female(name, age)&#123; this.favorite = 'shopping'; console.log(this.value); console.log(name, age);&#125;female.prototype.husband = 'leepaopao';var boundFunc = female.bind(obj, 'paopaolee');var p = new bindedFunc(23);// undefined// paopaolee 23consple.log(p.habit); // shoppingconsple.log(p.husband); // leepaopao å°½ç®¡åœ¨windowä»¥åŠobjä¸­éƒ½å£°æ˜Žäº†valueå€¼ï¼Œä½†æœ€ç»ˆ(this.value)ä¾ç„¶è¿”å›žäº†undefinedï¼Œè¯´æ˜Žæ­¤æ—¶thiså³ä¸æŒ‡å‘windowä¹Ÿä¸æŒ‡å‘objï¼Œbindæ—¶ç»‘å®šçš„thisï¼ˆobjï¼‰å¤±æ•ˆäº†ã€‚æ‰€ä»¥æ­¤æ—¶thisçœŸæ­£æŒ‡å‘çš„æ˜¯femaleçš„å®žä¾‹ã€‚ åˆ†æžï¼š è¦åˆ¤æ–­æ–°å‡½æ•°è°ƒç”¨æ—¶æ˜¯å¦ä¸ºnewæž„é€ å‡½æ•°è°ƒç”¨ï¼Œå¯ä»¥é€šè¿‡thisæ˜¯å¦ä¸ºæ–°å‡½æ•°çš„å®žä¾‹,æ‰€ä»¥æˆ‘ä»¬æŠŠè¿”å›žçš„åŒ¿åå‡½æ•°æ¢æˆå…·åå‡½æ•°ï¼Œä»¥ä¾¿åˆ¤æ–­ã€‚ å®žçŽ° 1234567891011121314151617Function.prototype.paopaoleeBind = function (Othat) &#123; var slice = Array.prototype.slice; var toString = Array.portotype.toString; var self = this; // è§£å†³: éžæ³•è°ƒç”¨ if(typeof self !=== 'function' || toString(self) !== [object Function])&#123; throw new TypeError("incorrectly call"); &#125; var args = slice(arguments, 1); function boundFunc() &#123; // åˆ¤æ–­thisæ˜¯å¦ä¸ºboundFuncå®žä¾‹ï¼Œå¦‚æžœæ˜¯è¯´æ˜Žæ˜¯newæž„é€ å‡½æ•°è°ƒç”¨ï¼Œå¦åˆ™æ˜¯æ™®é€šè°ƒç”¨ var Othis = this instanceof boundFunc ? this : Othat; // è§£å†³: æ–°å‡½æ•°æ‰§è¡Œæ—¶returnè¿”å›žå€¼ return self.apply(Othis, args.concat(slice.call(arguments))); // è§£å†³: æ–°å‡½æ•°æ‰§è¡Œå¯æŽ¥å—å‚æ•° &#125; return boundFunc;&#125; ç¬¬å››ç‰ˆé—®é¢˜ï¼š ç¬¬ä¸‰ç‰ˆä¸­ï¼Œæˆ‘ä»¬è§£å†³äº†bindå‡½æ•°çš„ç¬¬4ä¸ªç‰¹å¾ï¼Œä½†æ˜¯ä½¿ç”¨newæ“ä½œç¬¦åˆ›å»ºå¯¹è±¡æ—¶ï¼ŒthisæŒ‡å‘çš„æ˜¯boundFuncçš„å®žä¾‹ï¼Œæ— æ³•ç»§æ‰¿åŽŸå‡½æ•°çš„åŽŸåž‹ä¸­çš„å±žæ€§ï¼ŒåŽŸåž‹é“¾é­åˆ°ç ´åã€‚ ç›®æ ‡ï¼šé‡å¡‘åŽŸåž‹é“¾ å®žçŽ°ï¼š 123456789101112131415161718Function.prototype.paopaoleeBind = function (Othat) &#123; var slice = Array.prototype.slice; var toString = Array.portotype.toString; var self = this; // è§£å†³: éžæ³•è°ƒç”¨ if(typeof self !=== 'function' || toString(self) !== [object Function])&#123; throw new TypeError("incorrectly call"); &#125; var args = slice(arguments, 1); function boundFunc() &#123; // åˆ¤æ–­thisæ˜¯å¦ä¸ºboundFuncå®žä¾‹ï¼Œå¦‚æžœæ˜¯è¯´æ˜Žæ˜¯newæž„é€ å‡½æ•°è°ƒç”¨ï¼Œå¦åˆ™æ˜¯æ™®é€šè°ƒç”¨ var Othis = this instanceof boundFunc ? this : Othat; // è§£å†³: æ–°å‡½æ•°æ‰§è¡Œæ—¶returnè¿”å›žå€¼ return self.apply(Othis, args.concat(slice.call(arguments))); // è§£å†³: æ–°å‡½æ•°æ‰§è¡Œå¯æŽ¥å—å‚æ•° &#125; boundFunc.prototype = this.portotype; return boundFunc;&#125; ä¸Šè¿°ä»£ç ï¼Œé‡å¡‘åŽŸåž‹é“¾çš„åšæ³•æ˜¯ç›´æŽ¥å°†boundFunc.prototype = this.prototypeï¼Œç›¸å½“äºŽç›´æŽ¥ç”¨åŽŸå‡½æ•°çš„prototypeè¦†ç›–æŽ‰äº†boundFuncå‡½æ•°åŽŸæ¥çš„prototypeï¼Œè¿™æ ·å¦‚æžœæˆ‘ä»¬æ›´æ”¹boundFunc.prototypeä¸­çš„å±žæ€§æ˜¯ä¹Ÿä¼šå½±å“åŽŸå‡½æ•°çš„prototypeä¸Šçš„å±žæ€§ã€‚ æœ€ç»ˆç‰ˆ12345678910111213141516171819202122232425Function.prototype.paopaoleeBind = function (Othat) &#123; var slice = Array.prototype.slice; var toString = Array.portotype.toString; var self = this; // è§£å†³: éžæ³•è°ƒç”¨ if(typeof self !=== 'function' || toString(self) !== [object Function])&#123; throw new TypeError("incorrectly call"); &#125; var args = slice(arguments, 1); function boundFunc() &#123; // åˆ¤æ–­thisæ˜¯å¦ä¸ºboundFuncå®žä¾‹ï¼Œå¦‚æžœæ˜¯è¯´æ˜Žæ˜¯newæž„é€ å‡½æ•°è°ƒç”¨ï¼Œå¦åˆ™æ˜¯æ™®é€šè°ƒç”¨ var Othis = this instanceof boundFunc ? this : Othat; // è§£å†³: æ–°å‡½æ•°æ‰§è¡Œæ—¶returnè¿”å›žå€¼ return self.apply(Othis, args.concat(slice.call(arguments))); // è§£å†³: æ–°å‡½æ•°æ‰§è¡Œå¯æŽ¥å—å‚æ•° &#125; // é‡å¡‘åŽŸåž‹é“¾: æ–¹æ³•ä¸€ boundFunc.prototype = Object.create(this.portotype); // é‡å¡‘åŽŸåž‹é“¾: æ–¹æ³•äºŒ /**** function fNOP ()&#123;&#125; fNOP.prototype = this.prototype; fbound.prototype = new fNOP(); ****/ return boundFunc;&#125;]]></content>
      <categories>
        <category>web</category>
      </categories>
      <tags>
        <tag>JavaScript</tag>
      </tags>
  </entry>
</search>
