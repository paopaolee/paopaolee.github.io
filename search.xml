<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title><![CDATA[[è¯‘]Webè§†é¢‘æ’­æ”¾åŽŸç†ï¼šä»‹ç»]]></title>
    <url>%2Fweb%2FLP20190706A%2F</url>
    <content type="text"><![CDATA[åŽŸæ–‡: How video streaming works on the web: An introduction æ¸´æ±‚åŽŸç”Ÿè§†é¢‘APIä»Ž2000å¹´ä»£æ—©æœŸåˆ°æ™šæœŸï¼Œç½‘ç»œä¸Šçš„è§†é¢‘æ’­æ”¾ä¸»è¦ä¾èµ–äºŽFlashæ’ä»¶ã€‚è¿™æ˜¯å› ä¸ºåœ¨é‚£ä¸ªæ—¶å€™ï¼Œæµè§ˆå™¨ä¸­æ²¡æœ‰å®žçŽ°å…¶ä»–çš„è§†é¢‘æµæ’­æ”¾æ–¹æ¡ˆã€‚ç”¨æˆ·å¦‚æžœæƒ³è¦åœ¨ç½‘é¡µä¸­æ’­æ”¾è§†é¢‘ï¼Œåªèƒ½é€šè¿‡å®‰è£…ç¬¬ä¸‰æ–¹æ’ä»¶ï¼Œæ¯”å¦‚flashæˆ–è€…silverlightï¼Œæ¥æ’­æ”¾è§†é¢‘ï¼Œå¦åˆ™æ ¹æœ¬æ— æ³•è§‚çœ‹è§†é¢‘ã€‚ ä¸ºäº†å¡«å†™è¿™ä¸€ç©ºç™½ï¼Œç½‘é¡µè¶…æ–‡æœ¬åº”ç”¨æŠ€æœ¯å·¥ä½œå°ç»„ï¼ˆWHATWGï¼‰å¼€å§‹ç€æ‰‹åˆ¶è®¢æ–°ç‰ˆæœ¬çš„HTMLæ ‡å‡†ï¼Œå…¶ä¸­å°±åŒ…æ‹¬åŽŸç”Ÿè§†é¢‘å’ŒéŸ³é¢‘ï¼ˆæ— éœ€æ’ä»¶ï¼‰æ’­æ”¾ã€‚è¿™ä¸ªæ–°ç‰ˆæœ¬çš„HTMLæ ‡å‡†å°±æ˜¯å¤§å®¶ç†ŸçŸ¥çš„HTML5. äºŽæ˜¯HTML5ç»™webå¼€å‘å¸¦æ¥&lt;Video&gt;æ ‡ç­¾ï¼Œè¿™ä¸ªæ–°æ ‡ç­¾å…è®¸å¼€å‘è€…ç›´æŽ¥é€šè¿‡HTMLåŠ è½½è§†é¢‘èµ„æºï¼Œç±»ä¼¼äºŽé€šè¿‡&lt;img&gt;æ ‡ç­¾åŠ è½½å›¾ç‰‡èµ„æºã€‚è¿™ä¸ªä¸€ä¸ªå¾ˆé…·çš„äº‹æƒ…ï¼Œä½†æ˜¯ä»Žåª’ä½“ç½‘ç«™çš„è§’åº¦çœ‹æ¥ï¼Œè¿™ç§ç±»ä¼¼å›¾ç‰‡åŠ è½½çš„æ–¹å¼ä¼¼ä¹Žä¸è¶³ä»¥å–ä»£flashï¼ŒåŽŸå› å¦‚ä¸‹ï¼š ç”¨æˆ·å¯èƒ½éœ€è¦åœ¨å¤šä¸ªè´¨é‡è§†é¢‘é—´è¿›è¡Œå³æ—¶åˆ‡æ¢ ç›´æ’­æ˜¯å¦ä¸€ä¸ªä½¿ç”¨åœºæ™¯ï¼Œçœ‹èµ·æ¥å¾ˆéš¾ä»¥è¿™ç§æ–¹å¼å®žçŽ° å¦‚æžœå†…å®¹åƒNetflixä¸€æ ·æµå¼ä¼ è¾“ï¼Œé‚£ä¹ˆåŸºäºŽç”¨æˆ·åå¥½æ›´æ–°å†…å®¹çš„éŸ³é¢‘è¯­è¨€å‘¢ï¼Ÿ å€¼å¾—åº†å¹¸çš„æ˜¯ï¼Œéšç€HTML5è§„èŒƒçš„åˆ°æ¥ï¼Œä»¥ä¸Šæ‰€æœ‰è¿™äº›é—®é¢˜éƒ½å¯ä»¥åœ¨å¤§å¤šæ•°æµè§ˆå™¨ä¸Šè§£å†³ã€‚æœ¬æ–‡å°†è¯¦ç»†ä»‹ç»ä»Šå¤©çš„webå¦‚ä½•åšåˆ°è¿™äº›çš„ã€‚ Videoæ ‡ç­¾å‰é¢æœ‰æåˆ°ï¼Œä½¿ç”¨HTML5åœ¨ç½‘é¡µé‡ŒåŠ è½½è§†é¢‘æ˜¯ç›¸å½“ç›´è§‚ï¼Œä½ åªéœ€è¦åœ¨ä½ çš„é¡µé¢ä¸­æ·»åŠ ä¸€ä¸ªvideoæ ‡ç­¾ä»¥åŠç»™å®ƒä¸€äº›ç›¸å…³çš„å±žæ€§ã€‚ 123456789&lt;html&gt; &lt;head&gt; &lt;meta charset="UTF-8"&gt; &lt;title&gt;My Video&lt;/title&gt; &lt;/head&gt; &lt;body&gt; &lt;video src="some_video.mp4" width="1280px" height="720px" /&gt; &lt;/body&gt;&lt;/html&gt; videoæ ‡ç­¾å°†å…è®¸æ‚¨çš„é¡µé¢ç›´æŽ¥åœ¨ä»»ä½•æ”¯æŒç›¸åº”ç¼–è§£ç å™¨ï¼ˆå½“ç„¶è¿˜æœ‰HTML5ï¼‰çš„æµè§ˆå™¨ä¸Šæµå¼ä¼ è¾“some_video.mp4ã€‚åŒæ—¶HTML5è¿˜æä¾›äº†ä¸°å¯Œçš„APIï¼Œæ¯”å¦‚è§†é¢‘çš„æ’­æ”¾ï¼Œæš‚åœï¼Œå¿«è¿›ä»¥åŠæ”¹å˜æ’­æ”¾é€ŸçŽ‡ã€‚ ç„¶è€Œï¼ŒçŽ°å¦‚ä»Šæˆ‘ä»¬åœ¨ç½‘ç«™ä¸Šçœ‹åˆ°çš„è§†é¢‘æ‹¥æœ‰æ›´è¿‡æ›´å¤æ‚çš„è¡Œä¸ºè¿œè¿œè¶…è¿‡äº†HTML5æä¾›ç»™æˆ‘ä»¬çš„ã€‚ä¾‹å¦‚ï¼Œè§†é¢‘è´¨é‡åˆ‡æ¢å’Œå®žæ—¶æµåª’ä½“ã€‚è¿™äº›ç½‘ç«™å®žé™…ä¸Šä»ç„¶ä½¿ç”¨è§†é¢‘æ ‡ç­¾ã€‚ä½†æ˜¯ï¼Œä»–ä»¬ä¸æ˜¯ç®€å•åœ°åœ¨srcå±žæ€§ä¸­è®¾ç½®è§†é¢‘åœ°å€ï¼Œè€Œæ˜¯ä½¿ç”¨æ›´å¼ºå¤§çš„Web APIï¼Œå³åª’ä½“èµ„æºæ‰©å±•ï¼ˆMedia Source Extensionsï¼‰ã€‚ åª’ä½“èµ„æºæ‰©å±•ï¼ˆMedia Source Extensionsï¼‰åª’ä½“èµ„æºæ‰©å±•ï¼ˆMedia Source Extensionsç®€ç§°â€œMSEâ€ï¼Œ æ˜¯ä¸€ä¸ªçŽ°ä»Šå¤šæ•°æµè§ˆå™¨éƒ½éµå®ˆçš„è§„èŒƒã€‚å®ƒåˆ›å»ºæ¥æ˜¯ä¸ºäº†è®©HTMLå’ŒJavaScriptå…è®¸é‚£äº›å¤æ‚çš„åª’ä½“ç”¨ä¾‹ã€‚ è¿™äº›â€œæ‰©å±•â€å°†MediaSourceå¯¹è±¡æ·»åŠ åˆ°JavaScriptï¼Œé¡¾åæ€ä¹‰ï¼Œå®ƒå°±æ˜¯è§†é¢‘èµ„æºï¼Œæˆ–è€…æ›´ç®€å•åœ°è¯´ï¼Œè¿™æ˜¯è¡¨ç¤ºæˆ‘ä»¬è§†é¢‘æ•°æ®çš„å¯¹è±¡ã€‚å¦‚ä¸Šé¢æ‰€è¯´ï¼Œæˆ‘ä»¬ä»ç„¶ä¼šä½¿ç”¨&lt;video&gt;, ä¹Ÿè®¸æ›´ä»¤äººæƒŠè®¶çš„æ˜¯,æˆ‘ä»¬ä»ç„¶ä½¿ç”¨æ˜¯srcå±žæ€§ï¼Œåªæ˜¯æˆ‘ä»¬ä¸å†é“¾æŽ¥åˆ°ä¸€ä¸ªè§†é¢‘æ–‡ä»¶ï¼Œè€Œæ˜¯é“¾æŽ¥åˆ°ä¸€ä¸ªåª’ä½“èµ„æºå¯¹è±¡ã€‚ ä½ å¯èƒ½å¯¹è€Œæ˜¯é“¾æŽ¥åˆ°ä¸€ä¸ªåª’ä½“èµ„æºå¯¹è±¡æ„Ÿåˆ°å¾ˆç–‘æƒ‘ï¼Œè¿™é‡Œæˆ‘ä»¬ä¸å†è¯´å®ƒæ˜¯ä¸€ä¸ªURLï¼Œè€Œæˆ‘ä»¬è¯´å®ƒæ˜¯ä¸€ä¸ªJavaScriptè¯­è¨€ä¸­çš„æŠ½è±¡æ¦‚å¿µï¼Œé‚£æ€Žä¹ˆå¯ä»¥å°†å®ƒç§°ä¸ºè§†é¢‘æ ‡ç­¾ä¸Šçš„URLï¼Œè¿™æ˜¯åœ¨HTMLä¸­å®šä¹‰çš„ï¼Ÿ ä¸ºäº†å…è®¸è¿™ç§ç”¨ä¾‹ï¼ŒW3Cå®šä¹‰äº†URL.createObjectURLé™æ€æ–¹æ³•ã€‚æ­¤APIå…è®¸åˆ›å»ºä¸€ä¸ªURLï¼Œè¯¥URLå®žé™…ä¸Šä¸ä¼šå¼•ç”¨åœ¨çº¿å¯ç”¨çš„èµ„æºï¼Œè€Œæ˜¯ç›´æŽ¥å¼•ç”¨åœ¨å®¢æˆ·ç«¯ä¸Šåˆ›å»ºçš„JavaScriptå¯¹è±¡ã€‚è¿™å°±æ˜¯MediaSourceé™„åŠ åˆ°è§†é¢‘æ ‡ç­¾çš„åŽŸç†ã€‚ 12345678const videoTag = document.getElementById("my-video");// creating the MediaSource, just with the "new" keyword, and the URL for itconst myMediaSource = new MediaSource();const url = URL.createObjectURL(myMediaSource);// attaching the MediaSource to the video tagvideoTag.src = url; å°±æ˜¯è¿™æ ·ï¼çŽ°åœ¨ä½ çŸ¥é“æµåª’ä½“å¹³å°å¦‚ä½•åœ¨ç½‘ç»œä¸Šæ’­æ”¾è§†é¢‘äº†ï¼ å¼€ä¸ªçŽ©ç¬‘ã€‚æ‰€ä»¥çŽ°åœ¨æˆ‘ä»¬æœ‰äº†MediaSourceï¼Œä½†æ˜¯æˆ‘ä»¬åº”è¯¥æ€Žä¹ˆåšå‘¢ï¼Ÿ MSEè§„èŒƒå¹¶ä¸æ­¢äºŽæ­¤ã€‚å®ƒè¿˜å®šä¹‰äº†å¦ä¸€ä¸ªæ¦‚å¿µSourceBuffersã€‚ èµ„æºç¼“å†²è§†é¢‘å®žé™…ä¸Šå¹¶æœªç›´æŽ¥â€œæŽ¨å…¥â€MediaSourceè¿›è¡Œæ’­æ”¾ï¼ŒSourceBufferç”¨äºŽæ­¤ç›®çš„ã€‚ ä¸€ä¸ªMediaSourceåŒ…å«ä¸€ä¸ªæˆ–å¤šä¸ªSourceBufferå®žä¾‹ã€‚æ¯ä¸ªéƒ½ä¸ŽæŸä¸€ç§ç±»åž‹å†…å®¹ç›¸å…³è”ã€‚è¿™é‡Œç®€å•åœ°è¯´ï¼Œæœ‰ä¸‰ç§å¯èƒ½çš„ç±»åž‹ï¼š audio video audio å’Œ video æ³¨æ„ï¼š å®žé™…ä¸Šï¼Œå†…å®¹çš„â€œç±»åž‹â€ç”±å…¶MIMEç±»åž‹å®šä¹‰ï¼Œå…¶è¿˜å¯ä»¥åŒ…æ‹¬å…³äºŽæ‰€ä½¿ç”¨çš„åª’ä½“ç¼–è§£ç å™¨çš„ä¿¡æ¯ SourceBufferéƒ½ä¼šé“¾æŽ¥åˆ°å•ä¸ªMediaSourceï¼Œå…¶ä¸­æ¯ä¸ªSourceBufferéƒ½ä¼šè¢«JavaScriptç”¨æ¥å°†è§†é¢‘æ•°æ®ç›´æŽ¥æ·»åŠ åˆ°HTML5è§†é¢‘æ ‡ç­¾ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š åˆ†ç¦»è§†é¢‘å’ŒéŸ³é¢‘è¿˜å…è®¸åœ¨æœåŠ¡å™¨ç«¯å•ç‹¬ç®¡ç†å®ƒä»¬ã€‚è¿™æ ·åšä¼šå¸¦æ¥ä¸€äº›å¥½å¤„ï¼Œæˆ‘ä»¬ç¨åŽä¼šçœ‹åˆ°ã€‚è¿™æ˜¯å®ƒçš„å·¥ä½œåŽŸç†ï¼š 12345678910111213141516171819202122232425262728// -- åˆ›å»ºMediaSourceå¹¶å…³è”åˆ°video --const videoTag = document.getElementById("my-video");const myMediaSource = new MediaSource();const url = URL.createObjectURL(myMediaSource);videoTag.src = url;// 1. ä¸ºMediaSourceæ·»åŠ sourceBufferconst audioSourceBuffer = myMediaSource .addSourceBuffer(`audio/mp4; codecs="mp4a.40.2"`);const videoSourceBuffer = myMediaSource .addSourceBuffer(`video/mp4; codecs="avc1.64001e"`);// 2. ä¸‹è½½å¹¶æ·»åŠ audio/videoåˆ°SourceBuffers// for the audio SourceBufferfetch("http://server.com/audio.mp4").then(function(response) &#123; // The data has to be a JavaScript ArrayBuffer return response.arrayBuffer();&#125;).then(function(audioData) &#123; audioSourceBuffer.appendBuffer(audioData);&#125;);// the same for the video SourceBufferfetch("http://server.com/video.mp4").then(function(response) &#123; // The data has to be a JavaScript ArrayBuffer return response.arrayBuffer();&#125;).then(function(videoData) &#123; videoSourceBuffer.appendBuffer(videoData);&#125;); æˆ‘ä»¬çŽ°åœ¨èƒ½å¤ŸåŠ¨æ€åœ°å°†è§†é¢‘å’ŒéŸ³é¢‘æ•°æ®æ·»åŠ åˆ°æˆ‘ä»¬çš„è§†é¢‘æ ‡ç­¾ä¸­ã€‚ çŽ°åœ¨æ˜¯æ—¶å€™ä»‹ç»éŸ³é¢‘å’Œè§†é¢‘æ•°æ®äº†ã€‚åœ¨å‰é¢çš„ç¤ºä¾‹ä¸­ï¼Œæ‚¨å¯èƒ½å·²ç»æ³¨æ„åˆ°éŸ³é¢‘å’Œè§†é¢‘æ•°æ®é‡‡ç”¨mp4æ ¼å¼ã€‚ â€œmp4â€æ˜¯ä¸€ç§å®¹å™¨æ ¼å¼ï¼Œå®ƒä¸ä»…åŒ…å«ç›¸å…³çš„åª’ä½“æ•°æ®ï¼Œè¿˜åŒ…å«å¤šä¸ªå…ƒæ•°æ®ï¼Œä¾‹å¦‚ï¼Œå®ƒæ‰€åŒ…å«çš„åª’ä½“çš„å¼€å§‹æ—¶é—´å’ŒæŒç»­æ—¶é—´ã€‚ã€‚ MSEè§„èŒƒæ²¡æœ‰è§„å®šæµè§ˆå™¨å¿…é¡»ç†è§£å“ªç§æ ¼å¼ã€‚å¯¹äºŽè§†é¢‘æ•°æ®ï¼Œæœ€å¸¸è§çš„ä¸¤ä¸ªæ˜¯mp4å’Œwebmæ–‡ä»¶ã€‚å‰è€…çŽ°åœ¨éžå¸¸æœ‰åï¼ŒåŽè€…ç”±è°·æ­ŒèµžåŠ©å¹¶åŸºäºŽå¯èƒ½æ›´ä¸ºäººæ‰€çŸ¥çš„Matroskaæ ¼å¼ï¼ˆâ€œ.mkvâ€æ–‡ä»¶ï¼‰ã€‚å¤§å¤šæ•°æµè§ˆå™¨å¯¹è¿™ä¸¤ç§æ ¼å¼éƒ½æœ‰å¾ˆå¥½çš„æ”¯æŒã€‚ å°½ç®¡å¦‚æ­¤ï¼Œè®¸å¤šé—®é¢˜ä»æœªå¾—åˆ°è§£ç­”ï¼š æˆ‘ä»¬æ˜¯å¦å¿…é¡»ç­‰å¾…ä¸‹è½½æ•´ä¸ªå†…å®¹ï¼Œæ‰èƒ½å°†å…¶æŽ¨é€åˆ°SourceBufferï¼ˆå› æ­¤èƒ½å¤Ÿæ’­æ”¾ï¼‰ï¼Ÿ æˆ‘ä»¬å¦‚ä½•åœ¨å¤šç§è´¨é‡æˆ–è¯­è¨€ä¹‹é—´åˆ‡æ¢ å¦‚ä½•åœ¨åª’ä½“èµ„æºå°šæœªå®Œæˆæ—¶æ’­æ”¾å®žå†µå†…å®¹ï¼ˆå³å¦‚ä½•å®žçŽ°ç›´æ’­ï¼‰ï¼Ÿ åª’ä½“ç‰‡æ®µåœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œæˆ‘ä»¬æœ‰ä¸€ä¸ªhttp://server.com/audio.mp4æ–‡ä»¶ä»£è¡¨æ•´ä¸ªéŸ³é¢‘ï¼Œä¸€ä¸ªhttp://server.com/vedio.mp4æ–‡ä»¶ä»£è¡¨æ•´ä¸ªè§†é¢‘ã€‚è¿™å¯¹äºŽéžå¸¸ç®€å•çš„ç”¨ä¾‹æ¥è¯´å·²ç»è¶³å¤Ÿäº†ï¼Œä½†å¦‚æžœæ‚¨æƒ³è¦äº†è§£å¤§å¤šæ•°æµåª’ä½“ç½‘ç«™æä¾›çš„å¤æ‚æ€§ï¼ˆåˆ‡æ¢è¯­è¨€ï¼Œè´¨é‡ï¼Œæ’­æ”¾å®žæ—¶å†…å®¹ç­‰ï¼‰ï¼Œè¿™è¿˜ä¸å¤Ÿã€‚ åœ¨æ›´é«˜çº§çš„è§†é¢‘æ’­æ”¾å™¨ä¸­å®žé™…å‘ç”Ÿçš„æ˜¯, éŸ³/è§†é¢‘æ•°æ®è¢«åˆ†æˆå¤šä¸ªâ€œç‰‡æ®µâ€ã€‚è¿™äº›æ®µå¯ä»¥æœ‰å„ç§å¤§å°ï¼Œä½†å®ƒä»¬é€šå¸¸ä»£è¡¨2åˆ°10ç§’çš„å†…å®¹ã€‚æ‰€æœ‰è¿™äº›éŸ³/è§†é¢‘ç‰‡æ®µå½¢æˆå®Œæ•´çš„éŸ³/è§†é¢‘å†…å®¹ã€‚è¿™äº›æ•°æ®å—ä¸ºæˆ‘ä»¬ä¹‹å‰çš„ç¤ºä¾‹å¢žåŠ äº†ä¸€ä¸ªå…¨æ–°çš„çµæ´»æ€§ï¼šä¸æ˜¯ä¸€æ¬¡æŽ¨é€æ•´ä¸ªå†…å®¹ï¼Œæˆ‘ä»¬å¯ä»¥é€æ­¥æŽ¨åŠ¨å¤šä¸ªéŸ³/è§†é¢‘ç‰‡æ®µã€‚ ä¸‹é¢æœ‰ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼š 12345678910111213141516171819202122232425262728293031323334353637383940414243// ...// (definition of the MediaSource and its SourceBuffers)/** * Fetch a video or an audio segment, * and returns it as an ArrayBuffer, in a Promise. * @param &#123;string&#125; url * @returns &#123;Promise.&lt;ArrayBuffer&gt;&#125; */function fetchSegment(url) &#123; return fetch(url).then(function(response) &#123; return response.arrayBuffer(); &#125;);&#125;// fetching audio segments one after another (notice the URLs)fetchSegment("http://server.com/audio/segment0.mp4") .then(function(audioSegment0) &#123; audioSourceBuffer.appendBuffer(audioSegment0); &#125;) .then(function() &#123; return fetchSegment("http://server.com/audio/segment1.mp4"); &#125;) .then(function(audioSegment1) &#123; audioSourceBuffer.appendBuffer(audioSegment1); &#125;) .then(function() &#123; return fetchSegment("http://server.com/audio/segment2.mp4"); &#125;) .then(function(audioSegment2) &#123; audioSourceBuffer.appendBuffer(audioSegment2); &#125;) // ...// same thing for video segmentsfetchSegment("http://server.com/video/segment0.mp4") .then(function(videoSegment0) &#123; videoSourceBuffer.appendBuffer(videoSegment0); &#125;);// ... ä»Žä¸Šé¢ä»£ç å¯ä»¥çœ‹å‡ºï¼Œåœ¨æœåŠ¡å™¨ç«¯å­˜åœ¨å¤šä¸ªç‰‡æ®µèµ„æº: 123456./audio/ â”œâ”€â”€ segment0.mp4 â”œâ”€â”€ segment1.mp4 â””â”€â”€ segment2.mp4./video/ â””â”€â”€ segment0.mp4 âš ï¸ æœåŠ¡å™¨ç«¯çš„éŸ³/è§†é¢‘æ–‡ä»¶å¯èƒ½å¹¶æ²¡æœ‰çœŸæ­£è¢«åˆ†æ®µï¼Œå®¢æˆ·ç«¯å¯ä»¥ä½¿ç”¨HTTP range requestæ¥èŽ·å–åˆ†æ®µçš„é‚£äº›æ–‡ä»¶ç‰‡æ®µï¼ˆä¹Ÿæœ‰å¯èƒ½æœåŠ¡å™¨çœŸçš„å¯ä»¥æ ¹æ®æ‚¨çš„è¯·æ±‚å‘é€ä½ æƒ³è¦çš„å¤‡ä»½ç‰‡æ®µï¼‰ã€‚ä½†æ˜¯ï¼Œè¿™äº›æƒ…å†µéƒ½æ˜¯å®žçŽ°ç»†èŠ‚ã€‚æœ¬æ–‡ä¸­æˆ‘ä»¬è®¤ä¸ºæœåŠ¡å™¨ç«¯æœ‰åˆ†æ®µã€‚ æ‰€æœ‰è¿™äº›éƒ½æ„å‘³ç€ï¼Œæˆ‘ä»¬ä¸å¿…ç­‰å¾…æ•´ä¸ªéŸ³/è§†é¢‘å†…å®¹ä¸‹è½½åŽæ‰å¼€å§‹æ’­æ”¾ã€‚æˆ‘ä»¬ç»å¸¸åªéœ€åª’ä½“ç‰‡æ®µã€‚å½“ç„¶ï¼Œå¤§å¤šæ•°æ’­æ”¾å™¨ä¸ä¼šåƒæˆ‘ä»¬ä»£ç é‚£æ ·ä¸ºæ¯ä¸ªè§†é¢‘å’ŒéŸ³é¢‘ç‰‡æ®µæ‰‹åŠ¨æ‰§è¡Œæ­¤é€»è¾‘ï¼Œä½†ä»–ä»¬éµå¾ªç›¸åŒçš„æƒ³æ³•ï¼šæŒ‰é¡ºåºä¸‹è½½ç‰‡æ®µå¹¶å°†å…¶æŽ¨å…¥èµ„æºç¼“å†²åŒºï¼ˆSourceBufferï¼‰ã€‚ ä¸€ç§æœ‰è¶£çš„æ–¹å¼çœ‹åˆ°è¿™ä¸ªé€»è¾‘å‘ç”Ÿåœ¨çŽ°å®žç”Ÿæ´»ä¸­å¯ä»¥æ‰“å¼€ç½‘ç»œç›‘è§†å™¨åœ¨Firefox /é“¬/è¾¹ç¼˜(åœ¨Linuxæˆ–windowsç±»åž‹â€œCtrl + Shift + iâ€å’Œâ€œç½‘ç»œâ€é€‰é¡¹å¡,åœ¨Macåº”è¯¥Cmd + Alt +ç„¶åŽæˆ‘â€œç½‘ç»œâ€),ç„¶åŽå¯åŠ¨ä¸€ä¸ªè§†é¢‘åœ¨ä½ æœ€å–œçˆ±çš„æµåª’ä½“ç½‘ç«™ã€‚ä½ åº”è¯¥ä¼šçœ‹åˆ°å„ç§è§†é¢‘å’ŒéŸ³é¢‘ç‰‡æ®µè¢«å¿«é€Ÿä¸‹è½½: é¡ºä¾¿è¯´ä¸€ä¸‹ï¼Œæ‚¨å¯èƒ½å·²ç»æ³¨æ„åˆ°ï¼Œæˆ‘ä»¬çš„æ®µåªæ˜¯è¢«æŽ¨å…¥æºç¼“å†²åŒºï¼Œè€Œæ²¡æœ‰æ ¹æ®æ—¶é—´ä½ç½®æŒ‡ç¤ºåº”è¯¥æŽ¨å…¥çš„ä½ç½®ã€‚ç‰‡æ®µçš„å®¹å™¨å®žé™…ä¸Šå®šä¹‰äº†å®ƒä»¬åº”è¯¥æ”¾åœ¨æ•´ä¸ªåª’ä½“ä¸­çš„æ—¶é—´ã€‚è¿™æ ·ï¼Œæˆ‘ä»¬å°±ä¸å¿…åœ¨JavaScriptä¸­åŒæ­¥å®ƒäº†ã€‚ è‡ªé€‚åº”æµåª’ä½“è®¸å¤šè§†é¢‘æ’­æ”¾å™¨éƒ½æœ‰â€œè‡ªåŠ¨è´¨é‡â€åŠŸèƒ½ï¼Œæ ¹æ®ç”¨æˆ·çš„ç½‘ç»œå’Œå¤„ç†èƒ½åŠ›è‡ªåŠ¨é€‰æ‹©è´¨é‡ã€‚è¿™æ˜¯è‡ªé€‚åº”æµåª’ä½“çš„ç½‘ç»œæ’­æ”¾å™¨çš„æ ¸å¿ƒã€‚è¿™ç§è¡Œä¸ºä¹Ÿæ˜¯å¾—ç›ŠäºŽåª’ä½“åˆ‡ç‰‡çš„æ¦‚å¿µã€‚ åœ¨æœåŠ¡ç«¯ï¼ŒéŸ³/è§†é¢‘ç‰‡æ®µå®žé™…ä¸Šæ˜¯ä»¥å¤šç§è´¨é‡ç¼–ç çš„ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬çš„æœåŠ¡å™¨å¯ä»¥å­˜æ”¾ä¸‹é¢çš„æ–‡ä»¶ï¼š 123456789101112131415161718./audio/ â”œâ”€â”€ ./128kbps/ | â”œâ”€â”€ segment0.mp4 | â”œâ”€â”€ segment1.mp4 | â””â”€â”€ segment2.mp4 â””â”€â”€ ./320kbps/ â”œâ”€â”€ segment0.mp4 â”œâ”€â”€ segment1.mp4 â””â”€â”€ segment2.mp4./video/ â”œâ”€â”€ ./240p/ | â”œâ”€â”€ segment0.mp4 | â”œâ”€â”€ segment1.mp4 | â””â”€â”€ segment2.mp4 â””â”€â”€ ./720p/ â”œâ”€â”€ segment0.mp4 â”œâ”€â”€ segment1.mp4 â””â”€â”€ segment2.mp4 ç„¶åŽï¼ŒWebæ’­æ”¾å™¨å¯ä»¥æ ¹æ®ç½‘ç»œæˆ–CPUæ¡ä»¶è‡ªåŠ¨æ­£ç¡®é€‰æ‹©è¦ä¸‹è½½çš„ç‰‡æ®µã€‚è¿™å®Œå…¨æ˜¯ç”¨JavaScriptå®Œæˆçš„ã€‚å¯¹äºŽéŸ³é¢‘ç‰‡æ®µï¼Œä¾‹å¦‚ï¼Œå®ƒå¯èƒ½çœ‹èµ·æ¥åƒè¿™æ ·ï¼š 123456789101112131415161718192021222324252627282930313233343536/** * æ ¹æ®ç‰‡æ®µçš„ç¼–å·å’Œè´¨é‡æŽ¨å…¥sourceBuffer * @param &#123;number&#125; nb * @param &#123;string&#125; language * @param &#123;string&#125; wantedQuality * @returns &#123;Promise&#125; */function pushAudioSegment(nb, wantedQuality) &#123; // The url begins to be a little more complex here: const url = "http://my-server/audio/" + wantedQuality + "/segment" + nb + ".mp4");return fetch(url) .then((response) =&gt; response.arrayBuffer()); .then(function(arrayBuffer) &#123; audioSourceBuffer.appendBuffer(arrayBuffer); &#125;);&#125;/**å°†å½“å‰çš„å¸¦å®½è½¬æ¢ä¸ºå¯¹åº”éŸ³é¢‘æœåŠ¡å™¨ç«¯å®šä¹‰çš„è´¨é‡ã€‚ * @param &#123;number&#125; bandwidth * @returns &#123;string&#125; */function fromBandwidthToQuality(bandwidth) &#123; return bandwidth &gt; 320e3 ? "320kpbs" : "128kbps";&#125;// first estimate the bandwidth. Most often, this is based on// the time it took to download the last segmentsconst bandwidth = estimateBandwidth();const quality = fromBandwidthToQuality(bandwidth);pushAudioSegment(0, quality) .then(() =&gt; pushAudioSegment(1, quality)) .then(() =&gt; pushAudioSegment(2, quality)); æ­£å¦‚æ‚¨æ‰€çœ‹åˆ°çš„ï¼Œæˆ‘ä»¬å°†ä¸åŒè´¨é‡çš„ç‰‡æ®µæ”¾åœ¨ä¸€èµ·æ²¡æœ‰é—®é¢˜ï¼Œjavascriptä¸Šçš„æ‰€æœ‰å†…å®¹éƒ½æ˜¯é€æ˜Žçš„ã€‚åœ¨ä»»ä½•æƒ…å†µä¸‹ï¼Œå®¹å™¨æ–‡ä»¶åŒ…å«è¶³å¤Ÿçš„ä¿¡æ¯ï¼Œä½¿æ­¤è¿‡ç¨‹èƒ½å¤Ÿé¡ºåˆ©è¿è¡Œã€‚ å¤šè¯­è¨€åˆ‡æ¢åœ¨Netflixã€Amazon Prime videoæˆ–MyCanalç­‰æ›´å¤æ‚çš„ç½‘ç»œè§†é¢‘æ’­æ”¾å™¨ä¸Šï¼Œä¹Ÿå¯ä»¥æ ¹æ®ç”¨æˆ·è®¾ç½®åœ¨å¤šç§éŸ³é¢‘è¯­è¨€ä¹‹é—´åˆ‡æ¢ã€‚æ—¢ç„¶æ‚¨å·²ç»çŸ¥é“äº†è§†é¢‘è´¨é‡çš„åˆ‡æ¢æ–¹å¼ï¼Œé‚£ä¹ˆå¤šè¯­è¨€åˆ‡æ¢çš„å®žçŽ°æ–¹å¼å¯¹æ‚¨æ¥è¯´åº”è¯¥éžå¸¸ç®€å•ã€‚ä¸Žè‡ªé€‚åº”æµåª’ä½“ä¸€æ ·ï¼Œæˆ‘ä»¬åœ¨æœåŠ¡å™¨ç«¯ä¹Ÿæœ‰å¾ˆå¤šæ®µï¼š 12345678910111213./audio/ â”œâ”€â”€ ./esperanto/ | â”œâ”€â”€ segment0.mp4 | â”œâ”€â”€ segment1.mp4 | â””â”€â”€ segment2.mp4 â””â”€â”€ ./french/ â”œâ”€â”€ segment0.mp4 â”œâ”€â”€ segment1.mp4 â””â”€â”€ segment2.mp4./video/ â”œâ”€â”€ segment0.mp4 â”œâ”€â”€ segment1.mp4 â””â”€â”€ segment2.mp4 è¿™ä¸€æ¬¡ï¼Œè§†é¢‘æ’­æ”¾å™¨åˆ‡æ¢è¯­è¨€ä¸å†æ˜¯åŸºäºŽå®¢æˆ·ç«¯åŠŸèƒ½ï¼Œè€Œæ˜¯æ ¹æ®ç”¨æˆ·çš„åå¥½è¿›è¡Œåˆ‡æ¢ã€‚å¯¹äºŽéŸ³é¢‘æ®µï¼Œå®¢æˆ·ç«¯ä»£ç å¤§è‡´æ˜¯ä»¥ä¸‹æ ·å­: 12345678910111213141516171819202122232425// .../** * Push audio segment in the source buffer based on its number and language. * @param &#123;number&#125; nb * @param &#123;string&#125; language * @returns &#123;Promise&#125; */function pushAudioSegment(nb, language) &#123; // construct dynamically the URL of the segment // and push it to the SourceBuffer const url = "http://my-server/audio/" + language + "/segment" + nb + ".mp4" return fetch(url); .then((response) =&gt; response.arrayBuffer()); .then(function(arrayBuffer) &#123; audioSourceBuffer.appendBuffer(arrayBuffer); &#125;);&#125;// recuperate in some way the user's languageconst language = getUsersLanguage();pushAudioSegment(0, language) .then(() =&gt; pushAudioSegment(1, language)) .then(() =&gt; pushAudioSegment(2, language)); æ‚¨å¯èƒ½è¿˜å¸Œæœ›åœ¨åˆ‡æ¢è¯­è¨€æ—¶â€œæ¸…é™¤â€ä»¥å‰çš„SourceBufferå†…å®¹ï¼Œä»¥é¿å…æ··åˆä½¿ç”¨å¤šè¯­è¨€éŸ³é¢‘å†…å®¹ã€‚è¿™å¯ä»¥é€šè¿‡SourceBuffer.prototype.removeæ–¹æ³•å®žçŽ°ï¼Œè¯¥æ–¹æ³•ä»¥ç§’ä¸ºå¼€å§‹å’Œç»“æŸæ—¶é—´ï¼š 12// remove pushed content from 0 to 40saudioSourceBuffer.remove(0, 40); å½“ç„¶ï¼Œä¹Ÿå¯ä»¥å°†è‡ªé€‚åº”æµåª’ä½“å’Œå¤šè¯­è¨€ç»“åˆèµ·æ¥ã€‚æˆ‘ä»¬å¯ä»¥å°†æœåŠ¡å™¨çš„æ–‡ä»¶æŒ‰ç…§ä»¥ä¸‹å½¢å¼ç»„ç»‡ï¼š 12345678910111213141516171819202122232425262728./audio/ â”œâ”€â”€ ./esperanto/ | â”œâ”€â”€ ./128kbps/ | | â”œâ”€â”€ segment0.mp4 | | â”œâ”€â”€ segment1.mp4 | | â””â”€â”€ segment2.mp4 | â””â”€â”€ ./320kbps/ | â”œâ”€â”€ segment0.mp4 | â”œâ”€â”€ segment1.mp4 | â””â”€â”€ segment2.mp4 â””â”€â”€ ./french/ â”œâ”€â”€ ./128kbps/ | â”œâ”€â”€ segment0.mp4 | â”œâ”€â”€ segment1.mp4 | â””â”€â”€ segment2.mp4 â””â”€â”€ ./320kbps/ â”œâ”€â”€ segment0.mp4 â”œâ”€â”€ segment1.mp4 â””â”€â”€ segment2.mp4./video/ â”œâ”€â”€ ./240p/ | â”œâ”€â”€ segment0.mp4 | â”œâ”€â”€ segment1.mp4 | â””â”€â”€ segment2.mp4 â””â”€â”€ ./720p/ â”œâ”€â”€ segment0.mp4 â”œâ”€â”€ segment1.mp4 â””â”€â”€ segment2.mp4 è¿™æ ·ï¼Œå®¢æˆ·ç«¯å¿…é¡»ç®¡ç†è¯­è¨€å’Œç½‘ç»œæ¡ä»¶ï¼š 12345678910111213141516171819202122232425/** * Push audio segment in the source buffer based on its number, language and quality * @param &#123;number&#125; nb * @param &#123;string&#125; language * @param &#123;string&#125; wantedQuality * @returns &#123;Promise&#125; */function pushAudioSegment(nb, language, wantedQuality) &#123; // The url begins to be a little more complex here: const url = "http://my-server/audio/" + language + "/" + wantedQuality + "/segment" + nb + ".mp4"); return fetch(url) .then((response) =&gt; response.arrayBuffer()); .then(function(arrayBuffer) &#123; audioSourceBuffer.appendBuffer(arrayBuffer); &#125;);&#125;const bandwidth = estimateBandwidth();const quality = fromBandwidthToQuality(bandwidth);const language = getUsersLanguage();pushAudioSegment(0, language, quality) .then(() =&gt; pushAudioSegment(1, language, quality)) .then(() =&gt; pushAudioSegment(2, language, quality)); å¦‚æ‚¨æ‰€è§ï¼ŒçŽ°åœ¨æœ‰å¾ˆå¤šæ–¹æ³•å¯ä»¥å®šä¹‰ç›¸åŒçš„å†…å®¹ã€‚è¿™æ­ç¤ºäº†åˆ†ç¦»è§†é¢‘å’ŒéŸ³é¢‘æ®µç›¸å¯¹äºŽæ•´ä¸ªæ–‡ä»¶çš„å¦ä¸€ä¸ªä¼˜åŠ¿ã€‚å¯¹äºŽåŽè€…ï¼Œæˆ‘ä»¬å°†ä¸å¾—ä¸ç»“åˆæœåŠ¡å™¨ç«¯çš„æ‰€æœ‰å¯èƒ½æ€§ï¼Œè¿™å¯èƒ½ä¼šå ç”¨æ›´å¤šçš„ç©ºé—´: 123456789101112131415161718192021222324segment0_video_240p_audio_esperanto_128kbps.mp4segment0_video_240p_audio_esperanto_320kbps.mp4segment0_video_240p_audio_french_128kbps.mp4segment0_video_240p_audio_french_320kbps.mp4segment0_video_720p_audio_esperanto_128kbps.mp4segment0_video_720p_audio_esperanto_320kbps.mp4segment0_video_720p_audio_french_128kbps.mp4segment0_video_720p_audio_french_320kbps.mp4segment1_video_240p_audio_esperanto_128kbps.mp4segment1_video_240p_audio_esperanto_320kbps.mp4segment1_video_240p_audio_french_128kbps.mp4segment1_video_240p_audio_french_320kbps.mp4segment1_video_720p_audio_esperanto_128kbps.mp4segment1_video_720p_audio_esperanto_320kbps.mp4segment1_video_720p_audio_french_128kbps.mp4segment1_video_720p_audio_french_320kbps.mp4segment2_video_240p_audio_esperanto_128kbps.mp4segment2_video_240p_audio_esperanto_320kbps.mp4segment2_video_240p_audio_french_128kbps.mp4segment2_video_240p_audio_french_320kbps.mp4segment2_video_720p_audio_esperanto_128kbps.mp4segment2_video_720p_audio_esperanto_320kbps.mp4segment2_video_720p_audio_french_128kbps.mp4segment2_video_720p_audio_french_320kbps.mp4 æœåŠ¡ç«¯éœ€è¦å­˜æ”¾æ›´å¤šçš„æ–‡ä»¶ï¼Œæ˜¾ç„¶è¿™äº›æ–‡ä»¶æ•°æ®å­˜åœ¨å¤§é‡å†—ä½™ä¿¡æ¯ï¼ˆå®Œå…¨ç›¸åŒçš„è§†é¢‘æ•°æ®åŒ…å«åœ¨å¤šä¸ªæ–‡ä»¶ä¸­ï¼‰ï¼Œå¹¶ä¸”è¿™ç§æ–¹å¼è¿™åœ¨å®¢æˆ·ç«¯ä¹Ÿæœ‰ä¸€ä¸ªç¼ºç‚¹ï¼Œå› ä¸ºåˆ‡æ¢éŸ³é¢‘è¯­è¨€å¯èƒ½ä¼šå¯¼è‡´æ‚¨é‡æ–°ä¸‹è½½è§†é¢‘ï¼ˆå…·æœ‰é«˜å¸¦å®½æˆæœ¬ï¼‰ã€‚ å®žå†µå†…å®¹æˆ‘ä»¬è¿˜æ²¡æœ‰è°ˆè®ºç›´æ’­ã€‚ç½‘ç»œç›´æ’­å˜å¾—éžå¸¸æ™®éï¼ˆä¾‹å¦‚twitch.tvï¼ŒYouTubeç›´æ’­æµâ€¦ï¼‰ï¼Œè€Œä¸”ç”±äºŽæˆ‘ä»¬çš„è§†é¢‘å’ŒéŸ³é¢‘æ–‡ä»¶æ˜¯åˆ†æ®µçš„ï¼Œè¿™åˆä¸€æ¬¡å¤§å¤§ç®€åŒ–äº†ã€‚ ä¸ºç”¨æœ€ç®€å•çš„æ–¹å¼è§£é‡Šç›´æ’­çš„åŸºæœ¬åŽŸç†ï¼Œè®©æˆ‘ä»¬è€ƒè™‘ä¸€ä¸ªåˆšåˆšåœ¨4ç§’å‰å¼€å§‹ç›´æ’­çš„YouTubeé¢‘é“ã€‚ifæˆ‘ä»¬çš„ç‰‡æ®µå†…å®¹æ˜¯2ç§’é•¿ï¼Œé‚£ä¹ˆæ­¤æ—¶YouTubeçš„æœåŠ¡å™¨åº”è¯¥å·²ç»äº§ç”Ÿäº†ä¸¤ä¸ªéŸ³é¢‘ç‰‡æ®µå’Œä¸¤ä¸ªè§†é¢‘ç‰‡æ®µï¼š 123456./audio/ â”œâ”€â”€ segment0s.mp4 â””â”€â”€ segment2s.mp4./video/ â”œâ”€â”€ segment0s.mp4 â””â”€â”€ segment2s.mp4 åœ¨ç›´æ’­å¼€å§‹çš„ç¬¬5ç§’æ—¶ï¼ŒæœåŠ¡å™¨æ­¤æ—¶è¿˜æ²¡æœ‰æ—¶é—´ç”Ÿæˆä¸‹ä¸€ä¸ªæ®µï¼ˆç¬¬3ä¸ªï¼‰ï¼Œæ‰€ä»¥æœåŠ¡å™¨å…·æœ‰å®Œå…¨ç›¸åŒçš„å¯ç”¨å†…å®¹ã€‚ç›´åˆ°ç¬¬6ç§’åŽï¼ŒæœåŠ¡å™¨äº§ç”Ÿäº†ä¸€ä¸ªæ–°çš„ç‰‡æ®µï¼š 12345678./audio/ â”œâ”€â”€ segment0s.mp4 â”œâ”€â”€ segment2s.mp4 â””â”€â”€ segment4s.mp4./video/ â”œâ”€â”€ segment0s.mp4 â”œâ”€â”€ segment2s.mp4 â””â”€â”€ segment4s.mp4 è¿™åœ¨æœåŠ¡å™¨ç«¯æ˜¯éžå¸¸åˆä¹Žé€»è¾‘çš„ï¼Œç›´æ’­å†…å®¹å®žé™…ä¸Šå¹¶ä¸æ˜¯çœŸæ­£æ„ä¹‰ä¸Šè¿žç»­çš„ï¼Œå®ƒä»¬åƒéžå®žæ—¶å†…å®¹ä¸€æ ·è¢«åˆ†æ®µï¼Œåªæ˜¯éšç€æ—¶é—´çš„æŽ¨ç§»ï¼Œç›´æ’­çš„ç‰‡æ®µç»§ç»­é€æ¸å‡ºçŽ°ã€‚ é‚£ä¹ˆï¼Œæˆ‘ä»¬å¦‚ä½•ä»ŽJSçŸ¥é“åœ¨æŸä¸ªæ—¶é—´ç‚¹ä¸ŠæœåŠ¡å™¨ä¸Šæœ‰å“ªäº›ç‰‡æ®µæ˜¯å¯ç”¨çš„å‘¢? æœ€ç®€å•çš„ï¼Œæˆ‘ä»¬å¯ä»¥å®¢æˆ·ç«¯ä¸Šä½¿ç”¨è®¡æ—¶å™¨ï¼Œç”¨æ¥æŽ¨æ–­æ–°çš„ç‰‡æ®µåœ¨æœåŠ¡å™¨ç«¯å¯ç”¨æ—¶çš„æ—¶é—´ã€‚æˆ‘ä»¬å°†éµå¾ªâ€œsegmentX.mp4â€å‘½åæ¨¡å¼ï¼Œæˆ‘ä»¬å°†æ¯æ¬¡ä»Žæœ€åŽä¸‹è½½çš„ä¸€ä¸ªå¢žåŠ â€œXâ€ï¼ˆsegment0.mp4ï¼Œç„¶åŽï¼Œ2ç§’åŽï¼ŒSegment1.mp4ç­‰ï¼‰ã€‚ç„¶è€Œï¼Œåœ¨è®¸å¤šæƒ…å†µä¸‹ï¼Œè¿™å¯èƒ½å˜å¾—å¹¶ä¸ç²¾ç¡®ï¼š åª’ä½“å†…å®¹ç‰‡æ®µæŒç»­æ—¶é—´å¹¶ä¸å›ºå®šï¼Œ æœåŠ¡å™¨åœ¨ç”Ÿæˆç‰‡æ®µæ—¶æœ‰å»¶è¿Ÿï¼Œ æœåŠ¡å™¨å¯èƒ½ä¼šä¸ºäº†èŠ‚çœç©ºé—´è€Œåˆ é™¤å¤ªæ—§çš„è§†é¢‘ ä½œä¸ºå®¢æˆ·ç«¯ï¼Œæ‚¨å¸Œæœ›å°½å¿«è¯·æ±‚æœ€æ–°çš„ç‰‡æ®µï¼Œä¸€æ—¦å®ƒä»¬å¯ä»¥è¢«èŽ·å–ï¼›åŒæ—¶ä¹Ÿè¦é¿å…åœ¨å°šæœªç”Ÿæˆæ—¶è¿‡æ—©åœ°è¯·æ±‚å®ƒä»¬ï¼ˆè¿™å°†å¯¼è‡´404 HTTPé”™è¯¯ï¼‰ã€‚ é€šå¸¸ä½¿ç”¨ä¼ è¾“åè®®ï¼ˆæœ‰æ—¶ä¹Ÿç§°ä¸ºæµåª’ä½“åè®®ï¼‰æ¥è§£å†³æ­¤é—®é¢˜ã€‚ ä¼ è¾“åè®®å¯¹äºŽæœ¬æ–‡æ¥è¯´ï¼Œæ·±å…¥è§£é‡Šä¸åŒçš„ä¼ è¾“åè®®å¯èƒ½è¿‡äºŽå†—é•¿ã€‚è®©æˆ‘ä»¬å‡è®¾å®ƒä»¬ä¸­çš„å¤§å¤šæ•°éƒ½æœ‰ç›¸åŒçš„æ ¸å¿ƒæ¦‚å¿µ:Manifestã€‚ Manifesæ˜¯ä¸€ä¸ªç”¨æ¥æè¿°æœåŠ¡å™¨ä¸Šå¯ç”¨ç‰‡æ®µçš„æ–‡ä»¶ã€‚æœ‰äº†å®ƒï¼Œä½ å¯ä»¥æè¿°åœ¨è¿™ç¯‡æ–‡ç« ä¸­å­¦åˆ°çš„å¤§å¤šæ•°å†…å®¹ï¼š å“ªäº›éŸ³é¢‘è¯­è¨€çš„å†…å®¹å¯ç”¨ï¼Œä»¥åŠå®ƒä»¬åœ¨æœåŠ¡å™¨ä¸Šçš„ä½ç½®ï¼ˆå¦‚â€œåœ¨å“ªä¸ªURLâ€ï¼‰ å¯ç”¨çš„ä¸åŒéŸ³/è§†é¢‘è´¨é‡ å½“ç„¶ï¼Œå¦‚æžœåœ¨ç›´æ’­çŽ¯å¢ƒä¸‹ï¼ŒåŒ…æ‹¬å¯ä½¿ç”¨çš„ç‰‡æ®µ ä¸‹é¢æ˜¯ä¸€äº›Webä¸­æœ€å¸¸ä½¿ç”¨çš„ä¼ è¾“åè®®ï¼š DASH YouTubeï¼ŒNetflixä»¥åŠAmazon Prime Videoç­‰éƒ½åœ¨ä½¿ç”¨ã€‚ DASHçš„ManifeståŸºäºŽXMLï¼Œè¢«ç§°ä¸ºåª’ä½“å‘ˆçŽ°æè¿°ï¼ˆæˆ–MPDï¼‰ã€‚ DASHè§„èŒƒå…·æœ‰å¾ˆå¤§çš„çµæ´»æ€§ï¼Œå…è®¸MPDæ”¯æŒå¤§å¤šæ•°ç”¨ä¾‹(éŸ³é¢‘æè¿°ã€çˆ¶çº§æŽ§ä»¶)ï¼Œå¹¶ä¸”ä¸ä¾èµ–äºŽç¼–ç ã€‚ HLS ç”±Appleå¼€å‘ï¼Œä½¿ç”¨è€…åŒ…æ‹¬DailyMotionï¼ŒTwitch.tvç­‰ã€‚ HLSçš„Manifestç§°ä¸ºæ’­æ”¾åˆ—è¡¨ï¼Œå…¶æ–‡ä»¶æ ¼å¼ä¸ºm3u8 (m3uæ’­æ”¾åˆ—è¡¨æ–‡ä»¶ï¼Œç”¨UTF-8ç¼–ç )ã€‚ Smooth Streaming ç”±å¾®è½¯å¼€å‘ï¼Œè¢«å¤šä¸ªå¾®è½¯äº§å“å’ŒMyCanalä½¿ç”¨ã€‚åœ¨Smooth Streamingçš„Manifestæ˜¯åŸºäºŽxmlçš„ã€‚ çœŸå®žçš„ç½‘ç»œä¸–ç•Œå¦‚æ‚¨æ‰€è§ï¼Œwebè§†é¢‘èƒŒåŽçš„æ ¸å¿ƒæ¦‚å¿µåœ¨äºŽç”¨JavaScriptåŠ¨æ€æŽ¨é€çš„åª’ä½“ç‰‡æ®µã€‚è¿™ç§è¡Œä¸ºå¾ˆå¿«å˜å¾—ç›¸å½“å¤æ‚ï¼Œå› ä¸ºè§†é¢‘æ’­æ”¾å™¨éœ€è¦æ”¯æŒå¾ˆå¤šåŠŸèƒ½: ä¸‹è½½å¹¶è§£æžæŸç§Manifestæ–‡ä»¶ ç›‘æµ‹å½“å‰çš„ç½‘ç»œçŠ¶å†µ ç”¨æˆ·é¦–é€‰é¡¹(ä¾‹å¦‚ï¼Œé¦–é€‰è¯­è¨€) çŸ¥é“ä¸‹è½½å“ªä¸ªéƒ¨åˆ†ï¼Œè¿™è‡³å°‘å–å†³äºŽå‰é¢çš„ä¸¤ç‚¹ ç®¡ç†ä¸€ä¸ªæ®µç®¡é“ï¼Œä»¥ä¾¿åœ¨æ­£ç¡®çš„æ—¶é—´é¡ºåºä¸‹è½½æ­£ç¡®çš„æ®µ(åŒæ—¶ä¸‹è½½æ¯ä¸ªæ®µå°†æ˜¯ä½Žæ•ˆçš„:æ‚¨éœ€è¦æœ€æ—©çš„ä¸€ä¸ªæ®µï¼Œè€Œä¸æ˜¯ä¸‹ä¸€ä¸ª) å¤„ç†å­—å¹•ï¼Œé€šå¸¸å®Œå…¨ç”¨JSç®¡ç† ä¸€äº›è§†é¢‘æ’­æ”¾å™¨è¿˜ç®¡ç†ä¸€ä¸ªç¼©ç•¥å›¾è·Ÿè¸ªï¼Œæ‚¨å¯ä»¥ç»å¸¸çœ‹åˆ°ï¼Œå½“æ‚¬åœåœ¨è¿›åº¦æ¡ è®¸å¤šæœåŠ¡è¿˜éœ€è¦DRMç®¡ç† è¿˜æœ‰å¾ˆå¤šå…¶ä»–çš„â€¦ å°½ç®¡å¦‚æ­¤ï¼Œå¤æ‚çš„webå…¼å®¹è§†é¢‘æ’­æ”¾å™¨ä»ç„¶åŸºäºŽMediaSourceå’Œsourcebufferã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆè¿™äº›ä»»åŠ¡é€šå¸¸æ˜¯ç”±åº“æ‰§è¡Œçš„ï¼Œåº“å°±æ˜¯è¿™æ ·åšçš„ã€‚é€šå¸¸ï¼Œè¿™äº›åº“ç”šè‡³ä¸å®šä¹‰ç”¨æˆ·ç•Œé¢ã€‚å®ƒä»¬å¤§å¤šæä¾›ä¸°å¯Œçš„apiï¼Œå°†Manifestå’Œå„ç§é¦–é€‰é¡¹ä½œä¸ºå‚æ•°ï¼Œå¹¶åœ¨æ­£ç¡®çš„æºç¼“å†²åŒºçš„æ­£ç¡®æ—¶é—´æŽ¨é€æ­£ç¡®çš„ç‰‡æ®µã€‚ è¿™ä½¿å¾—åœ¨è®¾è®¡åª’ä½“ç½‘ç«™å’Œwebåº”ç”¨ç¨‹åºæ—¶å…·æœ‰æ›´å¤§çš„æ¨¡å—åŒ–å’Œçµæ´»æ€§ï¼Œè¿™åœ¨æœ¬è´¨ä¸Šå°†æ˜¯å¤æ‚çš„å‰ç«¯ã€‚]]></content>
      <categories>
        <category>web</category>
      </categories>
      <tags>
        <tag>è¯‘æ–‡</tag>
        <tag>æ’­æ”¾å™¨</tag>
        <tag>HTML5</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[æ¼«è°ˆWeb--H5å”¤é†’]]></title>
    <url>%2Fweb%2FLP20190802A%2F</url>
    <content type="text"><![CDATA[â€œThere is no silver bulletâ€ â€”Fred Brooks å‰è¨€åœ¨ä¿¡æ¯çˆ†ç‚¸çš„æ—¶ä»£ï¼Œè®©å®¢æˆ·ä¸»åŠ¨åŽ»æœç´¢å‘çŽ°ï¼Œå·²ç»è¶Šæ¥è¶Šéš¾äº†ã€‚å¦‚ä½•è®©ç²¾å‡†ç”¨æˆ·åŽ»ä¸»åŠ¨å‘çŽ°ï¼Œæˆä¸ºAPPè¿è¥çš„æ ¸å¿ƒï¼Œä¹Ÿæ˜¯APPæŽ¨å¹¿çš„é‡ç‚¹ï¼Œç‰¹åˆ«æ˜¯åœ¨ç§»åŠ¨äº’è”ç½‘çš„æ—¶ä»£ï¼Œç¤¾äº¤æˆä¸ºè¥é”€çš„æ ¸å¿ƒï¼ŒAPPå¼•æµæ˜¯ä¸€å¤§äº®ç‚¹ï¼Œè¿™é‡Œå¼•æµæœ‰ä¸¤ç§å½¢å¼ï¼Œå¼•å¯¼å·²ä¸‹è½½ç”¨æˆ·æ‰“å¼€APPï¼Œå¼•å¯¼æœªä¸‹è½½ç”¨æˆ·ä¸‹è½½APPã€‚ä»ŽæŠ€æœ¯çš„å±‚é¢æ¥è¯´ï¼Œå°±éœ€è¦ä¸€ä¸ªåˆç†å¯è¡Œçš„æ–¹æ¡ˆæ¥è§£å†³å¦‚ä½•ä»ŽH5ï¼ˆç½‘é¡µï¼‰ä¸­å”¤é†’APPï¼ŒåŒæ—¶åˆèƒ½ç»™äºˆç”¨æˆ·ç›´è§‚ä¸”ä¼˜é›…çš„ä½“éªŒã€‚ æµè§ˆå™¨ä¸ŽAPPå…¶å®žäºŒè€…å½¼æ­¤æ ¹æœ¬å°±æ˜¯é£Žé©¬ç‰›ä¸ç›¸åŠï¼Œæµè§ˆå™¨ä¹Ÿå¯ä»¥çœ‹ä½œæ˜¯ä¸€ä¸ªåº”ç”¨ç¨‹åºï¼Œåªä¸è¿‡APPä¸­å¯ä»¥é€šè¿‡WebViewæŽ§ä»¶æ¥èŽ·å¾—å±•ç¤ºwebé¡µé¢çš„åŠŸèƒ½ã€‚ä¸ç®¡åœ¨iOSè¿˜æ˜¯Androidä¸Šï¼Œåœ¨æµè§ˆå™¨ä¸­è¿è¡Œçš„çš„ç½‘é¡µï¼ˆè„šæœ¬ï¼‰éƒ½æ— æ³•ç›´æŽ¥èŽ·å–æœ¬æœºAPPç›¸å…³ä¿¡æ¯ã€‚ ä¸€èˆ¬æ¥è¯´ï¼Œæˆ‘ä»¬ä½¿ç”¨çš„æ™ºèƒ½è®¾å¤‡ä¸Šæœ‰è®¸å¤šæˆ‘ä»¬çš„ä¸ªäººä¿¡æ¯ã€‚æ¯”å¦‚ï¼šè”ç³»æ–¹å¼ã€é“¶è¡Œå¡/ä¿¡ç”¨å¡ä¿¡æ¯ã€æ”¯ä»˜å®/Paypal/å„å¤§å•†åŸŽçš„è´¦æˆ·å¯†ç ã€ç…§ç‰‡ç”šè‡³è¡Œç¨‹ä¸Žä½ç½®ä¿¡æ¯ç­‰ï¼Œå¦‚ä½•è®©è¿™äº›ä¿¡æ¯ä»…åœ¨è®¾å¤‡æ‰€æœ‰è€…æœ¬äººçŸ¥æƒ…å¹¶å…è®¸çš„æƒ…å†µä¸‹è¢«ä½¿ç”¨ï¼Œæ˜¯æ‰€æœ‰æ™ºèƒ½è®¾å¤‡ä¸Žæ“ä½œç³»ç»Ÿæ‰€è¦åœ¨ä¹Žçš„æ ¸å¿ƒå®‰å…¨é—®é¢˜ã€‚é’ˆå¯¹è¿™ä¸ªé—®é¢˜ï¼ŒiOSä½¿ç”¨äº†æ²™ç›’æœºåˆ¶ç›®çš„å°±æ˜¯è®©APPåªèƒ½è®¿é—®å®ƒå£°æ˜Žå¯èƒ½è®¿é—®çš„èµ„æºã€‚ URL Schemeæ–°æŠ€æœ¯çš„äº§ç”Ÿæ˜¯ä¸ºäº†è§£å†³é—®é¢˜ï¼Œè§£å†³é—®é¢˜çš„åŒæ—¶å¯èƒ½ä¹Ÿä¼šäº§ç”Ÿæ–°çš„é—®é¢˜ï¼Œæ¯•ç«Ÿæ²¡æœ‰é“¶å¼¹ã€‚åœ¨ä¿éšœä¿¡æ¯å®‰å…¨æ–¹é¢æ²™ç›’æ˜¯ä¸ªå¾ˆå¥½çš„è§£å†³åŠžæ³•ï¼Œä½†ä¹Ÿé˜»ç¢äº†åº”ç”¨é—´åˆç†çš„ä¿¡æ¯å…±äº«ã€‚URL Schema åº”è¿è€Œç”Ÿã€‚ ä»€ä¹ˆæ˜¯URL Schemeå¯¹æ¯”æˆ‘ä»¬ç†Ÿæ‚‰çš„ç½‘å€URLï¼ŒSchemaå…¶å®žå°±æ˜¯ä¸€ç§ç‰¹æ®Šçš„URLã€‚ [scheme://][host][path][?query][#fragment]https://www.baidu.com/s?wd=paopaolee åƒå®šä½ä¸€ä¸ªç½‘é¡µä¸€æ ·ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨URL Schemeå®šä½ä¸€ä¸ªAPPç”šè‡³APPé‡ŒæŸä¸ªå…·ä½“çš„åŠŸèƒ½ã€‚ scheme://[path][?query] å…¶ä¸­Schemeå¯¹åº”APPæ ‡è¯†ï¼Œ pathå¯¹åº”APPçš„æŸä¸ªåŠŸèƒ½ï¼Œqueryå³ä¸ºåŠŸèƒ½æ‰€éœ€å‚æ•°ã€‚è¿™é‡Œåˆ—ä¸¾å‡ºä¸€äº›å¸¸ç”¨APP URL Scheme è™½ç„¶URL Schemeç±»ä¼¼äºŽç½‘é¡µURLï¼Œä½†ä¸¤è€…è¿˜æ˜¯æœ‰å¾ˆå¤§åŒºåˆ«çš„ï¼Œå…¶ä¸­ï¼š ç½‘é¡µéƒ½æœ‰è‡ªå·±çš„ç½‘å€ï¼Œè€ŒAPPä¸ä¸€å®šæœ‰è‡ªå·±çš„URL Scheme, ä¸€ä¸ª App æ˜¯å¦æ”¯æŒ URL Schemeså–å†³äºŽAppå¼€ä½œè€…æ˜¯å¦æ·»åŠ äº† URL Schemesç›¸å…³çš„ä»£ç ã€‚ ç½‘é¡µä¸Žç½‘å€æ˜¯ä¸€ä¸€å¯¹åº”çš„å…³ç³»ï¼Œä½†æ˜¯ç”±äºŽè‹¹æžœæ²¡æœ‰å¯¹URL Schemesåšå”¯ä¸€æ€§ç¡¬æ€§è¦æ±‚ï¼Œæ•…å¹¶éžæ¯ä¸ªURL Schemeséƒ½åªå¯¹åº”ä¸€æ¬¾åº”ç”¨ã€‚(è¿™å¯èƒ½ä¼šå¯¼è‡´ä¸¥é‡çš„å®‰å…¨æ€§é—®é¢˜) APPå¯ä»¥å‘å®¿ä¸»æ“ä½œç³»ç»Ÿæ³¨å†Œä¸€ä¸ªURL Schemeï¼Œè¯¥schemeç”¨äºŽä»Žæµè§ˆå™¨æˆ–å…¶ä»–åº”ç”¨ä¸­å¯åŠ¨æœ¬åº”ç”¨ï¼Œé€šè¿‡schemeåè®®æ¥è·³è½¬åˆ°ç›¸åº”çš„APPç•Œé¢ï¼Œæ¯”å¦‚å•†å“è¯¦æƒ…ï¼Œæ´»åŠ¨è¯¦æƒ…ï¼Œå•†å®¶è¯¦æƒ…ç­‰ç­‰ç•Œé¢ã€‚ä¹Ÿå¯ä»¥æ‰§è¡ŒæŸäº›æŒ‡å®šåŠ¨ä½œï¼Œå¦‚å®Œæˆæ”¯ä»˜ç­‰ã€‚ä¹Ÿå¯ä»¥åœ¨åº”ç”¨å†…éƒ¨é€šè¿‡H5é¡µé¢æ¥ç›´æŽ¥è·³è½¬APPæŸä¸ªç•Œé¢ã€‚ URL Schemeåº”ç”¨åœºæ™¯ APPæ ¹æ®æœåŠ¡å™¨ä¸‹å‘URL Schemeè·³è½¬ç›¸åº”çš„é¡µé¢ ç½‘é¡µæˆ–H5é¡µé¢é€šè¿‡URL Schemeå¯åŠ¨ç›¸åº”APPå¹¶ä¸”å¯ä»¥è·³è½¬å…·ä½“é¡µé¢ APPé€šè¿‡URL Schemeè·³è½¬åˆ°å¦å¤–ä¸€ä¸ªAPPæŒ‡å®šé¡µé¢URL Schemeçš„ä¸è¶³ä¹‹å¤„ çŽ°å¦‚ä»Šè¯¸å¦‚å¾®ä¿¡ã€å¾®åšç­‰ä¸»æµçš„APPï¼Œå·²ç»å±è”½æŽ‰äº†URL Scheme iOSä¸­ä½¿ç”¨URL Schemeå”¤é†’APPæ—¶ï¼Œä¼šå‡ºçŽ°å¼¹çª—æç¤ºï¼Œå¹¶ä¸”å¤±è´¥ä¹Ÿä¼šå‡ºçŽ°æç¤ºçª—ï¼Œç”¨æˆ·ä½“éªŒä¸å¤ªå‹å¥½ã€‚ ä½¿ç”¨URL Schemeå”¤é†’APPæ—¶ï¼Œæ— æ³•å¾—çŸ¥æ˜¯å¦å”¤é†’æˆåŠŸã€‚Android IntentURL Schemeåœ¨Androidçš„Chromeæµè§ˆå™¨ä¸­å­˜åœ¨å¾ˆå¤§å·®å¼‚ï¼Œåœ¨18åŠä¹‹å‰çš„ç‰ˆæœ¬ä¸­çš„ï¼ŒURL Schemeèƒ½å¤Ÿæ­£å¸¸å·¥ä½œï¼Œä½†æ˜¯ä»Žç‰ˆæœ¬25ä»¥åŽï¼Œé€šè¿‡URL Schemeå·²ç»æ— æ³•å¯åŠ¨ä¸€ä¸ªandroid appäº†ã€‚å–è€Œä»£ä¹‹æ˜¯android æä¾›äº†Intentæ–¹æ¡ˆã€‚ä»€ä¹ˆæ˜¯IntentAndroidä¸­æä¾›äº†Intentæœºåˆ¶æ¥ååŠ©APPé—´çš„äº¤äº’ä¸Žé€šè®¯ã€‚å½“ç„¶ï¼Œå®ƒä¸ä»…å¯ç”¨äºŽåº”ç”¨ç¨‹åºä¹‹é—´ï¼Œä¹Ÿå¯ç”¨äºŽåº”ç”¨ç¨‹åºå†…éƒ¨çš„ Activity / Serviceä¹‹é—´çš„äº¤äº’ã€‚å®ƒå¯ä»¥æ›´çµæ´»åœ°æŽ§åˆ¶åº”ç”¨ç¨‹åºçš„å¯åŠ¨æ–¹å¼ï¼Œå¹¶ä¸”å¯ä»¥é€šè¿‡Intent Extraså°†é¢å¤–ä¿¡æ¯ä¼ é€’åˆ°APPã€‚è¿›ä¸€æ­¥äº†è§£IntentåŸºæœ¬è¯­æ³•åŸºäºŽIntentçš„URIåŸºæœ¬æ ¼å¼å¦‚ä¸‹ï¼š123456789intent: HOST/URI-path // Optional host #Intent; package=[string]; action=[string]; category=[string]; component=[string]; scheme=[string]; end; å½“æ— æ³•è§£æžIntentæˆ–æ— æ³•å¯åŠ¨å¤–éƒ¨APPæ—¶ï¼Œé»˜è®¤ä¼šè·³è½¬åˆ°ç³»ç»Ÿé»˜è®¤çš„åº”ç”¨ç¨‹åºå•†åº—ï¼Œå½“ç„¶ä½ ä¹Ÿå¯ä»¥é€šè¿‡ä¸‹æ–¹çš„ä»£ç é€‰æ‹©ç»™Intentå®šä¹‰ä¸€ä¸ªå›žè°ƒURLï¼Œè¿™æ ·å¤±è´¥æ—¶ä¼šå°†ç”¨æˆ·é‡å®šå‘åˆ°å®šä¹‰çš„å›žè°ƒURLã€‚ 1S.browser_fallback_url=[encoded_full_url] ç¤ºä¾‹ä¸ºäº†å¯åŠ¨ZxingäºŒç»´ç æ‰«æAPPï¼Œå¯ä»¥é€šè¿‡å¦‚ä¸‹çš„æ–¹å¼ï¼š 1&lt;a href=&quot;intent://scan/#Intent;scheme=zxing;package=com.google.zxing.client.android;S.browser_fallback_url=http%3A%2F%2Fzxing.org;end&quot;&gt; Take a QR code &lt;/a&gt; å¯¹åº”çš„Intentå¦‚ä¸‹ï¼š 123456intent: //scan/ #Intent; package=com.google.zxing.client.android; scheme=zxing; end; å…¶ä¸­//scan/å¯¹åº”HOST/URL-path, com.google.zxing.client.android;å¯¹åº”package, zxingå¯¹åº”schemeï¼Œè¿™äº›å‚æ•°éƒ½æ˜¯åœ¨APPå¼€å‘é…ç½®åœ¨Manifestä¸­çš„ã€‚ Universal Linkåœ¨iOS9ä¹‹å‰ï¼Œå¯¹äºŽä»Žå„ç§ä»Žæµè§ˆå™¨ã€Safariä¸­å”¤é†’APPçš„éœ€æ±‚ï¼Œæˆ‘ä»¬é€šå¸¸åªèƒ½ä½¿ç”¨URL Schemeã€‚ä½†æ˜¯æ­£å¦‚æˆ‘ä»¬ä¸Šé¢æ‰€è¯´ï¼ŒURL Schemeæœ‰å®ƒè‡ªèº«çš„ä¸è¶³ã€‚å…¶ä¸­æœ€ä¸»è¦çš„æ˜¯å®ƒå¹¶æ²¡æœ‰å¼ºåˆ¶å”¯ä¸€ï¼Œè¿™å¯èƒ½ä¼šå¸¦æ¥å®‰å…¨é—®é¢˜ã€‚ ä»€æ˜¯Universal LinkUniversal Linkæ˜¯iOS9æŽ¨å‡ºçš„ä¸€é¡¹åŠŸèƒ½ï¼Œä½¿ä½ å¯ä»¥é€šè¿‡ä¼ ç»Ÿçš„HTTPé“¾æŽ¥æ¥å¯åŠ¨APP(å¦‚æžœiOSè®¾å¤‡ä¸Šå·²ç»å®‰è£…äº†ä½ çš„appï¼Œä¸ç®¡åœ¨å¾®ä¿¡é‡Œè¿˜æ˜¯åœ¨å“ªé‡Œ)ï¼Œ æˆ–è€…æ‰“å¼€ç½‘é¡µ(iOSè®¾å¤‡ä¸Šæ²¡æœ‰å®‰è£…ä½ çš„app)ã€‚è¯¥æ–¹æ¡ˆè¾ƒurl schemeæœ‰æ˜Žæ˜¾çš„æ”¹å–„ã€‚URL Schemeå¾ˆéš¾åšåˆ°å”¯ä¸€ï¼Œè€Œuniversal linkå´æ˜¯ä½ è‡ªå·±æŽ§åˆ¶çš„ï¼Œè€Œä¸”Universal Linkå®žçŽ°äº†web-appæ— ç¼è¡”æŽ¥ï¼Œæ²¡æœ‰å¼¹çª—æç¤ºï¼Œç”¨æˆ·ä½“éªŒæ˜Žæ˜¾å¥½äºŽURL Schemeã€‚è¿›ä¸€æ­¥äº†è§£Universal Linké»˜è®¤åœ°ï¼ŒUniversal Linkèƒ½ç›´æŽ¥æ‰“å¼€å·²å®‰è£…çš„APPï¼Œæ— éœ€é€šè¿‡Safariã€‚å¦‚æžœç”¨æˆ·æ²¡æœ‰å®‰è£…å¯¹åº”çš„APPæ—¶ï¼Œä¸åŒäºŽSchemaï¼ŒUniversal Linkä¹Ÿæ˜¯ä¸€ä¸ªåˆæ³•çš„URLåœ°å€ï¼Œå¯ä»¥åœ¨Safariä¸­æ‰“å¼€ã€‚ Universal Link çš„ç‰¹ç‚¹ å”¯ä¸€æ€§: ä¸åƒè‡ªå®šä¹‰çš„URL Schemeï¼ŒUniversal ä¸èƒ½å¤Ÿè¢«å…¶å®ƒAPPå£°æ˜Žï¼Œå› ä¸ºå®ƒæ˜¯ä½¿ç”¨æ ‡å‡†çš„HTPPSæˆ–HTTPåè®®æ¥é“¾æŽ¥åˆ°ä½ çš„ç½‘ç«™ å®‰å…¨æ€§: å½“ç”¨æˆ·å®‰è£…æ‚¨çš„APPæ—¶ï¼ŒiOSä¼šæ£€æŸ¥æ‚¨ä¸Šä¼ åˆ°æ‚¨çš„webæœåŠ¡å™¨çš„æ–‡ä»¶ï¼Œä»¥ç¡®ä¿æ‚¨çš„ç½‘ç«™å…è®¸æ‚¨çš„APPåœ¨å…¶ä¸Šæ‰“å¼€ç½‘å€ã€‚å¹¶ä¸”åªæœ‰æ‚¨å¯ä»¥åˆ›å»ºå¹¶ä¸Šä¼ æ­¤æ–‡ä»¶ï¼Œå› æ­¤æ‚¨çš„ç½‘ç«™ä¸ŽAPPçš„å…³è”æ˜¯å®‰å…¨çš„ çµæ´»æ€§: å³ä½¿ä½ æ²¡æœ‰å®‰è£…å¯¹åº”çš„APPï¼ŒUniversal Linkä¹Ÿèƒ½åœ¨Safariä¸­æ‰“å¼€å†…å®¹ã€‚ ç®€å•è¡Œ: ä¸€ä¸ªURLå°±èƒ½ä½¿ç”¨æˆ·åœ¨ç½‘ç«™å’ŒAPPé—´åˆ‡æ¢ã€‚ ç§å¯†æ€§: å…¶å®ƒAPPæ— éœ€çŸ¥æ™“ä½ çš„APPæ˜¯å¦å·²ç»å®‰è£…ä¹Ÿèƒ½é€šä¿¡ âš ï¸ï¼š å½“ç”¨æˆ·åœ¨Safariä¸­æµè§ˆæ‚¨çš„ç½‘ç«™å¹¶ç‚¹å‡»äº†ä¸Žå½“å‰ç½‘é¡µåŒåŸŸçš„Universal Linkæ—¶ï¼ŒiOSä¼šç›´æŽ¥åœ¨Safariä¸­æ‰“å¼€è¯¥é“¾æŽ¥ã€‚å¦‚æžœæ˜¯ä¸åŒåŸŸçš„Universal Linkï¼ŒiOSæ‰ä¼šå°è¯•åœ¨æ‚¨çš„APPä¸­æ‰“å¼€ã€‚ ä»ŽåŠ è½½è¿‡ç¨‹åˆ†æžUniversal Linkçš„ä¸è¶³ä¸€ä¸ªç¡¬æ€§çš„ä¸è¶³åœ¨äºŽï¼ŒUniversal Linkåªåœ¨iOS9æ‰å¼€å§‹æ”¯æŒï¼Œé™¤æ­¤ä¹‹å¤–æˆ‘ä»¬è¯´Universal å°±æ˜¯æ ‡å‡†çš„HTTPSæˆ–HTTPé“¾æŽ¥ï¼Œé‚£ä¹ˆæˆ‘ä»¬å…ˆæ¥çœ‹ä¸€ä¸‹ä¸€èˆ¬çš„URLåœ¨WebViewä¸­çš„åŠ è½½è¿‡ç¨‹ï¼Œå¦‚å›¾æ‰€ç¤ºä»Žè§£æžURLåˆ°é¡µé¢åŠ è½½å®Œæˆçš„è¿‡ç¨‹ï¼šé‚£ä¹ˆUniversal Link åŠ è½½è¿‡ç¨‹åˆæ˜¯å¦‚ä½•çš„å‘¢ï¼Ÿç›¸ä¿¡å¤§å®¶å¯ä»¥çœ‹åˆ°ï¼ŒUniversal LinkåŠŸèƒ½æ˜¯å¾ˆå®¹æ˜“è¢«å°é”æŽ‰çš„ï¼Œåªéœ€è¦åœ¨APPä¸­åˆ¤æ–­ä½ çš„åŸŸåæ˜¯å¦åœ¨å…¶å…è®¸çš„ã€‚çŽ°å¦‚ä»Šå¾ˆå¤šä¸»æµçš„APPï¼Œå®ƒä»¬å„è‡ªç»´æŠ¤ç€ä¸€ä»½ç™½åå•ï¼Œé™¤éžä½ åœ¨å®ƒçš„ç™½åå•å†…ï¼Œå¦åˆ™éƒ½ä¼šå±è”½æŽ‰å”¤é†’æ“ä½œã€‚å°¤å…¶æ˜¯å¾®ä¿¡ï¼Œé™¤éžè…¾è®¯ç³»çš„APPï¼Œå…¶å®ƒAPPéƒ½æ— æ³•ä»Žå¾®ä¿¡å†…å®¹ä¸­è¢«å”¤é†’ï¼Œæ‰€ä»¥æ·˜å®æŽ¨å‡ºäº†æˆ‘ä»¬ç†Ÿæ‚‰çš„æ·˜å£ä»¤ã€‚åº”ç”¨å®APP Linkè…¾è®¯åº”ç”¨å®å¯¹å¤–å¼€æ”¾äº†ä¸€ä¸ªå«åšAPP Link çš„ç”³è¯·ï¼Œåªè¦ä½ ç”³è¯·äº†APP Linkï¼Œå°±å¯ä»¥é€šè¿‡åœ¨æ‰“å¼€åº”ç”¨å®çš„æ—¶å€™åœ¨åº”ç”¨å®åœ°å€åŽé¢æ·»åŠ ä¸Š &amp;android_schema={your_scheme} ï¼Œæ¥æ‰“å¼€æŒ‡å®šçš„é¡µé¢äº†ã€‚è¿›ä¸€æ­¥äº†è§£åº”ç”¨å®APP Linkå”¤é†’APPçš„å…·ä½“å®žçŽ°ä¸Šé¢æˆ‘ä»¬ä»‹ç»äº†å‡ ç§å¯åŠ¨APPçš„è§£å†³æ–¹æ¡ˆï¼Œæ— è®ºæ˜¯ URL Scheme è¿˜æ˜¯ Intent æˆ–è€… Universal Linkã€APP Linkï¼Œä»–ä»¬éƒ½ç®—æ˜¯URL ï¼Œåªæ˜¯URL Scheme å’Œ Intent ç®—æ˜¯ç‰¹æ®Šçš„ URLã€‚æ‰€ä»¥æˆ‘ä»¬å¯ä»¥å¦‚åŒä½¿ç”¨URLçš„æ–¹æ³•æ¥ä½¿ç”¨å®ƒä»¬ã€‚ iframeiframeæ–¹æ¡ˆçš„å”¤é†’åŽŸç†æ˜¯: ç¨‹åºåˆ‡æ¢åˆ°åŽå°æ—¶ï¼Œè®¡æ—¶å™¨ä¼šè¢«æŽ¨è¿Ÿ(è®¡æ—¶å™¨ä¸å‡†çš„åˆä¸€ç§æƒ…å†µ)ã€‚å¦‚æžœappè¢«å”¤é†’é‚£ä¹ˆç½‘é¡µå¿…ç„¶å°±è¿›å…¥äº†åŽå°ï¼Œå¦‚æžœç”¨æˆ·ä»Žappåˆ‡å›žæ¥ï¼Œé‚£ä¹ˆæ—¶é—´ä¸€èˆ¬ä¼šè¶…è¿‡2s;è‹¥appæ²¡æœ‰è¢«å”¤èµ·ï¼Œé‚£ä¹ˆç½‘é¡µä¸ä¼šè¿›å…¥åŽå°ï¼ŒsetTimeoutåŸºæœ¬å‡†æ—¶è§¦å‘ï¼Œé‚£ä¹ˆæ—¶é—´ä¸ä¼šè¶…è¿‡2s 123456789101112131415161718192021222324var last = Date.now(), doc = window.document, ifr = doc.createElement('iframe');//åˆ›å»ºä¸€ä¸ªéšè—çš„iframeifr.src = nativeUrl;ifr.style.cssText = 'display:none;border:0;width:0;height:0;';doc.body.appendChild(ifr);setTimeout(function() &#123; doc.body.removeChild(ifr); //setTimeoutå›žå°äºŽ2000ä¸€èˆ¬ä¸ºå”¤èµ·å¤±è´¥ if (Date.now() - last &lt; 2000) &#123; if (typeof onFail == 'function') &#123; onFail(); &#125; else &#123; //å¼¹çª—æç¤ºæˆ–ä¸‹è½½å¤„ç†ç­‰ &#125; &#125; else &#123; if (typeof onSuccess == 'function') &#123; onSuccess(); &#125; &#125;&#125;, 1000); åœ¨åªæœ‰ URL Scheme çš„æ—¥å­é‡Œï¼Œiframe æ˜¯ä½¿ç”¨æœ€å¤šçš„äº†ã€‚å› ä¸ºåœ¨æœªå®‰è£… app çš„æƒ…å†µä¸‹ï¼Œä¸ä¼šåŽ»è·³è½¬é”™è¯¯é¡µé¢ã€‚ä½†æ˜¯iframe åœ¨å„ä¸ªç³»ç»Ÿä»¥åŠå„ä¸ªåº”ç”¨ä¸­çš„å…¼å®¹é—®é¢˜è¿˜æ˜¯æŒºå¤šçš„ï¼Œä¸èƒ½å…¨éƒ¨ä½¿ç”¨ URL Schemeã€‚ aæ ‡ç­¾1&lt;a href="intent://scan/#Intent;scheme=zxing;package=com.google.zxing.client.android;end""&gt;æ‰«ä¸€æ‰«&lt;/a&gt; window.location1window.location.href = 'sinaweibo://qrcode'; âš ï¸ï¼š URL Schemeåœ¨ios 9+ä¸Šè¯¸å¦‚ safariã€UCã€QQæµè§ˆå™¨ä¸­ï¼Œ iframe å‡æ— æ³•æˆåŠŸå”¤èµ·APPï¼Œåªèƒ½é€šè¿‡ window.locationæ‰èƒ½æˆåŠŸå”¤ç«¯ã€‚å½“ç„¶ï¼Œå¦‚æžœAPPæ”¯æŒUniversal Linkï¼Œios 9+å°±ç”¨ä¸åˆ°URL Schemeäº†ã€‚è€Œ Universal Link åœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­ï¼Œæˆ‘å‘çŽ°åœ¨ qq ä¸­ï¼Œæ— è®ºæ˜¯ iframe å¯¼èˆª è¿˜æ˜¯ a æ ‡ç­¾æ‰“å¼€åˆæˆ–è€… window.locationéƒ½æ— æ³•æˆåŠŸå”¤ç«¯ï¼Œä¸€å¼€å§‹æˆ‘ä»¥ä¸ºæ˜¯ qq å’Œå¾®ä¿¡ä¸€æ ·ç¦æ­¢äº† Universal Link å”¤ç«¯çš„åŠŸèƒ½ï¼Œå…¶å®žä¸ç„¶ï¼Œç™¾èˆ¬è¯•éªŒä¸‹ï¼Œé€šè¿‡top.locationå”¤ç«¯æˆåŠŸäº†ã€‚ æ€»ç»“åœ¨å”¤é†’åŠŸèƒ½çš„å®žçŽ°ä¸Šæ²¡æœ‰å®Œç¾Žé€šç”¨çš„è§£å†³æ–¹æ¡ˆï¼Œæˆ‘ä»¬åªèƒ½æ ¹æ®ç‰¹å®šçš„ä¸šåŠ¡ï¼Œåœ¨ä»£ç å±‚ä¸Šç¡®ä¿èƒ½å¤Ÿè¦†ç›–æœ€å¸¸ç”¨çš„åœºæ™¯ã€‚è¿™é‡ŒæŽ¨èä½ ä¸¤ä¸ªè¾ƒä¸ºé€šç”¨çš„è§£å†³æ–¹æ¡ˆcall-libå’Œweb-launch-appã€‚ å‚è€ƒæ–‡ç«  H5å”¤èµ·APPæŒ‡å— H5å”¤èµ·APP]]></content>
      <categories>
        <category>web</category>
      </categories>
      <tags>
        <tag>JavaScript</tag>
        <tag>Browser</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Setã€Mapã€WeakSetã€WeakMapçš„åŒºåˆ«]]></title>
    <url>%2Fweb%2FLP20190710A%2F</url>
    <content type="text"><![CDATA[â€œGood programmers use their brains, but good guidelines save us having to think out every case.â€â€”Francis Glassborow å‰è¨€ å¤§å¤šæ•°ä¸»æµç¼–ç¨‹è¯­è¨€éƒ½æœ‰å¤šç§å†…ç½®çš„æ•°æ®é›†åˆã€‚ä¾‹å¦‚Pythonæ‹¥æœ‰åˆ—è¡¨ï¼ˆlistï¼‰ã€å…ƒç»„ï¼ˆtupleï¼‰å’Œå­—å…¸ï¼ˆdictionaryï¼‰,Javaæœ‰åˆ—è¡¨ï¼ˆlistï¼‰ã€é›†åˆï¼ˆset)ã€é˜Ÿåˆ—ï¼ˆqueueï¼‰ã€‚ç„¶è€ŒJavaScriptç›´åˆ°ES6çš„å‘å¸ƒä¹‹å‰ï¼Œåªæ‹¥æœ‰æ•°ç»„ï¼ˆarrayï¼‰å’Œå¯¹è±¡ï¼ˆobjectï¼‰è¿™ä¸¤ä¸ªå†…å»ºçš„æ•°æ®é›†åˆã€‚ES6çš„å‡ºçŽ°ï¼Œå¼•å…¥äº†è¯¸å¦‚Mapã€Setã€WeakeMapã€WeakMapç­‰æ–°çš„æ•°æ®ç»“æž„ä¸ºè¿™é—¨è¯­è¨€æ³¨å…¥äº†æ–°çš„èƒ½é‡å’Œæ´»åŠ›ã€‚ HashMapï¼ŒDictionaryç­‰æ•°æ®ç»“æž„æ˜¯å„ç§ç¼–ç¨‹è¯­è¨€å­˜å‚¨é”®/å€¼å¯¹çš„å‡ ç§æ–¹å¼ï¼Œè¿™äº›æ•°æ®ç»“æž„é’ˆå¯¹å¿«é€Ÿæ£€ç´¢è¿›è¡Œäº†ä¼˜åŒ–ã€‚å½“ç„¶ES6ä¸­çš„Mapã€Setã€WeakeMapã€WeakMapè¿™äº›æ•°æ®ç»“æž„åº•å±‚éƒ½æ˜¯é€šè¿‡ï¼ˆhash tablesï¼‰æ•£åˆ—è¡¨å®žçŽ°çš„ã€‚ Mapåœ¨ES5ä¸­,æˆ‘ä»¬é€šå¸¸ä½¿ç”¨å†…ç½®çš„Objectï¼ˆå®ƒä»¬åªæ˜¯å…·æœ‰é”®å’Œå€¼çš„å±žæ€§çš„ä»»æ„é›†åˆï¼‰æ¨¡æ‹ŸMapã€‚ä½†æ˜¯è¿™æ ·åšä¼šæœ‰ä¸‰ä¸ªç¼ºé™·ã€‚ JavaScriptä¸­Objectçš„å±žæ€§é”®æ˜¯Stringæˆ–Symbolï¼Œè¿™é™åˆ¶äº†å®ƒä»¬ä½œä¸ºä¸åŒæ•°æ®ç±»åž‹çš„é”®/å€¼å¯¹é›†åˆçš„èƒ½åŠ›ã€‚å½“ç„¶ï¼Œæ‚¨å¯ä»¥å°†å…¶ä»–æ•°æ®ç±»åž‹å¼ºåˆ¶/å­—ç¬¦ä¸²åŒ–ä¸ºå­—ç¬¦ä¸²ï¼Œä½†è¿™ä¼šå¢žåŠ é¢å¤–çš„å·¥ä½œé‡ã€‚ Objectä¸æ˜¯è®¾è®¡æ¥ä½œä¸ºä¸€ç§æ•°æ®é›†åˆï¼Œå› æ­¤æ²¡æœ‰æœ‰æ•ˆçš„æ–¹æ³•æ¥ç¡®å®šå¯¹è±¡å…·æœ‰å¤šå°‘å±žæ€§(è™½ç„¶æœ‰Object.keysï¼Œä½†æ˜¯å®ƒå¾ˆæ…¢ï¼‰ã€‚å¾ªçŽ¯éåŽ†å¯¹è±¡çš„å±žæ€§æ—¶ï¼Œè¿˜ä¼šèŽ·å¾—å…¶åŽŸåž‹å±žæ€§ã€‚æ‚¨å¯ä»¥å°†iterableå±žæ€§æ·»åŠ åˆ°æ‰€æœ‰å¯¹è±¡ï¼Œä½†ä¸æ˜¯æ‰€æœ‰å¯¹è±¡éƒ½å¯ä»¥ç”¨ä½œé›†åˆã€‚æ‚¨å¯ä»¥ä½¿ç”¨for â€¦ inå¾ªçŽ¯å’ŒhasOwnPropertyï¼ˆï¼‰æ–¹æ³•ï¼Œä½†è¿™åªæ˜¯ä¸€ç§è§£å†³æ–¹æ³•ã€‚å¾ªçŽ¯è®¿é—®å¯¹è±¡çš„å±žæ€§æ—¶ï¼Œä¸ä¸€å®šæŒ‰ç…§æ’å…¥çš„é¡ºåºæ£€ç´¢å±žæ€§ã€‚ Objectå…·æœ‰å†…ç½®æ–¹æ³•ï¼Œå¦‚constructorï¼ŒtoStringå’ŒvalueOfã€‚å¦‚æžœå…¶ä¸­ä¸€ä¸ªä½œä¸ºå±žæ€§æ·»åŠ ï¼Œåˆ™å¯èƒ½å¯¼è‡´å†²çªã€‚è™½ç„¶æ‚¨å¯ä»¥ä½¿ç”¨Object.create(null)æ¥åˆ›å»ºä¸€ä¸ªè£¸å¯¹è±¡ï¼ˆå®ƒä¸ä»Žobject.prototypeç»§æ‰¿ï¼‰ï¼Œä½†æ˜¯è¿™åªæ˜¯ä¸€ä¸ªå˜é€šæ–¹æ³•ã€‚ MDNå¯¹Mapå®šä¹‰: Mapå¯¹è±¡ä¿å­˜é”®å€¼å¯¹å¹¶è®°ä½é”®çš„åŽŸå§‹æ’å…¥é¡ºåºã€‚ä»»ä½•å€¼ï¼ˆå¯¹è±¡å’ŒåŽŸå§‹å€¼ï¼‰éƒ½å¯ä»¥ç”¨ä½œé”®æˆ–å€¼.å…¶ä¸­keyå€¼çš„å¯¹æ¯”æ˜¯åŸºäºŽä¸€ç§ç±»ä¼¼äºŽ===æ“ä½œç¬¦çš„ç®—æ³•ï¼Œä¸è¿‡NaNè¢«è®¤ä¸ºä¸Žè‡ªèº«ç›¸ç­‰ï¼ˆå°½ç®¡JSä¸­NaN!==NaNï¼Œå› æ­¤Mapä¸­å¯ä»¥ä½¿ç”¨NaNä½œä¸ºkey;&nbsp;Mapä¸­çš„é”®å€¼å¯¹æ˜¯æœ‰åºçš„,å› æ­¤åœ¨è¿­ä»£æ—¶çš„é¡ºåºä¸Žæ’å…¥æ—¶ä¸€è‡´ã€‚ æˆ‘ä»¬å¯ä»¥è½»æ¾åˆ›å»ºMapï¼Œæ·»åŠ /åˆ é™¤å€¼ï¼Œè¿­ä»£è®¿é—®é”®/å€¼å¹¶æœ‰æ•ˆç¡®å®šå…¶å¤§å°ã€‚ 1234567891011121314151617181920212223242526272829303132333435363738394041424344// new Map([iterable])let recipeMap = new Map([ ['Cucumber', '500 gr'], ['Tomatoes', '350 gr'],]);// Sets the value for the key in the Map object. Returns the Map object.recipeMap = recipeMap.set('Sour cream', '50 gr');// Returns a boolean asserting whether a value has been associated to the key in the Map object or not.console.log(recipeMap.has('Cucumber')); // true// loop by keysfor(let fruit of recipeMap.keys()) &#123; console.log(fruit); // Cucumber // Tomatoes // Sour cream&#125;// loop by values [key, value]for(let amount of recipeMap.values()) &#123; console.log(amount); // 500 gr // 350 gr // 50 gr&#125;// loop by recoedsfor(let entry of recipeMap) &#123; // same like recipeMap.entries() console.log(entry); // ["Cucumber", "500 gr"] // ["Tomatoes", "350 gr"] // ["Sour cream", "50 gr"]&#125;// Returns true if an element in the Map object existed and has been removed, or false if the element does not exist.console.log(recipeMap.delete('paopaolee')); // false // Removes all key/value pairs from the Map object.recipeMap.clear(); // Returns the number of key/value pairs in the Map object.console.log(recipeMap.size === 0); // True SetMDNå¯¹Mapå®šä¹‰: Setç®€å•æ¥è¯´å°±æ˜¯ä¸åŒ…å«é‡å¤é¡¹çš„å€¼çš„æœ‰åºé›†åˆï¼Œå®ƒå…è®¸æ‚¨å­˜å‚¨ä»»ä½•ç±»åž‹ï¼Œæ— è®ºæ˜¯åŽŸå§‹å€¼è¿˜æ˜¯å¯¹è±¡å¼•ç”¨ï¼Œä¸åƒæ•°ç»„é‚£æ ·ä½¿ç”¨ç´¢å¼•ï¼ŒSetä½¿ç”¨Keyè®¿é—®é›†åˆã€‚Setå·²ç»å­˜åœ¨äºŽJavaï¼ŒRubyï¼ŒPythonå’Œè®¸å¤šå…¶ä»–è¯­è¨€ä¸­ã€‚ ES6çš„Setä¸Žå…¶ä»–è¯­è¨€ä¹‹é—´çš„ä¸€ä¸ªåŒºåˆ«åœ¨äºŽES6ä¸­çš„Setæ˜¯æœ‰åºçš„ã€‚ 123456789101112131415161718const planetsOrderFromSun = new Set();planetsOrderFromSun.add('Mercury');planetsOrderFromSun.add('Venus').add('Earth').add('Mars'); // Chainable Methodconsole.log(planetsOrderFromSun.has('Earth')); // TrueplanetsOrderFromSun.delete('Mars');console.log(planetsOrderFromSun.has('Mars')); // Falsefor (const x of planetsOrderFromSun) &#123; console.log(x); // Same order in as out - Mercury Venus Earth&#125;console.log(planetsOrderFromSun.size); // 3planetsOrderFromSun.add('Venus'); // Trying to add a duplicateconsole.log(planetsOrderFromSun.size); // Still 3, Did not add the duplicateplanetsOrderFromSun.clear();console.log(planetsOrderFromSun.size); // 0 å¼±é›†åˆï¼Œå†…å­˜å’Œåžƒåœ¾å›žæ”¶JavaScriptåžƒåœ¾å›žæ”¶æœºåˆ¶æ˜¯ä¸€ç§å†…å­˜ç®¡ç†å½¢å¼ï¼Œå¯ä»¥è‡ªåŠ¨åˆ é™¤ä¸å†å¼•ç”¨çš„å¯¹è±¡å¹¶å›žæ”¶å…¶èµ„æºã€‚ JSä¸­ï¼Œå½“ä¸€ä¸ªå¯¹è±¡è¢«å¼•ç”¨çš„æ—¶å€™ï¼Œå¾€å¾€æ„å‘³ç€å®ƒæ­£åœ¨è¢«ä½¿ç”¨ï¼Œæˆ–è€…åœ¨å°†æ¥æœ‰å¯èƒ½ä¼šè¢«ä½¿ç”¨ã€‚æ­¤æ—¶å¯¹è±¡æ‰€å ç”¨çš„å†…å­˜ä¸ä¼šè¢«åžƒåœ¾å›žæ”¶æœºåˆ¶å›žæ”¶æŽ‰ã€‚Mapå’ŒSetæ‰€å¼•ç”¨çš„å¯¹è±¡ä¼šè¢«ä¿ç•™ï¼Œä¸å…è®¸è¿›è¡Œåžƒåœ¾å›žæ”¶ã€‚å¦‚æžœMapå’ŒSetå¼•ç”¨ç€ä¸å†éœ€è¦çš„å¤§å¯¹è±¡ï¼ˆä¾‹å¦‚å·²ç»ä»ŽDOMä¸­åˆ é™¤çš„DOMå…ƒç´ ï¼‰ï¼Œè¿™å¯èƒ½ä¼šæ¶ˆè€—å¤§é‡å†…å­˜ã€‚ &nbsp; ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒES6è¿˜å¼•å…¥äº†ä¸¤ä¸ªåä¸ºWeakMapå’ŒWeakSetçš„æ–°å¼±é›†åˆã€‚è¿™äº›ES6é›†åˆæ˜¯â€œå¼±â€çš„ï¼Œå› ä¸ºå®ƒä»¬å…è®¸ä»Žå†…å­˜ä¸­æ¸…é™¤ä¸å†éœ€è¦çš„å¯¹è±¡ã€‚ &nbsp;å¼±å¼•ç”¨åˆ™å¯ä»¥ç†è§£ä¸ºâ€œå¼•ç”¨äº†å¯¹è±¡ï¼Œä½†æ˜¯ä¸å½±å“å®ƒçš„åžƒåœ¾å›žæ”¶â€ï¼Œä¸¾ä¸ªðŸŒ°: 1234567var obj = &#123;&#125;;var wm = new WeakMap();wm.set(obj, 1);wm.get(obj); // 1......obj = null;wm.get(obj); // è¿™å¥æ²¡æœ‰æ„ä¹‰ åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼ŒWeakMapå®žä¾‹wmï¼ˆå¼±ï¼‰å¼•ç”¨äº†objå¯¹è±¡ï¼ˆç©ºå¯¹è±¡ï¼‰ï¼ŒæŽ¥ç€ä¸‹æ–¹ä»£ç é‡Šæ”¾äº†å¯¹ç©ºå¯¹è±¡çš„å¼•ç”¨ï¼ˆobj = nullï¼‰ï¼Œæ­¤æ—¶å’Œä¸Šä¾‹ä¸€æ ·ï¼Œç©ºå¯¹è±¡å°†è¢«åžƒåœ¾å›žæ”¶ã€‚ä¹Ÿå³wmä¸­æŒæœ‰çš„ç©ºå¯¹è±¡ï¼ˆå¼±ï¼‰å¼•ç”¨å¹¶ä¸å½±å“å¯¹å¯¹è±¡æœ¬èº«çš„åžƒåœ¾å›žæ”¶ã€‚è¿™å°±æ˜¯WeakMapä¸­â€œå¼±å¼•ç”¨â€çš„å«ä¹‰ã€‚ WeakMapMDNå¯¹Mapå®šä¹‰: WeakMapæ˜¯ä¸€ç§å¼±å¼•ç”¨keyçš„é”®å€¼å¯¹ï¼ˆkey/valueï¼‰é›†åˆï¼Œå…¶é”®ï¼ˆkeyï¼‰å¿…é¡»æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œå€¼ï¼ˆvalueï¼‰å¯ä»¥ä¸ºä»»æ„ç±»åž‹ã€‚æ­£ç”±äºŽè¿™æ ·çš„å¼±å¼•ç”¨ï¼ŒWeakMapçš„keyæ˜¯æ— æ³•æžšä¸¾çš„ (å³æ— æ³•åˆ—ä¸¾æ‰€æœ‰çš„key)ã€‚å¦‚æžœkeyæ˜¯å¯æžšä¸¾çš„è¯ï¼Œå…¶åˆ—è¡¨å°†ä¼šå—åžƒåœ¾å›žæ”¶æœºåˆ¶çš„å½±å“ï¼Œä»Žè€Œå¾—åˆ°ä¸ç¡®å®šçš„ç»“æžœã€‚æ‰€ä»¥æ— æ³•ä½¿ç”¨forâ€¦inæˆ–è€…forâ€¦ofç­‰è¯­å¥è¿­ä»£ã€‚ WeakMapä½¿ç”¨åœºæ™¯&nbsp;WeakMapsæœ‰å‡ ä¸ªæµè¡Œçš„ç”¨ä¾‹ã€‚å®ƒä»¬å¯ç”¨äºŽä¿æŒå¯¹è±¡çš„ç§æœ‰æ•°æ®ç§æœ‰åŒ–ï¼Œå®ƒä»¬è¿˜å¯ç”¨äºŽè·Ÿè¸ªDOMèŠ‚ç‚¹/å¯¹è±¡ã€‚ åœºæ™¯ä¸€ä½¿ç”¨WeakMapç®€åŒ–äº†ä¿æŒå¯¹è±¡æ•°æ®ç§æœ‰çš„è¿‡ç¨‹ã€‚privateDataå¯ä»¥å¼•ç”¨Personå¯¹è±¡ï¼Œä½†ä¸å…è®¸åœ¨æ²¡æœ‰ç‰¹å®šPersonå®žä¾‹çš„æƒ…å†µä¸‹è®¿é—®ï¼Œè€Œä¸”éšPersonå®žä¾‹å¯¹è±¡çš„é”€æ¯è€Œæ¶ˆå¤±ã€‚ 123456789101112var Person = (function() &#123; var privateData = new WeakMap(); function Person(name) &#123; privateData.set(this, &#123; name: name &#125;); &#125; Person.prototype.getName = function() &#123; return privateData.get(this).name; // åªèƒ½é€šè¿‡Personå®žä¾‹è®¿é—®å¯¹åº”çš„name &#125;; return Person();&#125;()); åœºæ™¯äºŒä½¿ç”¨WeakMapå¤„ç†äº‹ä»¶ç»‘å®š,åœ¨Reactä¸­å¦‚æžœç”¨åˆ°äº‹ä»¶ç›‘å¬å¤„ç†ï¼Œé€šå¸¸æˆ‘ä»¬å¿…é¡»è¦åœ¨å¯¹åº”çš„ç”Ÿå‘½å‘¨æœŸä¸­ç›¸åº”çš„è¿›è¡Œäº‹ä»¶ç»‘å®šæˆ–è§£é™¤ï¼Œä»¥é˜²æ­¢å†…å­˜æ³„æ¼ã€‚ç„¶è€Œå¦‚æžœä½¿ç”¨WeakMapï¼Œæˆ‘å¯ä»¥ä¸ç”¨æ‹…å¿ƒè¿™äº›é—®é¢˜ã€‚ 123456789101112131415161718192021222324var listeners = new WeakMap();// ç›‘å¬äº‹ä»¶function on(object, event, fn)&#123; var thisListeners = listeners.get(object); if(!thisListeners) thisListeners = &#123;&#125;; if(!thisListeners[event]) thisListeners[event] = []; thisListeners[event].push(fn); listeners.set(object, thisListeners);&#125;// è§¦å‘äº‹ä»¶function emit(object, event)&#123; var thisListeners = listeners.get(object); if(!thisListeners) thisListeners = &#123;&#125;; if(!thisListeners[event]) thisListeners[event] = []; thisListeners[event].forEach(function(fn)&#123; fn.call(object, event); &#125;);&#125;// ä½¿ç”¨var obj = &#123;&#125;;on(obj, 'hello', function()&#123; console.log('hello');&#125;);emit(obj, 'hello'); åœºæ™¯ä¸‰ä½¿ç”¨WeakMapè·Ÿè¸ªDOMèŠ‚ç‚¹ç¼–è¾‘ï¼Œåˆ é™¤å’Œæ›´æ”¹ã€‚ä¾‹å¦‚ï¼ŒGoogleçš„Polymeré¡¹ç›®åœ¨ä¸€æ®µåä¸ºPositionWalkerçš„ä»£ç ä¸­ä½¿ç”¨äº†WeakMap PositionWalker keeps track of a position within a DOM subtree, as a current node and an offset within that node. 12345678910111213141516171819202122_makeClone() &#123; this._containerClone = this.container.cloneNode(true); this._cloneToNodes = new WeakMap(); this._nodesToClones = new WeakMap(); ... let n = this.container; let c = this._containerClone; // find the currentNode's clone while (n !== null) &#123; if (n === this.currentNode) &#123; this._currentNodeClone = c; &#125; this._cloneToNodes.set(c, n); this._nodesToClones.set(n, c); n = iterator.nextNode(); c = cloneIterator.nextNode(); &#125;&#125; WeakSetMDNå¯¹Mapå®šä¹‰: WeakSetæ˜¯å¼±å¼•ç”¨çš„Setï¼Œå½“ä¸å†éœ€è¦å®ƒä»¬å¼•ç”¨çš„å¯¹è±¡æ—¶ï¼Œå®ƒä»¬çš„å…ƒç´ å¯ä»¥è¢«åžƒåœ¾æ”¶é›†ã€‚ WeakSetä¸å…è®¸è¿­ä»£ã€‚ 123456789101112var ws = new WeakSet();var foo = &#123;&#125;;var bar = &#123;&#125;;ws.add(foo);ws.add(bar);ws.has(foo); // truews.has(bar); // truews.delete(foo); // removes foo from the setws.has(foo); // false, foo has been removed WeakSetä½¿ç”¨åœºæ™¯WeakSetä½¿ç”¨åœºæ™¯ç›¸å½“æœ‰é™ï¼ˆè‡³å°‘ç›®å‰ä¸ºæ­¢ï¼‰ã€‚å¤§å¤šæ•°æ—©æœŸé‡‡ç”¨è€…éƒ½è¯´WeakSetå¯ç”¨äºŽæ ‡è®°å¯¹è±¡è€Œä¸ä¼šæ”¹å˜å®ƒä»¬ã€‚ES6-Features.orgæœ‰ä¸€ä¸ªæ·»åŠ å’Œåˆ é™¤WeakSetä¸­å…ƒç´ çš„ç¤ºä¾‹ï¼Œä»¥ä¾¿è·Ÿè¸ªå¯¹è±¡æ˜¯å¦å·²è¢«æ ‡è®°: 12345678910111213141516171819202122232425262728293031323334353637let isMarked = new WeakSet()let attachedData = new WeakMap()export class Node&#123; constructor(id)&#123; this.id = id; &#125; mark()&#123; isMarked.add(this); &#125; unmark()&#123; isMarked.delete(this); &#125; marked()&#123; return isMarked.has(this); &#125; set data(data)&#123; attachedData.set(this, data); &#125; get data()&#123; return attachedData.get(this); &#125;&#125;let foo = new Node("foo")JSON.stringify(foo) === '&#123;"id":"foo"&#125;'foo.mark()foo.data = "bar"foo.data === "bar"JSON.stringify(foo) === '&#123;"id":"foo"&#125;'isMarked.has(foo) === trueattachedData.has(foo) === truefoo = null /* remove only reference to foo */attachedData.has(foo) === falseisMarked.has(foo) === false å‚è€ƒæ–‡ç«  ES6 Collections: Using Map, Set, WeakMap, WeakSet ES2015 WeakMapçš„å­¦ä¹ å’Œä½¿ç”¨ JavaScript (ES-2015) Set, Map, WeakSet and WeakMap V8: Optimizing hash tables: hiding the hash code]]></content>
      <categories>
        <category>web</category>
      </categories>
      <tags>
        <tag>ES6</tag>
        <tag>JS</tag>
        <tag>Map</tag>
        <tag>Set</tag>
        <tag>WeakMap</tag>
        <tag>WeakSet</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[JSè¿›é˜¶--Iterator and Generator]]></title>
    <url>%2Fweb%2FLP20180917A%2F</url>
    <content type="text"><![CDATA[â€œThe best programmers are not marginally better than merely good ones. They are an order-of-magnitude better, measured by whatever standard: conceptual creativity, speed, ingenuity of design, or problem-solving ability.â€ â€”Randall E. Stross å‰è¨€å¤§å¤šæ•°ç¼–ç¨‹è¯­è¨€å·²ç»ä»Žä½¿ç”¨forå¾ªçŽ¯ï¼ˆéœ€è¦åˆå§‹åŒ–å˜é‡ä»¥ä¾¿è·Ÿè¸ªæ•°æ®åœ¨é›†åˆä¸­çš„ä½ç½®ï¼‰è½¬è€Œä½¿ç”¨ä»¥ç¼–ç¨‹æ–¹å¼è¿”å›žé›†åˆä¸­ä¸‹ä¸€é¡¹çš„è¿­ä»£å™¨å¯¹è±¡æ¥è¿­ä»£æ•°æ®ã€‚ å°½ç®¡è¿­ä»£å™¨ä½¿å¾—å¤„ç†æ•°æ®é›†åˆæ›´åŠ å®¹æ˜“,ä½†æ˜¯ç”±äºŽéœ€è¦æ˜¾å¼åœ°ç»´æŠ¤å…¶å†…éƒ¨çŠ¶æ€ï¼Œå› æ­¤å®ƒä»¬çš„åˆ›å»ºéœ€è¦è°¨æ…Žçš„ç¼–ç¨‹ã€‚ç”Ÿæˆå™¨å‡½æ•°æä¾›äº†ä¸€ä¸ªå¼ºå¤§çš„é€‰æ‹©ï¼šå®ƒä»¬å…è®¸æ‚¨é€šè¿‡ç¼–å†™ä¸€ä¸ªæ‰§è¡Œä¸è¿žç»­çš„å‡½æ•°æ¥å®šä¹‰è¿­ä»£ç®—æ³•ã€‚ å¾ªçŽ¯çš„ç§˜å¯†å¦‚æžœä½ ä½¿ç”¨JavaScript(ES5)æ¥ç¼–å†™è¿‡ç¨‹åºï¼Œé‚£ä½ å¾ˆå¯èƒ½å†™ç±»ä¼¼ä¸€ä¸‹å­çš„ä»£ç ï¼š 1234var colors = ["red", "green", "blue"];for(var i = 0; i &lt; colors.length; i++)&#123; console.log(colord[i]);&#125; è¿™ç§ç”¨æœ€åŽŸå§‹forå¾ªçŽ¯æ¥è¿­ä»£æ•°ç»„(æˆ–ç±»æ•°ç»„å¯¹è±¡)æ˜¯æœ€ç®€å•ä¹Ÿæ˜¯æœ€ç›´è§‚çš„ï¼Œéœ€è¦ä½¿ç”¨å˜é‡æ¥è¿½è¸ªcolorsæ•°ç»„çš„ç´¢å¼•ä½ç½®ï¼Œå˜é‡çš„å€¼ä¼šéšç€æ¯æ¬¡è¿­ä»£è€Œé€’å¢žç›´åˆ°å®ƒå¤§äºŽæ•°ç»„çš„é•¿åº¦å€¼ã€‚è™½ç„¶ä¸Šé¢çš„å¾ªçŽ¯ååˆ†ç®€å•ï¼Œä½†æ˜¯å½“ä½ åµŒå¥—å¾ªçŽ¯å¹¶ä¸”éœ€è¦è·Ÿè¸ªå¤šä¸ªå˜é‡æ—¶ï¼Œå¾ªçŽ¯ä¼šå˜å¾—å¤æ‚ã€‚é¢å¤–çš„å¤æ‚æ€§å¯èƒ½å¯¼è‡´é”™è¯¯ï¼Œå¹¶ä¸”forå¾ªçŽ¯çš„æ ·æ¿æ€§è´¨ä¼šå¯¼è‡´æ›´å¤šé”™è¯¯ï¼Œå› ä¸ºç±»ä¼¼çš„ä»£ç å†™åœ¨å¤šä¸ªåœ°æ–¹ã€‚è€Œè¿­ä»£å™¨æ—¨åœ¨è§£å†³è¿™äº›é—®é¢˜ã€‚ ç±»æ•°ç»„å¯¹è±¡çš„çŽ„æœºä¼—æ‰€å‘¨çŸ¥ï¼Œåœ¨JavaScriptä¸­éåŽ†æ•°ç»„ä¸­çš„æ¯ä¸€ä¸ªå…ƒç´ æ˜¯ä¸€ä»¶å¾ˆç®€å•çš„äº‹æƒ…ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡æœ€åŽŸå§‹çš„forã€whileå¾ªçŽ¯ï¼Œæˆ–ES6ä¸ºæˆ‘ä»¬æä¾›çš„for-ofä¹‹ç±»çš„ä¼—å¤šæ–¹æ³•æ¥å®žçŽ°ï¼›é‚£ä¹ˆä¸ºä»€ä¹ˆè¿™äº›æ–¹æ³•å°±å¯ä»¥éåŽ†æ•°ç»„æˆ–ç±»æ•°ç»„å¯¹è±¡ï¼ˆStringã€Mapã€Setã€argumentsï¼‰å‘¢ï¼Ÿè€Œä¸ºä»€ä¹ˆè¿™äº›æ–¹æ³•ä¸èƒ½éåŽ†Objectå‘¢ï¼Ÿå¤äººæœ‰äº‘ï¼šè¦æƒ³æˆ˜èƒœå®ƒï¼Œå°±å…ˆæˆä¸ºå®ƒï¼›é‚£ä¹ˆæˆ‘ä»¬å°±å…ˆæ¥æ¥çœ‹çœ‹ç±»æ•°ç»„å¯¹è±¡ç©¶ç«Ÿæ˜¯ä»€ä¹ˆè´§è‰²ã€‚æˆ‘åˆ†åˆ«æ‰“å°äº†Arrayã€Mapã€Setã€è¿˜æœ‰Stringç­‰ç±»æ•°ç»„å¯¹è±¡çš„ä¿¡æ¯ï¼Œå‘çŽ°å®ƒä»¬æœ‰ä¸€ä¸ªå…±åŒçš„ç‰¹å¾ï¼šå…¶åŽŸåž‹å¯¹è±¡ä¸Šéƒ½å®žçŽ°äº†[Symbol(Symbol.iterator)]æ–¹æ³•ã€‚ å¯è¿­ä»£åè®®åœ¨å®žé™…ç¼–ç¨‹å·¥ä½œä¸­ï¼Œæˆ‘ä»¬é™¤äº†ä¼šä½¿ç”¨æ•°ç»„è¿™æ ·çš„æ•°æ®ç»“æž„ä¹‹å¤–ï¼Œè¿˜ä¼šå¤§é‡ä½¿ç”¨è‡ªå®šä¹‰æ•°æ®ç»“æž„ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¦‚ä½•åŽ»éåŽ†æˆ–è€…è¯´ä½¿è¿™äº›è‡ªå®šä¹‰æ•°æ®ç»“æž„èƒ½å¤Ÿè¢«å¾ªçŽ¯è¿­ä»£å‘¢ï¼Ÿä¸Šä¸€èŠ‚çš„[Symbol(Symbol.iterator)]æ–¹æ³•ä¼šä¸ä¼šå¯¹æ­¤æœ‰ç”¨å‘¢ï¼Ÿå¯è¿­ä»£åè®®å…è®¸JavaScriptå¯¹è±¡å®šä¹‰æˆ–è‡ªå®šä¹‰å…¶è¿­ä»£è¡Œä¸ºï¼Œä¾‹å¦‚åœ¨for..ofæž„é€ ä¸­å¾ªçŽ¯çš„å€¼ï¼›ä¸ºäº†å®žçŽ°å¯è¿­ä»£æ€§ï¼Œå¯¹è±¡(æˆ–å…¶åŽŸåž‹ä¸Š)å¿…é¡»å®žçŽ°Symbol.iteratoræ–¹æ³•ï¼Œè¯¥æ–¹æ³•è¿”å›žä¸€ä¸ªå«åšè¿­ä»£å™¨çš„å¯¹è±¡ã€‚ å®žçŽ°123456789101112131415161718192021222324252627const iterable = &#123; [Symbol.iterator]()&#123; let step = 0; const iterator = &#123; next()&#123; if(step &lt; 3)&#123; step++; return (&#123; value: step, done: false, &#125;); &#125; return &#123; value: step, done: true, &#125; &#125; &#125;; return iterator; &#125;&#125;;const iterator = iterable[Symbol.iterator]();iterator.next() // &#123;value: 1, done: false&#125;iterator.next() // &#123;value: 2, done: false&#125;iterator.next() // &#123;value: 3, done: false&#125;iterator.next() // &#123;value: 3, done: true&#125; åº”ç”¨JavaScriptä¸­ä¸€äº›å†…ç½®æ•°æ®ç±»åž‹æ˜¯å…·æœ‰é»˜è®¤è¿­ä»£è¡Œä¸ºçš„å†…ç½®å¯è¿­ä»£ç±»åž‹ï¼Œä¾‹å¦‚Stringã€Arrayã€MapyåŠSetï¼Œå› ä¸ºå®ƒä»¬çš„åŽŸåž‹ä¸Šå®žçŽ°äº†[Symbol.iterator]æ–¹æ³•ï¼Œå…¶å®žå°±æ˜¯å®žçŽ°äº†å¯è¿­ä»£åè®®ã€‚å½“ç„¶è¿˜æœ‰å¾ˆå¤šåœ°æ–¹ä½¿ç”¨äº†å¯è¿­ä»£æ€§ï¼Œæœ‰çš„å¯èƒ½ä¸å¤ªæ˜Žæ˜¾ï¼Œæ¯”å¦‚ï¼š for-ofå¾ªçŽ¯ æ•°ç»„ç»“æž„ ES6æ‰©å±•è¿ç®—ç¬¦ Mapå’ŒSetçš„æž„é€ å‡½æ•°è¦æ±‚æ˜¯å¯è¿­ä»£å¯¹è±¡Iteratorï¼ˆè¿­ä»£å™¨ï¼‰å®šä¹‰MDNå®šä¹‰ï¼š è¿­ä»£å™¨ä»…ä»…æ˜¯å…·æœ‰ä¸ºè¿­ä»£è®¾è®¡çš„ç‰¹å®šæŽ¥å£çš„å¯¹è±¡ã€‚æ‰€æœ‰çš„è¿­ä»£å™¨å¯¹è±¡éƒ½æœ‰ä¸€ä¸ªâ€œnext()â€æ–¹æ³•,è¿™ä¸ªæ–¹æ³•è¿”å›žä¸€ä¸ªå«æœ‰valueå’Œdoneä¸¤ä¸ªå­—æ®µçš„å¯¹è±¡ï¼Œå…¶ä¸­valueå­—æ®µçš„å€¼å°±æ˜¯å½“å‰ä»Žæ•°æ®é›†åˆä¸­è¿­ä»£å‡ºçš„å€¼ï¼›è€Œdoneå­—æ®µçš„æ˜¯ä¸€ä¸ªå¸ƒå°”å€¼ï¼Œç”¨æ¥è¡¨ç¤ºè¿­ä»£æ˜¯å¦å·²ç»å®Œæˆã€‚è¿­ä»£å™¨ä¸€æ—¦è¢«åˆ›å»ºï¼Œ æˆ‘ä»¬å°±èƒ½é€šè¿‡é‡å¤è°ƒç”¨â€œnext()â€æ–¹æ³•æ¥è¿­ä»£å®ƒï¼Œåœ¨äº§ç”Ÿç»ˆæ­¢å€¼åŽç»§ç»­è°ƒç”¨next()æ–¹æ³•åº”è¯¥å§‹ç»ˆè¿”å›ž{done: true} æ¡ˆä¾‹123456789101112131415161718192021222324252627282930function makeRangeIterator&lt;T&gt;(dataCollection: Array&lt;T&gt;, start=0, step=1,end=Infinity,)&#123; const len = dataCollection.length; let nextIndex = start; let iterationValue: T; return &#123; next: function (param?: any): &#123;value: T, done: boolean&#125; &#123; if(nextIndex &lt; end &amp;&amp; nextIndex &lt; len)&#123; iterationValue = dataCollection[nextIndex]; nextIndex += step; return &#123; value: iterationValue, done: false, &#125; &#125; return &#123; value: iterationValue, done: true, &#125; &#125; &#125;&#125;var iterator = makeRangeIterator(["s",3,&#123;name: 'paopaolee'&#125;],0,1,3);console.log(JSON.stringify(iterator.next())); // &#123;"value":"s","done":false&#125;console.log(JSON.stringify(iterator.next()));// &#123;"value":3,"done":false&#125;console.log(JSON.stringify(iterator.next()));// &#123;"value":&#123;"name":"paopaolee"&#125;,"done":false&#125;console.log(JSON.stringify(iterator.next()));// &#123;"value":&#123;"name":"paopaolee"&#125;,"done":false&#125; ä¸‹é¢è¿™å¼ å›¾å¯ä»¥å¸®ç»„æˆ‘ä»¬å»ºç«‹å¯è¿­ä»£æ€§ã€è¿­ä»£å™¨ã€nextä¹‹é—´çš„å…³ç³»ï¼š Generatorï¼ˆç”Ÿæˆå™¨ï¼‰è™½ç„¶è‡ªå®šä¹‰è¿­ä»£å™¨æ˜¯ä¸€ä¸ªååˆ†æœ‰ç”¨çš„å·¥å…·ï¼Œä½†æ˜¯ä»Žä¸Šé¢ä»£ç å¯ä»¥çœ‹å‡ºç”±äºŽéœ€è¦åŽ»æ˜¾ç¤ºç»´æŠ¤å…¶å†…éƒ¨çŠ¶æ€ï¼Œæ‰€ä»¥åˆ›å»ºè¿­ä»£å™¨éœ€è¦è°¨æ…Žçš„ç¼–ç¨‹ã€‚ç”Ÿæˆå™¨æ˜¯ä¸€ä¸ªå¼ºæœ‰åŠ›çš„æ›¿ä»£å·¥å…·ï¼Œå®ƒä½¿å¾—æˆ‘ä»¬å¯ä»¥æ›´ç®€å•çš„åˆ›å»ºè¿­ä»£å™¨å¯¹è±¡ã€‚ å®šä¹‰MDNå®šä¹‰: ç”Ÿæˆå™¨æ˜¯ä¸€ä¸ªè¿”å›žè¿­ä»£å™¨çš„å‡½æ•°ï¼Œå®ƒå…è®¸é€šè¿‡ç¼–å†™ä¸€ä¸ªéžè¿žç»­æ‰§è¡Œçš„å‡½æ•°æ¥å®šä¹‰è¿­ä»£ç®—æ³•ã€‚å®ƒçš„çš„è¯­æ³•ä¸ºâ€œfunction* FuncName(){ }â€ã€‚é¦–æ¬¡è°ƒç”¨æ—¶ï¼Œç”Ÿæˆå™¨å‡½æ•°ä¸æ‰§è¡Œä»»ä½•ä»£ç ï¼Œè€Œæ˜¯è¿”å›žä¸€ç§ç§°ä¸ºGeneratorçš„è¿­ä»£å™¨ã€‚é€šè¿‡è°ƒç”¨ç”Ÿæˆå™¨çš„â€œnextâ€æ–¹æ³•æ¶ˆè€—å€¼æ—¶ï¼ŒGeneratorå‡½æ•°å°†æ‰§è¡Œï¼Œç›´åˆ°é‡åˆ°yieldå…³é”®å­—ã€‚ ç®€è€Œè¨€ä¹‹ï¼ŒJavaScriptä¸­ç”Ÿæˆå™¨æ˜¯ä¸€ä¸ªè¿”å›žå€¼ä¸ºè¿­ä»£å™¨çš„å‡½æ•°ï¼Œä¸Žæ™®é€šå‡½æ•°ä¸åŒçš„æ˜¯ï¼Œç”Ÿæˆå™¨å‡½æ•°åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­å¯ä»¥ä¸­æ–­å¹¶ä¸”èƒ½ä»Žä¸­æ–­çš„åœ°æ–¹ç»§ç»­æ‰§è¡Œã€‚ä¸‹é¢çš„è¿™å¼ å›¾å¯¹æ¯”äº†æ™®é€šå‡½æ•°ä¸Žç”Ÿæˆå™¨å‡½æ•°æ‰§è¡Œè¿‡ç¨‹ï¼š ä¸¾ä¾‹è¯´æ˜Ž123456789101112131415function* generatorFunction()&#123; // line 1 console.log('This will be executed first.') yield 'Hello,'; // line 2 console.log('Iwill be printed after the pause.'); yield 'World!'; &#125;const generatorObject = generatorFunction(); // line 3console.log(generatorObject.next().value); // line 4// This will be executed first.// Hello, console.log(generatorObject.next().value); // line 5// I will be printed after the pause// World!console.log(generatorObject.next().value); // line 6// undefined ä¸Šé¢ä»£ç ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨äº†function* çš„è¯­æ³•åˆ›å»ºäº†ä¸€ä¸ªç”Ÿæˆå™¨å‡½æ•°ï¼ˆline 1ï¼‰ï¼Œåœ¨å‡½æ•°å†…éƒ¨æˆ‘ä»¬ä½¿ç”¨äº†å¦ä¸€ä¸ªå…³é”®å­—yieldï¼ˆline 2ï¼‰ï¼Œå®ƒåªèƒ½åœ¨ç”Ÿæˆå™¨ä¸­ä½¿ç”¨ã€‚ç”Ÿæˆå™¨å‡½æ•°åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ä¸€æ—¦è¿è¡Œåˆ°yieldå…³é”®å­—æ—¶ï¼Œä¼šç«‹å³â€œè¿”å›žâ€å®šä¹‰åœ¨å®ƒåŽé¢çš„å€¼å¹¶ä¸­æ–­å‡½æ•°çš„æ‰§è¡Œï¼Œæ³¨æ„æ­¤å¤„çš„è¿”å›žè·Ÿæ™®é€šå‡½æ•°çš„returnä¸åŒï¼Œåœ¨ç”Ÿæˆå™¨ä¸Šä¸‹æ–‡ä¸­ï¼Œæˆ‘ä»¬å«ï¼ˆyieldï¼‰äº§å‡ºæŸå€¼ã€‚ 12345function * generatorFunc() &#123; yield 'a'; return 'b'; // Generator ends here. yield 'a'; // Will never be executed. &#125; åœ¨ï¼ˆline 3ï¼‰ä¸­æˆ‘ä»¬é€šè¿‡åˆ›å»ºäº†generatorObjectå¯¹è±¡ï¼Œè¿™çœ‹èµ·æ¥è²Œä¼¼ç”Ÿæˆå™¨å‡½æ•°â€œgeneratorFunctionâ€å†…éƒ¨çš„è¯­å¥åº”è¯¥å·²ç»æ‰§è¡Œï¼Œä½†æ˜¯ç¥žå¥‡çš„æ˜¯ç¬¬ä¸€å¥console.logä¸ºå•¥å¹¶æ²¡æœ‰æ‰“å°è¾“å‡ºå‘¢ï¼ŸåŽŸæ¥æ˜¯ï¼Œå½“ç”Ÿæˆå™¨å‡½æ•°æ‰§è¡Œæ—¶æ€»æ˜¯ç®€å•çš„è¿”å›žä¸€ä¸ªè¿­ä»£å™¨å¯¹è±¡ï¼Œç„¶åŽé€šè¿‡è°ƒç”¨è¿™ä¸ªè¿­ä»£å™¨å¯¹è±¡çš„nextæ–¹æ³•ï¼Œç”Ÿæˆå™¨å‡½æ•°å†…éƒ¨è¯­å¥æ‰ä¼šå¼€å§‹æ‰§è¡Œï¼› æ‰€ä»¥ï¼ˆline 3 ä¸­ï¼‰generatorObjectå°±æ˜¯ä¸€ä¸ªè¿­ä»£å™¨å¯¹è±¡ï¼Œç„¶åŽæˆ‘ä»¬é€šè¿‡è°ƒç”¨å®ƒçš„nextæ–¹æ³•ï¼ˆline 4ï¼‰,è¿™æ—¶ç”Ÿæˆå™¨â€œgeneratorFunctionâ€æ‰å¼€å§‹çœŸæ­£æ‰§è¡Œï¼Œæ‰“å°å‡ºâ€This will be executed first.â€œï¼›æŽ¥ç€æ‰§è¡Œä¸‹ä¸€è¡Œä»£ç ï¼ˆline 2ï¼‰ï¼Œè¿™æ—¶é‡åˆ°äº†yieldå…³é”®å€¼ï¼Œå°†å…¶åŽå®šä¹‰çš„â€˜Helloâ€™å­—ç¬¦ä¸²ä½œä¸ºå€¼ï¼Œäº§å‡ºâ€œ{value: â€˜Helloâ€™, done: false}â€å¯¹è±¡,åŒæ—¶ä¼šè¢«æš‚æ—¶ä¸­æ–­æŒ‚èµ·ï¼Œç›´åˆ°è¿­ä»£å™¨å†æ¬¡è°ƒç”¨nextæ–¹æ³•ï¼› åœ¨line 5ä¸­ï¼Œæˆ‘ä»¬å†æ¬¡è°ƒç”¨äº†nextï¼Œè¿™æ—¶ç”Ÿæˆå™¨å‡½æ•°è¢«å”¤é†’å¹¶ä»Žä¸Šä¸€æ¬¡æŒ‚èµ·çš„åœ°æ–¹ç»§ç»­å¼€å§‹æ‰§è¡Œï¼Œæ‰€ä»¥æ‰“å°å‡ºâ€I will be printed after the pauseâ€œï¼ŒæŽ¥ç€åˆé‡åˆ°äº†yieldå…³é”®å­—ï¼Œäº§å‡ºâ€{value: â€˜Worldï¼â€™, done: false}â€åŽå†æ¬¡æŒ‚èµ·ï¼› åœ¨line 5ä¸­ï¼Œæˆ‘ä»¬åˆå†ä¸€æ¬¡è°ƒç”¨äº†nextï¼Œè¿™æ¬¡ç”Ÿæˆå™¨å‡½æ•°è¢«å”¤é†’åŽå‘çŽ°æ²¡æœ‰è¯­å¥å¯ä»¥æ‰§è¡Œäº†ï¼Œè®°ä½å¦‚æžœå‡½æ•°æ²¡æœ‰returnè¯­å¥ï¼Œé»˜è®¤è¿”å›žundefined,å› æ­¤ç”Ÿæˆå™¨å‡½æ•°ä¼šäº§å‡ºâ€{value: undefined, done: true}â€,å±žæ€§å€¼doneè¢«è®¾ç½®ä¸ºtrueï¼Œè¿™å°±æ„å‘³ç€ç”Ÿæˆå™¨å‡½æ•°æ‰§è¡Œç»“æŸäº†ã€‚ åº”ç”¨åœºæ™¯ä¸€ . å®žçŽ°å¯è¿­ä»£å‰é¢æœ‰æåˆ°è¦å®žçŽ°å¯è¿­ä»£æ€§ï¼Œå¯¹è±¡(æˆ–å…¶åŽŸåž‹ä¸Š)å¿…é¡»å®žçŽ°[Symbol.iterator]æ–¹æ³•æ¥è¿”å›žä¸€ä¸ªæˆ‘ä»¬è‡ªå·±ç¼–å†™çš„è¿­ä»£å™¨ï¼Œè¿™ä½¿å¾—å®žçŽ°è¿‡äºŽå¤æ‚ï¼Œè€Œç”Ÿæˆå™¨å‡½æ•°å¯ä»¥ä½¿æˆ‘ä»¬æ›´ç®€å•çš„åˆ›å»ºè¿­ä»£å™¨å¯¹è±¡ã€‚æŽ¥ä¸‹æ¥æˆ‘ä»¬åˆ†åˆ«ä½¿ç”¨è‡ªå®šä¹‰è¿­ä»£å™¨å’Œç”Ÿæˆå™¨æ¥å®žçŽ°å¯è¿­ä»£è¡Œå¯¹è±¡ã€‚è‡ªå®šä¹‰è¿­ä»£å™¨ï¼š 12345678910111213141516171819const iterableObj = &#123; [Symbol.iterator]: () =&gt; &#123; let step = 0; return &#123; next: () =&gt; &#123; step++; if (step === 1) &#123; return &#123; value: 'This', done: false&#125;; &#125; else if (step === 2) &#123; return &#123; value: 'is', done: false&#125;; &#125; else if (step === 3) &#123; return &#123; value: 'iterable.', done: false&#125;; &#125; return &#123; value: '', done: true &#125;; &#125; &#125;; &#125;&#125;;[...iterableObj] // ["This", "is", "iterable."] ç”Ÿæˆå™¨ 1234567function * generatorFunc() &#123; yield 'This'; yield 'is'; yield 'iterable.'&#125;const iterableObj = generatorFunc();[...iterableObj] // ["This", "is", "iterable."] ä½ å¯ä»¥æ¯”è¾ƒä¸¤ä¸ªç‰ˆæœ¬ï¼Œå®ƒå¯ä»¥è¯´æ˜Žç”Ÿæˆå™¨å¸¦æ¥çš„è¯¸å¤šå¥½å¤„ï¼š æˆ‘ä»¬ä¸éœ€è¦å…³å¿ƒSymbol.iterator æˆ‘ä»¬ä¸å†å¿…é¡»å®žçŽ°nextæ–¹æ³• æˆ‘ä»¬ä¸å†å…³å¿ƒå¿…é¡»åƒåœ¨nextæ–¹æ³•ä¸­è¿”å›ž{value: â€˜Thisâ€™, done: false}è¿™æ ·çš„å¯¹è±¡ç»“æž„ æˆ‘ä»¬ä¸ç”¨åŽ»ç»´æŠ¤è¿­ä»£å™¨å†…éƒ¨çš„çŠ¶æ€ äºŒ. å¼‚æ­¥ä»»åŠ¡å¤„ç†ç”Ÿæˆå™¨æœ€è®©äººå…´å¥‹çš„åœ°æ–¹ä¸Žå¼‚æ­¥ç¼–ç¨‹ç›¸å…³ã€‚ JavaScriptä¸­çš„å¼‚æ­¥ç¼–ç¨‹æ˜¯ä¸€æŠŠåŒåˆƒå‰‘ï¼šç®€å•çš„å¼‚æ­¥ä»»åŠ¡å¾ˆå®¹æ˜“å®Œæˆï¼Œè€Œå¤æ‚çš„å¼‚æ­¥ä»»åŠ¡æˆä¸ºä»£ç ç»„ç»‡çš„ä¸€ä¸ªè‹¦å·®äº‹ã€‚ç„¶è€Œç”Ÿæˆå™¨å…è®¸æ‚¨åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­æœ‰æ•ˆåœ°æš‚åœä»£ç ï¼Œå› æ­¤å®ƒä»¬å¼€è¾Ÿäº†è®¸å¤šä¸Žå¼‚æ­¥å¤„ç†ç›¸å…³çš„å¯èƒ½æ€§ã€‚ è§£å†³å¼‚æ­¥ä»»åŠ¡çš„ä¼ ç»Ÿæ–¹æ³•æ˜¯å›žè°ƒå‡½æ•°ï¼Œè¿™ç§æ–¹æ³•èƒ½å¤Ÿå¾ˆå¥½åœ°è§£å†³ç®€å•çš„ä¸šåŠ¡ï¼Œä½†æ˜¯ä¸€æ—¦ä¸šåŠ¡è¿‡äºŽå¤æ‚ï¼Œè¿™ç§æ–¹æ³•å¾€å¾€ä½¿å¾—åµŒå¥—å¤šå±‚ä»£ç é€ æˆå›žè°ƒåœ°ç‹±ã€‚å¾—ç›ŠäºŽyieldå…³é”®å­—å¯ä»¥ä¸­æ–­æŒ‚èµ·å‡½æ•°ç›´åˆ°nextæ–¹æ³•çš„è°ƒç”¨ï¼Œæˆ‘ä»¬å¯ä»¥ä¸éœ€è¦ç®¡ç†å›žè°ƒå‡½æ•°å°±èƒ½å®žçŽ°å¼‚æ­¥ç¼–ç¨‹ã€‚ é«˜çº§è¿­ä»£å™¨åŠŸèƒ½ä¼ é€’å‚æ•°åˆ°è¿­ä»£å™¨åœ¨ä¸Šè¿°è¿­ä»£å™¨çš„æ¡ˆä¾‹ä»£ç ä¸­å¯ä»¥å‘çŽ°ï¼Œè¿­ä»£å™¨çš„nextæ–¹æ³•å…¶å®žå¯ä»¥æŽ¥å—å‚æ•°ã€‚åœ¨ç”Ÿæˆå™¨å‡½æ•°ä¸­ï¼Œå°†å‚æ•°ä¼ é€’ç»™nextï¼ˆï¼‰æ–¹æ³•æ—¶ï¼Œè¯¥å‚æ•°å°†æˆä¸ºç”Ÿæˆå™¨å†…yieldè¯­å¥çš„å€¼ã€‚æ­¤åŠŸèƒ½å¯¹äºŽæ›´é«˜çº§çš„åŠŸèƒ½ï¼ˆå¦‚å¼‚æ­¥ç¼–ç¨‹ï¼‰éžå¸¸é‡è¦ã€‚è¿™æ˜¯ä¸€ä¸ªåŸºæœ¬çš„ä¾‹å­ï¼š 123456789101112131415function * createIterator()&#123; let first = yield 1; // line 1 let seccond = yield first + 2; // line 2 yield second + 3; // line 3&#125;const iterator = createIterator();console.log(iterator.next()); // line 4// "&#123; value: 1, done: false &#125;"console.log(iterator.next(4)); // line 5// "&#123; value: 6, done: false &#125;"console.log(iterator.next(5)); // line 6 // "&#123; value: 8, done: false &#125;"console.log(iterator.next()); // "&#123; value: undefined, done: true &#125;" ä¸Šé¢ä»£ç ä¸­ï¼Œæˆ‘ä»¬åœ¨ç¬¬ä¸€æ¬¡è°ƒç”¨nextæ–¹æ³•æ—¶ï¼ˆline 4ï¼‰ï¼Œç”Ÿæˆå™¨å‡½æ•°å†…éƒ¨å¼€å§‹æ‰§è¡Œï¼ˆline 1ï¼‰ï¼Œæ‰§è¡Œè¿‡ç¨‹ä¸­ç”±äºŽèµ‹å€¼è¯­å¥æ˜¯ä»Žå³å¾€å·¦æ‰§è¡Œçš„ï¼Œä¸€å¼€å§‹å°±é‡åˆ°yieldå…³é”®å€¼ï¼Œäº§å‡ºâ€{value: 1, done: flase}â€,ç„¶åŽä¸­æ­¢æŒ‚èµ·å‡½æ•°ç­‰å¾…ä¸‹ä¸€æ¬¡nextæ–¹æ³•è°ƒç”¨ï¼Œæ³¨æ„æ­¤æ—¶å˜é‡firstè¿˜æ²¡æœ‰è¢«èµ‹å€¼ï¼›å½“æˆ‘ä»¬å†æ¬¡è°ƒç”¨ï¼ˆline 5ï¼‰nextæ–¹æ³•ï¼ˆå€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œæ­¤æ¬¡è°ƒç”¨nextæ–¹æ³•æ—¶è¿˜ä¼ å…¥äº†å‚æ•°4ï¼‰ï¼Œå‡½æ•°ä»Žä¸Šä¸€æ¬¡ä¸­æ­¢çš„åœ°æ–¹ï¼ˆline 1 è¡¨è¾¾å¼å³è¾¹ï¼‰è¢«å”¤é†’ç»§ç»­æ‰§è¡Œï¼Œæ­¤æ—¶å‚æ•°4ä¼šè¢«å½“ä½œyieldè¯­å¥çš„æ‰§è¡Œç»“æžœèµ‹å€¼ç»™å˜é‡firstï¼ŒæŽ¥ç€æ‰§è¡Œä¸‹ä¸€è¡Œï¼ˆline 2ï¼‰ç›´åˆ°é‡åˆ°yieldï¼Œäº§å‡ºâ€{value: 6(4+2), done: false}â€ç„¶åŽä¸­æ­¢ï¼›ç»§ç»­æˆ‘ä»¬ç¬¬ä¸‰æ¬¡è°ƒç”¨nextï¼ˆline 6ï¼‰ï¼Œè¿™æ¬¡yieldæŽ¥å—å‚æ•°5èµ‹ç»™å˜é‡secondï¼Œäº§å‡ºâ€{value: 8(5+3), done: false}â€åŽå†æ¬¡ä¸­æ–­æŒ‚èµ·ï¼›æœ€åŽä¸€æ¬¡è°ƒç”¨nextï¼Œå‡½æ•°è¢«å”¤é†’åŽå‘çŽ°æ²¡æœ‰è¯­å¥å¯ä»¥æ‰§è¡Œï¼Œä¸”å‡½æ•°æ²¡æœ‰returnè¯­å¥ï¼ˆå³é»˜è®¤è¿”å›žundefinedï¼‰ï¼Œæ‰€ä»¥é»˜è®¤è¿”å›žâ€{value: undefined, done: true}â€; æ³¨æ„ï¼Œé¦–æ¬¡è°ƒç”¨nextæ–¹æ³•ä¼ å…¥çš„å‚æ•°æ˜¯æ— æ•ˆçš„ï¼Œä¼šè¢«å‡½æ•°å®Œå…¨å¿½ç•¥æŽ‰ã€‚å³ä¸Šé¢(line 4)ä»£ç ä¸­çš„nextå‡½æ•°ä¸­ä¼ å…¥ä»»ä½•å‚æ•°éƒ½æ˜¯æ— æ•ˆçš„ã€‚ åœ¨ç”Ÿæˆå™¨ä¸­æŠ›å‡ºå’Œæ•èŽ·é”™è¯¯æˆ‘ä»¬é€šè¿‡è¿­ä»£å™¨çš„nextæ–¹æ³•ä¸ä»…èƒ½ä¼ é€’æ•°æ®ï¼Œè€Œä¸”è¿˜èƒ½ä¼ é€’Errorä¿¡æ¯ã€‚è¿­ä»£å™¨å¯ä»¥é€‰æ‹©å®žçŽ°ä¸€ä¸ªthrowï¼ˆï¼‰æ–¹æ³•ï¼Œè¯¥æ–¹æ³•æŒ‡ç¤ºè¿­ä»£å™¨åœ¨æ¢å¤æ—¶æŠ›å‡ºé”™è¯¯ã€‚ function * createIterator(){ let first = yield 1; // line 1 let seccondï¼› try{ second = yield first + 2; }catch(error){ second = 6; } yield second + 3; // line 3 } let iterator = createIterator(); console.log(iterator.next()); // "{ value: 1, done: false }" console.log(iterator.next(4)); // "{ value: 6, done: false }" console.log(iterator.throw(new Error("Boom"))); // "{ value: 9, done: false }" console.log(iterator.next()); // "{ value: undefined, done: true åœ¨ç”Ÿæˆå™¨å‡½æ•°ä¸­ä½¿ç”¨returnè¯­å¥æˆ‘ä»¬è¯´è¿‡ç”Ÿæˆå™¨å°±æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œæˆ‘ä»¬å¯ä»¥åƒæ™®é€šå‡½æ•°é‚£æ ·åœ¨ç”Ÿæˆå™¨ä¸­ä½¿ç”¨returnè¯­å¥ï¼Œå®ƒé»˜è®¤ä¼šå°†è¿”å›žå€¼ä¸­çš„doneå±žæ€§è®¾ç½®ä¸ºtrueï¼Œä¹Ÿå°±æ„å‘³ç€ä½ å¯ä»¥é€šè¿‡ä½¿ç”¨returnè¯­å¥æå‰é€€å‡ºå‡½æ•°æˆ–ä¸ºå®šä¹‰æœ€åŽä¸€æ¬¡è°ƒç”¨nextæ–¹æ³•çš„äº§å‡ºå€¼ã€‚ function * createIterator(){ let first = yield 1; // line 1 let seccond = yield first + 2; // line 2 return 1000; yield second + 3; // line 3 } ä¸Šé¢ä»£ç ä¸­ï¼Œç¬¬ä¸‰æ¬¡è°ƒç”¨nextæ–¹æ³•åŽï¼Œäº§å‡ºå€¼ä¸ºâ€{value: 1000, done: true}â€,å¹¶ä¸”å‡½æ•°ä¼šé€€å‡ºã€‚ ç‰¹æ®Šåœ°ï¼ŒES6ä¸­çš„æ‰©å±•è¿ç®—ç¬¦å’Œfor-ofæ“ä½œç¬¦ä¼šå¿½ç•¥æŽ‰ä»»ä½•returnè¯­å¥å®šä¹‰çš„å€¼ã€‚å› ä¸ºå®ƒä»¬é¦–å…ˆæ£€æŸ¥å¯¹è±¡ä¸­çš„doneå±žæ€§æ˜¯å¦ä¸ºtrueï¼Œä¸€æ—¦doneä¸ºtrueä¾¿ä¸ä¼šåœ¨è¯»å–valueå±žæ€§ã€‚]]></content>
      <categories>
        <category>web</category>
      </categories>
      <tags>
        <tag>JavaScript</tag>
        <tag>ES6</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[æ¼«è°ˆWeb--JWT]]></title>
    <url>%2Fweb%2FLP20190709A%2F</url>
    <content type="text"><![CDATA[â€œThe most amazing achievement of the computer software industry is its continuing cancellation of the steady and staggering gains made by the computer hardware industry.â€ â€”Henry Petroski å‰è¨€éšç€æŠ€æœ¯çš„å‘å±•ï¼Œåˆ†å¸ƒå¼webåº”ç”¨çš„æ™®åŠï¼Œé€šè¿‡sessionç®¡ç†ç”¨æˆ·ç™»å½•çŠ¶æ€æˆæœ¬è¶Šæ¥è¶Šé«˜ï¼Œå› æ­¤æ…¢æ…¢å‘å±•æˆä¸ºtokençš„æ–¹å¼åšç™»å½•èº«ä»½æ ¡éªŒï¼Œç„¶åŽé€šè¿‡tokenåŽ»å–redisä¸­çš„ç¼“å­˜çš„ç”¨æˆ·ä¿¡æ¯ï¼Œéšç€ä¹‹åŽjwtçš„å‡ºçŽ°ï¼Œæ ¡éªŒæ–¹å¼æ›´åŠ ç®€å•ä¾¿æ·åŒ–ï¼Œæ— éœ€é€šè¿‡redisç¼“å­˜ï¼Œè€Œæ˜¯æ‰€æœ‰æ•°æ®éƒ½ä¿å­˜åœ¨å®¢æˆ·ç«¯ï¼Œæ¯æ¬¡è¯·æ±‚éƒ½å‘å›žæœåŠ¡å™¨ï¼ŒéšåŽæœåŠ¡å™¨ç›´æŽ¥æ ¹æ®tokenå–å‡ºä¿å­˜çš„ç”¨æˆ·ä¿¡æ¯ï¼Œä»¥åŠå¯¹tokenå¯ç”¨æ€§æ ¡éªŒï¼Œå•ç‚¹ç™»å½•æ›´ä¸ºç®€å•ã€‚ è¿™ç¯‡æ–‡ç« ä¸­ä¸»è¦è®²è§£äº†å…³äºŽJSON Web Tokensï¼ˆJWTï¼‰çš„åŸºç¡€æ¦‚å¿µï¼Œä»¥åŠè§£é‡ŠJWTä¸ºä»€ä¹ˆä¼šè¢«å¹¿æ³›åº”ç”¨ã€‚JWTæ˜¯ç¡®ä¿åº”ç”¨ç¨‹åºä¿¡ä»»å’Œå®‰å…¨çš„é‡è¦éƒ¨åˆ†ï¼Œå®ƒå…è®¸ä»¥è¯¸å¦‚ç”¨æˆ·æ•°æ®ä¹‹ç±»çš„å®‰å…¨çš„æ–¹å¼å£°æ˜Žè¡¨ç¤ºã€‚ ä¸ºäº†JWTçš„å·¥ä½œåŽŸç†ï¼Œæˆ‘ä»¬å…ˆæ¥çœ‹ä¸€çœ‹å…³äºŽå®ƒçš„æŠ½è±¡å®šä¹‰ï¼š JSON Web Tokenï¼ˆJWTï¼‰æ˜¯ä¸€ç§JSONå¯¹è±¡ï¼Œåœ¨RFC 7519ä¸­å®šä¹‰ä¸ºè¡¨ç¤ºåŒæ–¹ä¹‹é—´çš„ä¸€ç»„ä¿¡æ¯çš„å®‰å…¨æ–¹å¼ï¼›å®ƒç”±å¤´éƒ¨ã€æœ‰æ•ˆè´Ÿè½½å’Œç­¾åä¸‰éƒ¨åˆ†ç»„æˆã€‚ æˆ‘ä»¬å®Œå…¨å¯ä»¥æŠŠJWTç®€å•åœ°çœ‹æˆä»…ä»…æ˜¯ç¬¦åˆä»¥ä¸‹æ ¼å¼çš„å­—ç¬¦ä¸² header.payload.signature Notes: åˆæ³•çš„JSONå¿…é¡»æ˜¯ä½¿ç”¨åŒå¼•å·çš„å­—ç¬¦ä¸² ä¸ºäº†ç†è§£JWTæ˜¯å¦‚ä½•è¢«ä½¿ç”¨çš„ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨Userï¼ˆç”¨æˆ·ï¼‰ã€Application Serverï¼ˆåº”ç”¨æœåŠ¡å™¨ï¼‰ã€Authentication Serverï¼ˆæŽˆæƒæœåŠ¡å™¨ï¼‰3ä¸ªç®€å•çš„å®žä½“åŠ ä»¥è§£é‡Šè¯´æ˜Žã€‚å…¶ä¸­Authentication Serverå°†æä¾›JWTç»™ç”¨æˆ·ï¼Œç”¨æˆ·æ‹¿åˆ°JWTåŽå°±å¯ä»¥å’Œåº”ç”¨ï¼ˆapp/websiteï¼‰å®‰å…¨åœ°é€šä¿¡ã€‚ ä¸Šå›¾ä¸­ï¼ŒUseræºå¸¦ç”¨æˆ·å/å¯†ç ç­‰å¯è¯æ˜Žèº«ä»½çš„å†…å®¹åŽ»æŽˆæƒæœåŠ¡å™¨èŽ·å–JWTä¿¡æ¯ï¼Œæ¯æ¬¡æœåŠ¡éƒ½æºå¸¦è¯¥Tokenå†…å®¹ä¸Žåº”ç”¨æœåŠ¡å™¨è¿›è¡Œäº¤äº’ï¼Œç”±åº”ç”¨æœåŠ¡å™¨æ¥éªŒè¯Tokenæ˜¯å¦æ˜¯æŽˆæƒç³»ç»Ÿå‘æ”¾çš„æœ‰æ•ˆTokenï¼Œæ¥éªŒè¯å½“å‰ä¸šåŠ¡æ˜¯å¦è¯·æ±‚æ˜¯å¦åˆæ³•ã€‚ æŽ¥ä¸‹æ¥æˆ‘ä»¬æ·±å…¥ç†è§£JWTæ˜¯å¦‚ä½•æž„é€ ä»¥åŠå¦‚ä½•éªŒè¯çš„ã€‚ ç¬¬ä¸€æ­¥ åˆ›å»ºå¤´éƒ¨ï¼ˆheaderï¼‰JWTçš„å¤´éƒ¨åŒ…å«äº†JWTè‡ªèº«çš„ç­¾åç®—æ³•ä¿¡æ¯ï¼Œå®ƒæ˜¯ä¸€ä¸ªå…·æœ‰å¦‚ä¸‹æ ¼å¼çš„JSONå¯¹è±¡ï¼š 1234&#123; "typ": "JWT", "alg": "HS256"&#125; è¿™ä¸ªJSONä¸­, typå±žæ€§è¡¨ç¤ºä»¤ç‰Œçš„ç±»åž‹ï¼ŒJWTä»¤ç‰Œç»Ÿä¸€å†™ä¸ºJWTã€‚algå±žæ€§è¡¨ç¤ºç­¾åä½¿ç”¨çš„ç®—æ³•ï¼Œé»˜è®¤ä¸ºHMAC SHA256ï¼ˆå†™ä¸ºHS256ï¼‰ ç¬¬äºŒéƒ¨ åˆ›å»ºæœ‰æ•ˆè½½è·ï¼ˆpayloadï¼‰JWTçš„æœ‰æ•ˆè½½è·å³æ˜¯JWTçš„ä¸»ä½“å†…å®¹éƒ¨åˆ†,åŒ…å«äº†éœ€è¦ä¼ é€’çš„æ•°æ®ï¼ˆè¿™äº›æ•°æ®ä¹Ÿè¢«ç§°ä¸ºJWTçš„å£°æ˜Žï¼‰ã€‚åœ¨æˆ‘ä»¬çš„ðŸŒ°ä¸­ï¼ŒJWTä¸­å­˜å‚¨äº†ç”¨æˆ·IDä¿¡æ¯ã€‚ 123&#123; "userId": "b08f86af-35da-48f2-8fab-cef3904660bd"&#125; ä¸Šé¢çš„ðŸŒ°ä¸­ï¼Œæˆ‘ä»¬çš„JWTä»…ä»…å­˜å‚¨äº†ä¸€ä¸ªä¿¡æ¯ã€‚ç„¶è€ŒJWT è§„å®šäº†7ä¸ªå®˜æ–¹å­—æ®µï¼Œä¾›é€‰ç”¨ iss (issuer)ï¼šç­¾å‘äºº exp (expiration time)ï¼šè¿‡æœŸæ—¶é—´ sub (subject)ï¼šä¸»é¢˜ aud (audience)ï¼šå—ä¼— nbf (Not Before)ï¼šç”Ÿæ•ˆæ—¶é—´ iat (Issued At)ï¼šç­¾å‘æ—¶é—´ jti (JWT ID)ï¼šç¼–å· å½“ç„¶é™¤äº†å®˜æ–¹å­—æ®µï¼Œä½ è¿˜å¯ä»¥åœ¨è¿™ä¸ªéƒ¨åˆ†å®šä¹‰ç§æœ‰å­—æ®µï¼Œè¯¸å¦‚ï¼š 12345&#123; "sub": "1234567890", "name": "John Doe", "admin": true&#125; å€¼å¾—æ³¨æ„çš„æ˜¯æœ‰æ•ˆè½½è·çš„å­˜å‚¨æ•°æ®çš„å¤§å°ä¼šå½±å“æ•´ä¸ªJWTçš„å¤§å°ï¼Œä¸€èˆ¬æ¥è¯´å¯¹JWTçš„å¤§å°æ²¡æœ‰é™åˆ¶ä½†æ˜¯è¿‡å¤§çš„JWTå¯èƒ½ä¼šå½±å“æ€§èƒ½æˆ–é€ æˆæ½œåœ¨çš„é—®é¢˜ã€‚ ç¬¬ä¸‰æ­¥ åˆ›å»ºç­¾åï¼ˆsignatureï¼‰ç­¾åæ˜¯ä¸ºäº†é˜²æ­¢æ•°æ®è¢«ç¯¡æ”¹ã€‚ JWTçš„ç­¾åä½¿ç”¨ä»¥ä¸‹ä¼ªä»£ç å®žçŽ°ï¼š 1234// signature algorithmdata = base64urlEncode( header ) + â€œ.â€ + base64urlEncode( payload )hashedData = hash( data, secret )signature = base64urlEncode( hashedData ) è¯¥ç®—æ³•æ‰€åšçš„ä½¿ç”¨base64urlEncodeå¯¹åœ¨ç¬¬ä¸€æ­¥åˆ›å»ºçš„å¤´éƒ¨å’Œç¬¬äºŒéƒ¨ä¸­çš„æœ‰æ•ˆè´Ÿè½½åˆ†åˆ«è¿›è¡Œç¼–ç å¹¶ç”¨â€.â€å·æ‹¼æŽ¥æˆå­—ç¬¦ä¸²ã€‚éšåŽä½¿ç”¨JWTå¤´ä¸­æŒ‡å®šçš„æ•£åˆ—ç®—æ³•å¯¹å­—ç¬¦ä¸²ä½¿ç”¨å¯†é’¥è¿›è¡Œæ•£åˆ—ã€‚æœ€åŽå†ä½¿ç”¨base64urlEncodeå¯¹ç”Ÿæˆçš„æ•£åˆ—æ•°æ®è¿›è¡Œç¼–ç ä»¥äº§ç”ŸJWTç­¾åã€‚ï¼ˆå¯†é’¥åªæœ‰æœåŠ¡å™¨æ‰çŸ¥é“ï¼Œä¸èƒ½æ³„éœ²ç»™ç”¨æˆ·ï¼‰ è¿™ç¯‡æ–‡ç« ä¸­ï¼Œä½¿ç”¨base64urlEncodeå¯¹headerå’Œpayloadè¿›è¡Œç¼–ç åŽå¾—åˆ°å¦‚ä¸‹ç»“æžœï¼š 1234567891011// headerbase64urlEncode(&#123; "typ": "JWT", "alg": "HS256"&#125;)eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9// payload// base64urlEncode(&#123; "userId": "b08f86af-35da-48f2-8fab-cef3904660bd"&#125;)eyJ1c2VySWQiOiJiMDhmODZhZi0zNWRhLTQ4ZjItOGZhYi1jZWYzOTA0NjYwYmQifQ ç„¶åŽå°†ç»“æžœä»£å…¥ä¸Šé¢çš„ä¼ªä»£ç ä¼šå¾—åˆ°å¦‚ä¸‹ç­¾åï¼š 12// signature-xN_h82PHVTCMA9vdoHrcZxH-x5mb11y1537t3rGzcM ç¬¬å››æ­¥ ç”ŸæˆJWTçŽ°åœ¨æˆ‘ä»¬å·²ç»åˆ›å»ºå®Œæˆäº†JWTçš„headerã€payloadã€signature3ä¸ªéƒ¨åˆ†ï¼Œé‚£ä¹ˆå†æŒ‰ç…§ header.payload.signature çš„æ ¼å¼å°†3ä¸ªéƒ¨åˆ†ç»„åˆèµ·æ¥å°±æ˜¯æ‰€è°“çš„JWTäº†ã€‚å¦‚ä¸‹å°±æ˜¯æˆ‘ä»¬ðŸŒ°ä¸­çš„JWT 12// JWTeyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJ1c2VySWQiOiJiMDhmODZhZi0zNWRhLTQ4ZjItOGZhYi1jZWYzOTA0NjYwYmQifQ.-xN_h82PHVTCMA9vdoHrcZxH-x5mb11y1537t3rGzcM åœ¨JWTå®˜æ–¹ç½‘ç«™ï¼Œä½ å¯ä»¥å°è¯•åˆ›å»ºè‡ªå·±çš„JWTã€‚ å›žåˆ°æˆ‘ä»¬çš„æ¡ˆä¾‹ï¼Œè¿™ä¸ªAuthentication Server å·²ç»åˆ›å»ºäº†ä¸€ä¸ªJWTï¼Œå¹¶ä¸”å‘ç»™äº†ç”¨æˆ·ã€‚ JWTæ˜¯æ€Žä¹ˆä¿æŠ¤æ•°æ®çš„æ³¨æ„ï¼Œè¿™é‡Œç»å¸¸ä¼šæœ‰ä¸€ä¸ªè¯¯åŒºï¼ŒJWTæœ¬èº«å’Œå®‰å…¨æ²¡å…³ç³»ï¼Œå®ƒå°±ä»…ä»…åªæ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œä½¿ç”¨å®ƒæ¥åšå®‰å…¨è¿œä¸å¦‚ç±»ä¼¼äºŽRSA2è¿™æ ·çš„éžå¯¹ç§°åŠ å¯†çš„å½¢å¼æ¥çš„å®žåœ¨ï¼Œç”±äºŽå®¢æˆ·ç«¯çš„ç¨‹åºå¯¹ç”¨æˆ·å‡ ä¹Žå®Œå…¨é€æ˜Žï¼ŒéªŒç­¾çš„è¿‡ç¨‹å¯¹äºŽä»–ä»¬æ¥è®²ä¹Ÿæ˜¯é€æ˜Žçš„ï¼Œæ‰€ä»¥å®‰å…¨æ€§è‚¯å®šä¸ä¼šé è¿™ä¸ªæ¥å®žçŽ°ï¼Œå¦‚æžœå®žåœ¨æ€•JWTçš„è¢«ç›—å–ï¼Œå¯ä»¥è€ƒè™‘åœ¨Payloadéƒ¨åˆ†åŠ å…¥ä¸€äº›å®¢æˆ·ç«¯ç‹¬æœ‰çš„éžæ•æ„Ÿä¿¡æ¯ï¼Œç”¨äºŽåœ¨æœåŠ¡ç«¯æ¥è¿›è¡Œæ ¸éªŒï¼Œæ¯”å¦‚ä½¿ç”¨MAC-Message Authentication Codeã€æˆ–è€…å…¬é’¥ä¹‹ç±»çš„ç­‰ç­‰; æˆ–è€…å¹²è„†å°±æŠŠç”Ÿæ•ˆæ—¶é—´è®¾ç½®çš„çŸ­ä¸€äº›ï¼Œä¹Ÿå¯ä»¥å‡å°‘æš´éœ²çš„é£Žé™©ã€‚ JWTçš„æ•°æ®è¢«ç¼–ç å’Œè¢«ç­¾åï¼Œä½†æ˜¯æ²¡æœ‰è¢«åŠ å¯†ã€‚ç¼–ç çš„ç›®çš„æ˜¯è½¬åŒ–æ•°æ®ç»“æž„ï¼Œç­¾åæ˜¯ä¸ºäº†æ•°æ®çš„æŽ¥æ”¶è€…éªŒè¯æ•°æ®çš„æƒå¨æ€§ã€‚æ‰€ä»¥ç¼–ç å’Œç­¾åå¹¶ä¸ä¼šä¿æŠ¤æ•°æ®çš„å®‰å…¨æ€§ã€‚è€ŒåŠ å¯†çš„ä¸»è¦ç›®çš„æ‰æ˜¯ä¸ºäº†ä¿æŠ¤æ•°æ®å®‰å…¨é˜²æ­¢æœªæŽˆæƒè®¿é—®ã€‚å¯¹äºŽè¯¦ç»†æè¿°ç¼–ç ä¸ŽåŠ å¯†çš„åŒºåˆ«ï¼Œå¯ä»¥å‚è€ƒè¿™ç¯‡æ–‡ç« ã€‚ Since JWT are signed and encoded only, and since JWT are not encrypted, JWT do not guarantee any security for sensitive data. ç”±äºŽJWTä»…ä»…è¢«ç¼–ç å’Œç­¾åè€Œæ²¡æœ‰è¢«åŠ å¯†è¿‡çš„ï¼Œæ‰€ä»¥å®ƒæ— æ³•ä¿è¯ä»»ä½•æ•æ„Ÿä¿¡æ¯çš„å®‰å…¨æ€§ã€‚ ç¬¬äº”æ­¥ éªŒè¯JWTç¬¬å››æ­¥ä¸­æˆ‘ä»¬å·²ç»çŸ¥é“JWTçš„ç­¾åç”Ÿæˆéœ€è¦ç”¨å¯†é’¥ï¼ˆsecretï¼‰ï¼Œè¿™ä¸ªå¯†é’¥åªæœ‰æŽˆæƒæœåŠ¡å™¨çŸ¥é“ã€‚åº”ä¸ŽæœåŠ¡å™¨å¼€å¯è®¤è¯å¤„ç†æ—¶ï¼Œéœ€è¦ä»ŽæŽˆæƒæœåŠ¡å™¨èŽ·å–æ­¤å¯†é’¥ã€‚æ­¤åŽå½“ç”¨æˆ·æºå¸¦JWTè®¿é—®åº”ç”¨æœåŠ¡å™¨æ—¶ï¼Œåº”ç”¨æœåŠ¡å™¨æ‹¿åˆ°JWTåŽå¯ä»¥é€šè¿‡ç±»ä¼¼ç¬¬ä¸‰æ­¥çš„æ–¹æ³•ç”Ÿæˆä¸€ä¸ªç­¾åï¼Œç„¶åŽä¸Žç”¨æˆ·æºå¸¦çš„JWTçš„ç­¾åè¿›è¡Œå¯¹æ¯”ä»Žè€ŒéªŒè¯ç”¨æˆ·JWTæ˜¯å¦æœ‰æ•ˆã€‚ ç»“æŸè¯­æœ¬æ–‡ä¸­æè¿°çš„JWTè®¤è¯è®¾ç½®ä½¿ç”¨å¯¹ç§°å¯†é’¥ç®—æ³•ï¼ˆHS256ï¼‰ã€‚æ‚¨ä¹Ÿå¯ä»¥ä½¿ç”¨éžå¯¹ç§°ç®—æ³•ï¼ˆä¾‹å¦‚RS256ï¼‰ï¼Œå³æŽˆæƒæœåŠ¡å™¨å…·æœ‰å¯†é’¥ï¼Œå¹¶ä¸”åº”ç”¨ç¨‹åºæœåŠ¡å™¨å…·æœ‰å…¬é’¥ã€‚äº†è§£ä½¿ç”¨å¯¹ç§°å’Œéžå¯¹ç§°ç®—æ³•ä¹‹é—´å·®å¼‚çš„è¯¦ç»†åˆ†ç±»ã€‚ è¿˜åº”è¯¥æ³¨æ„ï¼ŒJWTåº”è¯¥é€šè¿‡HTTPSè¿žæŽ¥ï¼ˆè€Œä¸æ˜¯HTTPï¼‰å‘é€ã€‚HTTPSæœ‰åŠ©äºŽé˜²æ­¢æœªç»æŽˆæƒçš„ç”¨æˆ·çªƒå–æ‰€å‘é€çš„JWTï¼Œä»Žè€Œæ— æ³•æ‹¦æˆªæœåŠ¡å™¨å’Œç”¨æˆ·ä¹‹é—´çš„é€šä¿¡ã€‚ åŒæ—¶ï¼ŒJWTåº”è¯¥è®¾ç½®æœ‰æ•ˆæœŸï¼Œå¹¶ä¸”æœ‰æ•ˆæœŸä¸è¦å¤ªé•¿ã€‚]]></content>
      <categories>
        <category>web</category>
      </categories>
      <tags>
        <tag>JWT</tag>
        <tag>HTTPS</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[JSè¿›é˜¶--bindåŽŸç†åŠå®žçŽ°]]></title>
    <url>%2Fweb%2FLP20190705A%2F</url>
    <content type="text"><![CDATA[â€œProgrammers are in a race with the Universe to create bigger and better idiot-proof programs, while the Universe is trying to create bigger and better idiots. So far the Universe is winning.â€ â€”Rich Cook å®˜æ–¹æè¿°é¦–å…ˆæˆ‘ä»¬å…ˆæ¥çœ‹çœ‹MDNä¸Šå¯¹äºŽbindå‡½æ•°çš„å®šä¹‰ï¼Œä¸»è¦æœ‰ä¸‰ä¸ªç‰¹ç‚¹: bindå‡½æ•°ä¼šåˆ›å»ºä¸€ä¸ªæ–°å‡½æ•°ï¼ˆç§°ä¸ºç»‘å®šå‡½æ•°ï¼‰ï¼Œæ–°å‡½æ•°ä¸ŽåŽŸå‡½æ•°å…·æœ‰ç›¸åŒçš„å‡½æ•°ä½“ï¼ˆåœ¨ ECMAScript 5 è§„èŒƒä¸­å†…ç½®çš„callå±žæ€§ï¼‰ å½“ç”Ÿæˆçš„æ–°å‡½æ•°è¢«è°ƒç”¨æ‰§è¡Œæ—¶ï¼Œå…¶thiså€¼å§‹ç»ˆæŒ‡å‘bindå‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°ä¸”æ— æ³•æ”¹å˜ binå‡½æ•°å¯ä»¥æŽ¥å—é¢„è®¾çš„å‚æ•°ï¼Œè¯¥å‚æ•°æœ€ç»ˆæä¾›ç»™åŽŸå‡½æ•° æ–°å‡½æ•°ä¹Ÿèƒ½ä½¿ç”¨newæ“ä½œç¬¦åˆ›å»ºå¯¹è±¡,è¿™ç§è¡Œä¸ºå°±åƒæŠŠåŽŸå‡½æ•°å½“æˆæž„é€ å™¨ã€‚æä¾›çš„ thiså€¼è¢«å¿½ç•¥ï¼ŒåŒæ—¶è°ƒç”¨æ—¶çš„å‚æ•°è¢«æä¾›ç»™æ¨¡æ‹Ÿå‡½æ•° ç”¨ä¾‹è¯´æ˜Žä¼—æ‰€å‘¨çŸ¥ï¼ŒJSä¸­å‡½æ•°(ES6ç®­å¤´å‡½æ•°é™¤å¤–)çš„thisæŒ‡å‘æ˜¯åœ¨å‡½æ•°æ‰§è¡Œæ—¶åŠ¨æ€ç»‘å®šçš„ï¼Œå‡½æ•°å®šä¹‰å’Œå®žé™…è¿è¡Œæ—¶çš„æ‰€å¤„çš„çŽ¯å¢ƒä¸ä¸€æ ·ï¼Œå¾€å¾€å¯¼è‡´æœªçŸ¥çš„bugã€‚ å°¤å…¶æ˜¯åœ¨Reactç»„ä»¶ä¸­ï¼Œç»å¸¸ä¼šç”±äºŽthisæŒ‡å‘é—®é¢˜å¯¼è‡´æ— æ³•è°ƒç”¨åˆ°å‡½æ•°ï¼Œæ‰€ä»¥é€šå¸¸æˆ‘ä»¬ä¼šåœ¨constructorå‡½æ•°ä¸­ä½¿ç”¨bindå‡½æ•°æ¥ç»‘å®šthis(å½“ç„¶ä¸€èˆ¬æˆ‘ä»¬éƒ½ä¼šä½¿ç”¨ç®­å¤´å‡½æ•°æ¥é¿å…æ­¤ç±»æƒ…å†µ)ã€‚ 123456789101112131415var name = "paopaolee"function test()&#123; console.log(this.name)&#125;var obj = &#123; name: "lepaopao", print: test,&#125;test(); // paopaoleeobj.print(); // lepaopaovar obj1 = &#123; name: 'xxxxxx', print: test.bind(this) // è¿”å›žäº†ä¸€ä¸ªæ–°å‡½æ•°å¹¶ä¸”thisæŒ‡å‘window&#125;obj1.print(); // paopaolee åŠ¨æ‰‹å®žçŽ°ç¬¬ä¸€ç‰ˆç›®æ ‡ï¼šå®žçŽ°æè¿°ä¸­çš„ç‰¹å¾1ã€2ã€3 åˆ†æžï¼šè¿”å›žçš„ç»“æžœæ˜¯ä¸€ä¸ªå‡½æ•°ï¼›æ–°å‡½æ•°è°ƒç”¨æ—¶thisæŒ‡å‘ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œ å¯ä»¥é€šè¿‡call/applyå‡½æ•°è§£å†³ï¼Œcall/applyå‡½æ•°çš„åŒºåˆ«åœ¨äºŽå‚æ•°ä¼ é€’ï¼Œå‰è€…éœ€é€ä¸€åˆ—å‡ºï¼ŒåŽè€…å¯ä»¥ä¼ é€’æ•°ç»„ï¼›bindå‡½æ•°å¯æŽ¥å—é¢„è®¾å‚æ•°æœ€ç»ˆæä¾›åŽŸå‡½æ•°ï¼Œç”±äºŽå‚æ•°ä¸ç¡®å®šï¼Œæ‰€ä»¥é€‰ç”¨applyå®žçŽ°ã€‚ å®žçŽ°ï¼š 12345678Function.prototype.paopaoleeBind = function (Othat) &#123; var slice = Array.prototype.slice; var self = this; //æ™®é€šè°ƒç”¨æ—¶ï¼Œ thisæŒ‡å‘bindè°ƒç”¨è€… var args = slice(arguments, 1); return function () &#123; self.apply(Othat, args); &#125;&#125; ç¬¬äºŒç‰ˆé—®é¢˜ï¼šç¬¬ä¸€ç‰ˆä¸­åˆæ­¥å®žçŽ°äº†å‰ä¸‰ä¸ªç‰¹å¾ï¼Œå½“ç„¶è¿˜æœ‰è¯¸å¤šé—®é¢˜ï¼Œä¾‹å¦‚å¦‚æžœæ–°å‡½æ•°æ‰§è¡Œæ—¶éœ€è¦æœ‰è¿”å›žå€¼ã€ç¬¬ä¸€ç‰ˆä¸­å®žçŽ°äº†ç»‘å®šæ—¶ä¼ å‚ï¼Œé‚£æ–°å‡½æ•°è°ƒç”¨æ—¶ä¼ å‚æ•°å‘¢ï¼Ÿä»¥åŠbindå‡½æ•°è°ƒç”¨ä¸æ­£ç¡®ç­‰ç­‰ã€‚ ä¼˜åŒ–ï¼š 1234567891011121314Function.prototype.paopaoleeBind = function (Othat) &#123; var slice = Array.prototype.slice; var toString = Array.portotype.toString; var self = this; // è§£å†³: éžæ³•è°ƒç”¨ if(typeof self !=== 'function' || toString(self) !== [object Function])&#123; throw new TypeError("incorrectly call"); &#125; var args = slice(arguments, 1); return function () &#123; // è§£å†³: æ–°å‡½æ•°æ‰§è¡Œæ—¶returnè¿”å›žå€¼ return self.apply(Othat, args.concat(slice.call(arguments))); // è§£å†³: æ–°å‡½æ•°æ‰§è¡Œå¯æŽ¥å—å‚æ•° &#125;&#125; ç¬¬ä¸‰ç‰ˆç›®æ ‡ï¼š è§£å†³bindå‡½æ•°çš„ç¬¬ä¸‰ä¸ªç‰¹å¾: ä¸€ä¸ªç»‘å®šå‡½æ•°ä¹Ÿèƒ½ä½¿ç”¨newæ“ä½œç¬¦åˆ›å»ºå¯¹è±¡ï¼šè¿™ç§è¡Œä¸ºå°±åƒæŠŠåŽŸå‡½æ•°å½“æˆæž„é€ å™¨ã€‚æä¾›çš„ this å€¼è¢«å¿½ç•¥ï¼ŒåŒæ—¶è°ƒç”¨æ—¶çš„å‚æ•°è¢«æä¾›ç»™æ¨¡æ‹Ÿå‡½æ•°ã€‚ ä¹Ÿå°±æ˜¯è¯´bindæ‰§è¡Œè¿”å›žçš„æ–°å‡½æ•°ä½œä¸ºæž„é€ å‡½æ•°æ‰§è¡Œæ—¶ï¼Œbindæ—¶æŒ‡å®šçš„å¯¹è±¡(å‚æ•°Othat)ä¼šå¤±æ•ˆï¼Œä½†æ˜¯ä¼ å…¥çš„å‚æ•°ä¾ç„¶æœ‰æ•ˆã€‚ ä¸¾ä¸ªðŸŒ°ï¼š 123456789101112131415161718var vaule = 2var obj = &#123; value: 1&#125;function female(name, age)&#123; this.favorite = 'shopping'; console.log(this.value); console.log(name, age);&#125;female.prototype.husband = 'leepaopao';var boundFunc = female.bind(obj, 'paopaolee');var p = new bindedFunc(23);// undefined// paopaolee 23consple.log(p.habit); // shoppingconsple.log(p.husband); // leepaopao å°½ç®¡åœ¨windowä»¥åŠobjä¸­éƒ½å£°æ˜Žäº†valueå€¼ï¼Œä½†æœ€ç»ˆ(this.value)ä¾ç„¶è¿”å›žäº†undefinedï¼Œè¯´æ˜Žæ­¤æ—¶thiså³ä¸æŒ‡å‘windowä¹Ÿä¸æŒ‡å‘objï¼Œbindæ—¶ç»‘å®šçš„thisï¼ˆobjï¼‰å¤±æ•ˆäº†ã€‚æ‰€ä»¥æ­¤æ—¶thisçœŸæ­£æŒ‡å‘çš„æ˜¯femaleçš„å®žä¾‹ã€‚ åˆ†æžï¼š è¦åˆ¤æ–­æ–°å‡½æ•°è°ƒç”¨æ—¶æ˜¯å¦ä¸ºnewæž„é€ å‡½æ•°è°ƒç”¨ï¼Œå¯ä»¥é€šè¿‡thisæ˜¯å¦ä¸ºæ–°å‡½æ•°çš„å®žä¾‹,æ‰€ä»¥æˆ‘ä»¬æŠŠè¿”å›žçš„åŒ¿åå‡½æ•°æ¢æˆå…·åå‡½æ•°ï¼Œä»¥ä¾¿åˆ¤æ–­ã€‚ å®žçŽ° 1234567891011121314151617Function.prototype.paopaoleeBind = function (Othat) &#123; var slice = Array.prototype.slice; var toString = Array.portotype.toString; var self = this; // è§£å†³: éžæ³•è°ƒç”¨ if(typeof self !=== 'function' || toString(self) !== [object Function])&#123; throw new TypeError("incorrectly call"); &#125; var args = slice(arguments, 1); function boundFunc() &#123; // åˆ¤æ–­thisæ˜¯å¦ä¸ºboundFuncå®žä¾‹ï¼Œå¦‚æžœæ˜¯è¯´æ˜Žæ˜¯newæž„é€ å‡½æ•°è°ƒç”¨ï¼Œå¦åˆ™æ˜¯æ™®é€šè°ƒç”¨ var Othis = this instanceof boundFunc ? this : Othat; // è§£å†³: æ–°å‡½æ•°æ‰§è¡Œæ—¶returnè¿”å›žå€¼ return self.apply(Othis, args.concat(slice.call(arguments))); // è§£å†³: æ–°å‡½æ•°æ‰§è¡Œå¯æŽ¥å—å‚æ•° &#125; return boundFunc;&#125; ç¬¬å››ç‰ˆé—®é¢˜ï¼š ç¬¬ä¸‰ç‰ˆä¸­ï¼Œæˆ‘ä»¬è§£å†³äº†bindå‡½æ•°çš„ç¬¬4ä¸ªç‰¹å¾ï¼Œä½†æ˜¯ä½¿ç”¨newæ“ä½œç¬¦åˆ›å»ºå¯¹è±¡æ—¶ï¼ŒthisæŒ‡å‘çš„æ˜¯boundFuncçš„å®žä¾‹ï¼Œæ— æ³•ç»§æ‰¿åŽŸå‡½æ•°çš„åŽŸåž‹ä¸­çš„å±žæ€§ï¼ŒåŽŸåž‹é“¾é­åˆ°ç ´åã€‚ ç›®æ ‡ï¼šé‡å¡‘åŽŸåž‹é“¾ å®žçŽ°ï¼š 123456789101112131415161718Function.prototype.paopaoleeBind = function (Othat) &#123; var slice = Array.prototype.slice; var toString = Array.portotype.toString; var self = this; // è§£å†³: éžæ³•è°ƒç”¨ if(typeof self !=== 'function' || toString(self) !== [object Function])&#123; throw new TypeError("incorrectly call"); &#125; var args = slice(arguments, 1); function boundFunc() &#123; // åˆ¤æ–­thisæ˜¯å¦ä¸ºboundFuncå®žä¾‹ï¼Œå¦‚æžœæ˜¯è¯´æ˜Žæ˜¯newæž„é€ å‡½æ•°è°ƒç”¨ï¼Œå¦åˆ™æ˜¯æ™®é€šè°ƒç”¨ var Othis = this instanceof boundFunc ? this : Othat; // è§£å†³: æ–°å‡½æ•°æ‰§è¡Œæ—¶returnè¿”å›žå€¼ return self.apply(Othis, args.concat(slice.call(arguments))); // è§£å†³: æ–°å‡½æ•°æ‰§è¡Œå¯æŽ¥å—å‚æ•° &#125; boundFunc.prototype = this.portotype; return boundFunc;&#125; ä¸Šè¿°ä»£ç ï¼Œé‡å¡‘åŽŸåž‹é“¾çš„åšæ³•æ˜¯ç›´æŽ¥å°†boundFunc.prototype = this.prototypeï¼Œç›¸å½“äºŽç›´æŽ¥ç”¨åŽŸå‡½æ•°çš„prototypeè¦†ç›–æŽ‰äº†boundFuncå‡½æ•°åŽŸæ¥çš„prototypeï¼Œè¿™æ ·å¦‚æžœæˆ‘ä»¬æ›´æ”¹boundFunc.prototypeä¸­çš„å±žæ€§æ˜¯ä¹Ÿä¼šå½±å“åŽŸå‡½æ•°çš„prototypeä¸Šçš„å±žæ€§ã€‚ æœ€ç»ˆç‰ˆ12345678910111213141516171819202122232425Function.prototype.paopaoleeBind = function (Othat) &#123; var slice = Array.prototype.slice; var toString = Array.portotype.toString; var self = this; // è§£å†³: éžæ³•è°ƒç”¨ if(typeof self !=== 'function' || toString(self) !== [object Function])&#123; throw new TypeError("incorrectly call"); &#125; var args = slice(arguments, 1); function boundFunc() &#123; // åˆ¤æ–­thisæ˜¯å¦ä¸ºboundFuncå®žä¾‹ï¼Œå¦‚æžœæ˜¯è¯´æ˜Žæ˜¯newæž„é€ å‡½æ•°è°ƒç”¨ï¼Œå¦åˆ™æ˜¯æ™®é€šè°ƒç”¨ var Othis = this instanceof boundFunc ? this : Othat; // è§£å†³: æ–°å‡½æ•°æ‰§è¡Œæ—¶returnè¿”å›žå€¼ return self.apply(Othis, args.concat(slice.call(arguments))); // è§£å†³: æ–°å‡½æ•°æ‰§è¡Œå¯æŽ¥å—å‚æ•° &#125; // é‡å¡‘åŽŸåž‹é“¾: æ–¹æ³•ä¸€ boundFunc.prototype = Object.create(this.portotype); // é‡å¡‘åŽŸåž‹é“¾: æ–¹æ³•äºŒ /**** function fNOP ()&#123;&#125; fNOP.prototype = this.prototype; fbound.prototype = new fNOP(); ****/ return boundFunc;&#125;]]></content>
      <categories>
        <category>web</category>
      </categories>
      <tags>
        <tag>JavaScript</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[JavaScriptçš„è£…ç®±æ‹†ç®±æœºåˆ¶?:è‡ªåŠ¨ç±»åž‹è½¬æ¢]]></title>
    <url>%2Fweb%2FLP20170809A%2F</url>
    <content type="text"><![CDATA[â€œProgramming is like sex: one mistake and youâ€™re providing support for a lifetime.â€ â€”Michael Sinz ä»‹ç»æœ€è¿‘åœ¨é€šè¿‡çœ‹çº¢å®ä¹¦ã€Šjavascript é«˜çº§æ•™ç¨‹ã€‹å­¦ä¹ js, ç”±äºŽè‡ªå·±æœ‰è¿‡ç¼–å†™Javaç¨‹åºçš„åŸºç¡€ï¼Œæ‰€ä»¥åœ¨å­¦ä¹ JSè¿‡ç¨‹ä¸­æ½œæ„è¯†åœ°ä¼šä¸ŽJavaè¯­è¨€ä¸­çš„ç›¸å…³ç‰¹æ€§è¿›è¡Œå¯¹æ¯”ã€‚åœ¨å­¦ä¹ javascriptåŸºæœ¬çš„æ•°æ®ç±»åž‹æ—¶ï¼Œä¹¦ä¸­å¤§è‡´æœ‰è¿™ä¹ˆä¸€æ®µå†…å®¹ï¼š 123&gt; var str1 = "some text";&gt; var str2 = str1.substring(3);&gt; å­—ç¬¦ä¸²å½“ç„¶æ˜¯åŸºæœ¬ç±»åž‹åŸºæœ¬ç±»åž‹å€¼ï¼Œç„¶è€Œè¿™é‡Œå´è°ƒç”¨å®ƒsubstringæ–¹æ³•ï¼Œä»Žé€»è¾‘ä¸Šå°†å®ƒä¸åº”è¯¥æœ‰æ–¹æ³•ï¼Œå…¶å®žï¼Œä¸ºäº†è®©æˆ‘ä»¬å®žçŽ°è¿™ç§ç›´è§‚çš„æ“ä½œï¼ŒåŽå°å·²ç»è‡ªåŠ¨å®Œæˆäº†ä¸€ç³»åˆ—çš„å¤„ç†ï¼š(1) åˆ›å»ºStringç±»åž‹çš„ä¸€ä¸ªå®žä¾‹ï¼›(2) åœ¨å®žä¾‹ä¸Šè°ƒç”¨æŒ‡å®šçš„æ–¹æ³•ï¼›(3) é”€æ¯è¿™ä¸ªå®žä¾‹ç»è¿‡è¿™ç§å¤„ç†ï¼ŒåŸºæœ¬çš„å­—ç¬¦ä¸²ç±»åž‹å°±å˜å¾—è·Ÿå¯¹è±¡ä¸€æ ·äº†ã€‚è€Œä¸”ä¸Šé¢çš„ä¸‰ä¸ªæ­¥éª¤ä¹Ÿé€‚ç”¨äºŽBooleanå’ŒNumberç±»åž‹å¯¹åº”çš„å¸ƒå°”å€¼å’Œæ•°å­—å€¼ã€‚ çœ‹åˆ°è¿™é‡Œï¼Œæˆ‘æƒ³è¯´è¿™ä¸å°±æ˜¯Javaä¸­çš„è‡ªåŠ¨è£…ç®±å—ï¼Ÿ ä»€ä¹ˆå«è‡ªåŠ¨è£…ç®±Javaä¸­ï¼Œè‡ªåŠ¨è£…ç®±(autoboxing)æ˜¯æŒ‡å°†åŽŸå§‹å€¼è½¬æ¢ä¸ºç›¸åº”åŒ…è£…å™¨ç±»çš„å¯¹è±¡ç§°ä¸ºè‡ªåŠ¨è£…ç®±ã€‚ä¾‹å¦‚ï¼Œå°†intè½¬æ¢ä¸ºIntegerç±»ã€‚ä»¥ä¸‹æƒ…å†µä¸­Javaç¼–è¯‘å™¨ä¼šåº”ç”¨è‡ªåŠ¨è£…ç®±ï¼š å°†åŽŸå§‹å€¼ä½œä¸ºå‚æ•°ä¼ é€’ç»™ä¸€ä¸ªæœŸæœ›æŽ¥æ”¶è¯¥åŽŸå§‹å€¼å¯¹åº”åŒ…è£…ç±»çš„å¯¹è±¡çš„æ–¹æ³•ï¼› å°†åŽŸå§‹å€¼èµ‹å€¼ç»™ä¸€ä¸ªç±»åž‹ä¸ºå…¶å¯¹åº”çš„åŒ…è£…ç±»å¯¹è±¡çš„å˜é‡ï¼›å½“ç„¶è‡ªåŠ¨æ‹†ç®±å°±æ˜¯è£…ç®±çš„é€†è¿‡ç¨‹ï¼Œä¸»è¦å‘ç”Ÿåœ¨ï¼š å°†åŒ…è£…ç±»å¯¹è±¡ä½œä¸ºå‚æ•°ä¼ é€’ç»™ä¸€ä¸ªæœŸæœ›æŽ¥æ”¶å¯¹åº”åŽŸå§‹å€¼çš„æ–¹æ³•æ—¶ï¼› å°†åŒ…è£…ç±»å¯¹è±¡èµ‹å€¼ç»™ä¸€ä¸ªç±»åž‹ä¸ºå…¶å¯¹åº”åŽŸå§‹å€¼çš„å˜é‡ï¼›JavaScriptçš„è‡ªåŠ¨æ‹†è£…ç®±æœºåˆ¶å…¶å®žJavaScriptè¯­è¨€è§„èŒƒä¸­ï¼Œå¹¶æ²¡æœ‰æåŠè‡ªåŠ¨æ‹†è£…ç®±çš„æ¦‚å¿µï¼Œä¸è¿‡MDNä¸­å€’æ˜¯æœ‰æåˆ°è¿‡ç±»ä¼¼æ¦‚å¿µï¼š function.apply(thisArg, [argArry])thisArg: The value of this provided for the call to func. Note that this may not be the actual value seen by the method: if the method is a function in non-strict mode code, null and undefined will be replaced with the global object, and primitive values will be boxed. This argument is not optional ä¸ŽJavaè¿™ç§å®Œå…¨é¢å‘å¯¹è±¡çš„é™æ€è¯­è¨€æˆªç„¶ä¸åŒï¼ŒJavaScriptæ˜¯ä¸€é—¨åŠ¨æ€çš„è¯­è¨€ï¼Œå®ƒç”šè‡³éƒ½æ²¡æœ‰ç±»æ¦‚å¿µï¼ˆå³ä½¿ES6å¸¦æ¥class,ä½†æ˜¯å®ƒä¹Ÿåªä¸è¿‡è¯­æ³•ç³–ï¼‰ï¼Œè¿™ä½¿å¾—å®ƒå…·æœ‰å¾ˆå¤§çš„çµæ´»æ€§ï¼Œå½“ç„¶ä¹Ÿå¸¦æ¥äº†å¾ˆå¤šè®©äººå¾ˆéš¾ç†è§£æŽŒæ¡çš„ç‰¹æ€§ï¼Œæ¯”å¦‚==å’Œ===ï¼›æ‰€ä»¥å¯¹äºŽJavaä¸­çš„è‡ªåŠ¨æ‹†è£…ç®±æœºåˆ¶ï¼Œåœ¨JSä¸­å…¶å®žå¯ä»¥ç†è§£ä¸ºå¤§å®¶ç†ŸçŸ¥çš„ç±»åž‹è½¬æ¢ä¸­çš„ä¸€ç§ç‰¹æ®Šæƒ…å†µã€‚ JavaScriptä¸­çš„ç±»åž‹è½¬æ¢ ç±»åž‹è½¬æ¢å‘ç”Ÿåœ¨é™æ€ç±»åž‹è¯­è¨€çš„ç¼–è¯‘é˜¶æ®µï¼Œè€Œå¼ºåˆ¶ç±»åž‹è½¬æ¢åˆ™å‘ç”Ÿåœ¨åŠ¨æ€ç±»åž‹è¯­è¨€çš„è¿è¡Œæ—¶(runtime)ã€‚ç„¶è€Œåœ¨ JavaScript ä¸­é€šå¸¸å°†å®ƒä»¬ç»Ÿç§°ä¸ºå¼ºåˆ¶ç±»åž‹è½¬æ¢ï¼Œæˆ‘ä¸ªäººåˆ™å€¾å‘äºŽç”¨â€œéšå¼å¼ºåˆ¶ç±»åž‹è½¬æ¢â€(implicit coercion)å’Œâ€œæ˜¾å¼å¼ºåˆ¶ç±»åž‹è½¬æ¢â€(explicit coercion)æ¥åŒºåˆ†ã€‚â€”â€” å¼•ç”¨è‡ªã€Šä½ ä¸çŸ¥é“çš„JS ä¸Šã€‹ JavaScriptæ˜¯ä¸€ç§åŠ¨æ€ç±»åž‹è¯­è¨€ï¼Œå¯¹å˜é‡ä¸ä¼šåƒé™æ€è¯­è¨€é‚£æ ·åšç±»åž‹æ£€æŸ¥ï¼Œå¯ä»¥éšæ—¶èµ‹äºˆä»»æ„å€¼ï¼Œä½†æ˜¯JSä¸­å„ç§è¿ç®—ç¬¦æˆ–è¡¨è¾¾å¼å¯¹æ•°æ®ç±»åž‹æ˜¯æœ‰è¦æ±‚çš„ã€‚å¦‚æžœè¿ç®—ç¬¦å‘çŽ°ï¼Œè¿ç®—å­çš„ç±»åž‹ä¸Žé¢„æœŸä¸ç¬¦ï¼Œå°±ä¼šè‡ªåŠ¨è½¬æ¢ç±»åž‹ã€‚ä¾‹å¦‚æœ€å¸¸è§çš„ï¼Œifè¯­å¥éœ€è¦ä¸€ä¸ªå¸ƒå°”å€¼ï¼Œå› æ­¤åœ¨æ‹¬å·ä¸­å®šä¹‰çš„ä»»ä½•å†…å®¹éƒ½å°†è½¬æ¢ä¸ºå¸ƒå°”å€¼ï¼Œwhileä¹Ÿæ˜¯å¦‚æ­¤ã€‚ Javascriptç±»åž‹è½¬æ¢ä¸­æœ‰å¾ˆå¤šå‘ï¼Œå°±è¿žDouglas Crockfordåœ¨ã€ŠJavascript: The Good Partsã€‹ä¸€ä¹¦ä¸­ä¹ŸæžåŠ› â€˜åæ§½â€™ ã€‚ ç±»åž‹è½¬æ¢ä¹Ÿåˆ†ä¸ºæ˜¾ç¤ºç±»åž‹è½¬æ¢å’Œéšå¼ç±»åž‹è½¬æ¢ï¼Œ éšå¼ç±»åž‹è½¬æ¢ å½“ç¼–è¯‘å™¨åœ¨æ²¡æœ‰ç¨‹åºå‘˜å¹²é¢„çš„æƒ…å†µä¸‹è‡ªåŠ¨æ‰§è¡Œç±»åž‹è½¬æ¢ï¼Œç§°ä¸ºéšå¼ç±»åž‹è½¬æ¢ã€‚ ä¸Šè¿°çš„ifè¯­å¥ä¸­é»˜è®¤å°†å€¼è½¬æ¢æˆå¸ƒå°”ç±»åž‹å°±å±žäºŽéšå¼ç±»åž‹è½¬æ¢ï¼Œ10 + &#39;10&#39; == 20 ä¹Ÿå±žäºŽéšå¼ç±»åž‹è½¬æ¢;JSä¸­çš„éšå¼ç±»åž‹è½¬æ¢å…¶å®žç†è§£ä¸ºJavaä¸­çš„è‡ªåŠ¨æ‹†è£…ç®±ã€‚æˆ‘ä»¬å†æ¥çœ‹ä¸Šæ–‡ä»‹ç»ä¸­çš„ä¾‹å­ï¼š 123&gt; var str1 = "some text";&gt; var str2 = str1.substring(3);&gt; è¿™é‡Œæˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼Œstr1åœ¨è°ƒç”¨subStringæ–¹æ³•æ—¶ï¼ŒJSå¼•æ“Žè‡ªåŠ¨å°†Stringç±»åž‹str1å˜é‡é€šè¿‡new String()çš„æ–¹å¼éšå¼è½¬æ¢æˆäº†å­—ç¬¦ä¸²å¯¹è±¡ï¼Œæ‰€ä»¥æ­¤æ—¶ä»–æ‰èƒ½è®¿é—®subStringå±žæ€§æ–¹æ³•ï¼Œè¿™ä¸ªè¿‡ç¨‹å°±å¯¹åº”ç€è‡ªåŠ¨è£…ç®±ï¼›é‚£ä¹ˆå¯¹åº”çš„ï¼Œåœ¨æ‰§è¡Œå®ŒsubStringæ–¹æ³•åŽï¼Œæˆ‘ä»¬ç»§ç»­è®¿é—®str1å˜é‡ï¼Œé‚£å®ƒçš„å€¼ä¾ç„¶ä¼šæ˜¯â€some textâ€ï¼Œè¿™åˆæ˜¯é—®ä»€ä¹ˆå‘¢ï¼ŸæŒ‰ç†è¯´è‡ªåŠ¨è£…ç®±åŽstr1ä¸åº”è¯¥æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²å¯¹è±¡å—ï¼ŸåŽŸæ¥åœ¨æ‰§è¡Œå®Œæ–¹æ³•åŽï¼ŒJSè§£é‡Šå™¨åˆå°†str1å˜é‡é€šè¿‡str1.toString()(è¿™é‡Œä¹Ÿå¯ä»¥é€šè¿‡str1.valueOf())éšå¼è½¬æ¢æˆäº†Stringç±»åž‹ï¼Œè¿™ä¸ªè¿‡ç¨‹å³ä¸ºè‡ªåŠ¨æ‹†ç®±ã€‚ JSä¸­çš„â€œè‡ªåŠ¨è£…ç®±â€æœºåˆ¶å…¶å®žå°±æ˜¯å°†åŽŸå§‹å€¼ç±»åž‹éšå¼è½¬æ¢æˆå¼•ç”¨ç±»åž‹çš„è¿‡ç¨‹,è¿™ç§æƒ…å†µä¸»è¦å‘ç”Ÿåœ¨ä¸¤ç§æƒ…å†µä¸‹ï¼š åœ¨éžä¸¥æ ¼æ¨¡å¼ä¸‹ï¼Œä¼ é€’ä¸€ä¸ªåŽŸå§‹å€¼ç±»åž‹ä½œä¸ºfunction.call/applyçš„thiså‚æ•°æ—¶ åŽŸå§‹å€¼ç±»åž‹è®¿é—®å±žæ€§æ—¶ï¼Œä¾‹å¦‚ï¼š &quot;paopao lee&quot;.split(&#39; &#39;) åœ¨ç¬¬ä¸€ç§æƒ…å†µä¸­ï¼Œéžä¸¥æ ¼æ¨¡å¼ä¸‹ï¼Œå½“ä¸€ä¸ªå‡½æ•°æ‰§è¡Œæ—¶ï¼Œå¦‚æžœthiså€¼ä¸æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œé‚£ä¹ˆå®ƒå°†å…¶è‡ªåŠ¨è½¬æ¢ä¸ºå¯¹è±¡ï¼Œè¿›ä¸€æ­¥äº†è§£ The following steps are performed when control enters the ã€‹ã€‹ &gt; execution context for function code contained in function object F, a caller provided thisArg, and a caller provided argumentsList: if the function code is strict code, set the ThisBinding to thisArg. else if thisArg is null or undefined, set the ThisBinding to the global object. else if Type(thisArg) is not Object, set the ThisBinding to ToObject(thisArg).â€¦ ä»Žä¸Šé¢å¯ä»¥çœ‹åˆ°ï¼Œç¬¬3æ­¥ä¸­ï¼ŒåŽŸå§‹å€¼ç±»åž‹ä¼šè¢«ä½¿ç”¨ToObject(thisArg)è½¬æ¢ä¸ºå¯¹è±¡ã€‚ ç¬¬äºŒç§æƒ…å†µä¸­ï¼Œå½“ä½ é€šè¿‡[]æˆ–.è®¿é—®å±žæ€§æ—¶ä¼šå‘ç”Ÿç±»ä¼¼çš„äº‹æƒ…ã€‚è¿™é‡Œå¼•ç”¨çš„éƒ¨åˆ†è§£é‡Šäº†JSå¦‚ä½•è®¡ç®—è¡¨è¾¾å¼foo[bar]ã€‚ The production MemberExpression: MemberExpression[Expression] is evaluated as follows: Let baseReference be the result of evaluating MemberExpression. Let baseValue be GetValue(baseReference).â€¦ Return a value of type Reference whose base value is &gt; baseValue and whose referenced name is propertyNameString, and whose strict mode flag is strict. æœ€é‡è¦çš„æœ€åŽä¸€æ­¥ï¼Œæ— è®ºMemberExpressionè®¡ç®—ä»€ä¹ˆï¼Œå®ƒéƒ½è½¬æ¢ä¸ºReferenceç±»åž‹çš„å€¼ã€‚è¿™æ˜¯ä¸€ç§ä»…åœ¨è§„èŒƒä¸­ä½¿ç”¨çš„æ•°æ®ç±»åž‹ï¼Œå¹¶ä¸”åŒ…å«å…³äºŽå¦‚ä½•ä»Žå¼•ç”¨æ£€ç´¢å®žé™…å€¼çš„é™„åŠ ä¿¡æ¯(ä¸è¦ä¸Žå®žé™…JavaScriptä»£ç ä¸­çš„å¯¹è±¡å¼•ç”¨æ··æ·†!)ä¸ºäº†ä»ŽReferenceä¸­èŽ·å¾—â€œçœŸå®žçš„â€å€¼æˆ–ç»“æžœï¼Œä¼šè°ƒç”¨å†…éƒ¨å‡½æ•°GetValue(V)(å°±åƒä¸Šé¢çš„æ­¥éª¤2): The following [[Get]] internal method is used by GetValue when V is a property reference with a primitive base value. It is called using base as its this value and with property P as its argument. The following steps are taken: Let O be ToObject(base).â€¦ ä¸¾ä¸ªðŸŒ°ï¼š 1var foo = "BAR`.toLowerCase(); è¿™æ˜¯ä¸€ä¸ªèµ‹å€¼è¡¨è¾¾å¼ï¼Œå…¶è®¡ç®—æ–¹æ³•å¦‚ä¸‹ï¼š The production AssignmentExpression : LeftHandSideExpression = AssignmentExpression is evaluated as follows: Let lref be the result of evaluating LeftHandSideExpression. Let rref be the result of evaluating AssignmentExpression. Let rval be GetValue(rref).â€¦ ç¬¬1æ­¥: å·¦è¾¹æ±‚å€¼ï¼Œä¹Ÿå°±æ˜¯æ ‡è¯†ç¬¦â€™fooâ€™ã€‚æ ‡è¯†ç¬¦çš„è§£æžæ–¹å¼å¹¶ä¸é‡è¦ç¬¬2æ­¥: å¯¹å³è¾¹æ±‚å€¼ï¼Œå³&quot;BAR&quot;.toLowerCase(), è¯¥è®¡ç®—çš„å†…éƒ¨ç»“æžœå°†æ˜¯ä¸€ä¸ªReferenceå¹¶å­˜å‚¨åœ¨rrefä¸­ï¼Œç±»ä¼¼äºŽ: 12345REFERENCE = &#123; base: "BAR", propertyNameString: "toLowerCase", strict: false&#125; ç¬¬3æ­¥: GetValue(rref)è¢«è°ƒç”¨,ç”±äºŽrrefçš„å¼•ç”¨å€¼(REFERENCE)çš„baseå±žæ€§å€¼æ˜¯å­—ç¬¦ä¸²â€BARâ€ï¼Œæ˜¯åŽŸå§‹ç±»ï¼Œæ‰€ä»¥ä¼šè°ƒç”¨ToObjectå°†å®ƒæš‚æ—¶è½¬æ¢ä¸ºStringå¯¹è±¡ï¼Œæ­¤å¤–ï¼ŒREFERENCEå®žé™…ä¸Šä»£è¡¨äº†ä¸€ä¸ªå±žæ€§è®¿é—®ï¼Œå› æ­¤GetValue(rref)æœ€ç»ˆä¼šè°ƒç”¨Stringå¯¹è±¡ä¸Šçš„æ–¹æ³•toLowerCaseå¹¶è¿”å›žæ–¹æ³•çš„ç»“æžœã€‚ æ˜¾å¼ç±»åž‹è½¬æ¢ ç¨‹åºå‘˜å¼ºåˆ¶æ‰§è¡Œçš„ç±»åž‹è½¬æ¢ç§°ä¸ºæ˜¾å¼ç±»åž‹è½¬æ¢ã€‚åŸºæœ¬ä¸Šï¼Œç¨‹åºå‘˜å¼ºåˆ¶è¡¨è¾¾å¼ä¸ºç‰¹å®šç±»åž‹ã€‚ Explictç±»åž‹è½¬æ¢ä¹Ÿç§°ä¸ºç±»åž‹è½¬æ¢ã€‚ æ˜¾ç¤ºè½¬æ¢å…¶å®žå¾ˆå¥½ç†è§£ 12345678910// å­—ç¬¦ä¸²è½¬æ¢var a = 42;var b = String(a);// æ•°å­—è½¬æ¢var c = '3.14';var d = Number(c);// å¸ƒå°”å€¼è½¬æ¢var e = [];var f = Boolean(e)var f = !![]; å‚è€ƒé“¾æŽ¥ Does javascript autobox? Type conversion - MDN]]></content>
      <categories>
        <category>web</category>
      </categories>
      <tags>
        <tag>javascript</tag>
      </tags>
  </entry>
</search>
