<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title><![CDATA[Setã€Mapã€WeakSetã€WeakMapçš„åŒºåˆ«]]></title>
    <url>%2Fweb%2FLP20190710A%2F</url>
    <content type="text"><![CDATA[â€œGood programmers use their brains, but good guidelines save us having to think out every case.â€â€”Francis Glassborow å‰è¨€ å¤§å¤šæ•°ä¸»æµç¼–ç¨‹è¯­è¨€éƒ½æœ‰å¤šç§å†…ç½®çš„æ•°æ®é›†åˆã€‚ä¾‹å¦‚Pythonæ‹¥æœ‰åˆ—è¡¨ï¼ˆlistï¼‰ã€å…ƒç»„ï¼ˆtupleï¼‰å’Œå­—å…¸ï¼ˆdictionaryï¼‰,Javaæœ‰åˆ—è¡¨ï¼ˆlistï¼‰ã€é›†åˆï¼ˆset)ã€é˜Ÿåˆ—ï¼ˆqueueï¼‰ã€‚ç„¶è€ŒJavaScriptç›´åˆ°ES6çš„å‘å¸ƒä¹‹å‰ï¼Œåªæ‹¥æœ‰æ•°ç»„ï¼ˆarrayï¼‰å’Œå¯¹è±¡ï¼ˆobjectï¼‰è¿™ä¸¤ä¸ªå†…å»ºçš„æ•°æ®é›†åˆã€‚ES6çš„å‡ºçŽ°ï¼Œå¼•å…¥äº†è¯¸å¦‚Mapã€Setã€WeakeMapã€WeakMapç­‰æ–°çš„æ•°æ®ç»“æž„ä¸ºè¿™é—¨è¯­è¨€æ³¨å…¥äº†æ–°çš„èƒ½é‡å’Œæ´»åŠ›ã€‚ HashMapï¼ŒDictionaryç­‰æ•°æ®ç»“æž„æ˜¯å„ç§ç¼–ç¨‹è¯­è¨€å­˜å‚¨é”®/å€¼å¯¹çš„å‡ ç§æ–¹å¼ï¼Œè¿™äº›æ•°æ®ç»“æž„é’ˆå¯¹å¿«é€Ÿæ£€ç´¢è¿›è¡Œäº†ä¼˜åŒ–ã€‚å½“ç„¶ES6ä¸­çš„Mapã€Setã€WeakeMapã€WeakMapè¿™äº›æ•°æ®ç»“æž„åº•å±‚éƒ½æ˜¯é€šè¿‡ï¼ˆhash tablesï¼‰æ•£åˆ—è¡¨å®žçŽ°çš„ã€‚ Mapåœ¨ES5ä¸­,æˆ‘ä»¬é€šå¸¸ä½¿ç”¨å†…ç½®çš„Objectï¼ˆå®ƒä»¬åªæ˜¯å…·æœ‰é”®å’Œå€¼çš„å±žæ€§çš„ä»»æ„é›†åˆï¼‰æ¨¡æ‹ŸMapã€‚ä½†æ˜¯è¿™æ ·åšä¼šæœ‰ä¸‰ä¸ªç¼ºé™·ã€‚ JavaScriptä¸­Objectçš„å±žæ€§é”®æ˜¯Stringæˆ–Symbolï¼Œè¿™é™åˆ¶äº†å®ƒä»¬ä½œä¸ºä¸åŒæ•°æ®ç±»åž‹çš„é”®/å€¼å¯¹é›†åˆçš„èƒ½åŠ›ã€‚å½“ç„¶ï¼Œæ‚¨å¯ä»¥å°†å…¶ä»–æ•°æ®ç±»åž‹å¼ºåˆ¶/å­—ç¬¦ä¸²åŒ–ä¸ºå­—ç¬¦ä¸²ï¼Œä½†è¿™ä¼šå¢žåŠ é¢å¤–çš„å·¥ä½œé‡ã€‚ Objectä¸æ˜¯è®¾è®¡æ¥ä½œä¸ºä¸€ç§æ•°æ®é›†åˆï¼Œå› æ­¤æ²¡æœ‰æœ‰æ•ˆçš„æ–¹æ³•æ¥ç¡®å®šå¯¹è±¡å…·æœ‰å¤šå°‘å±žæ€§(è™½ç„¶æœ‰Object.keysï¼Œä½†æ˜¯å®ƒå¾ˆæ…¢ï¼‰ã€‚å¾ªçŽ¯éåŽ†å¯¹è±¡çš„å±žæ€§æ—¶ï¼Œè¿˜ä¼šèŽ·å¾—å…¶åŽŸåž‹å±žæ€§ã€‚æ‚¨å¯ä»¥å°†iterableå±žæ€§æ·»åŠ åˆ°æ‰€æœ‰å¯¹è±¡ï¼Œä½†ä¸æ˜¯æ‰€æœ‰å¯¹è±¡éƒ½å¯ä»¥ç”¨ä½œé›†åˆã€‚æ‚¨å¯ä»¥ä½¿ç”¨for â€¦ inå¾ªçŽ¯å’ŒhasOwnPropertyï¼ˆï¼‰æ–¹æ³•ï¼Œä½†è¿™åªæ˜¯ä¸€ç§è§£å†³æ–¹æ³•ã€‚å¾ªçŽ¯è®¿é—®å¯¹è±¡çš„å±žæ€§æ—¶ï¼Œä¸ä¸€å®šæŒ‰ç…§æ’å…¥çš„é¡ºåºæ£€ç´¢å±žæ€§ã€‚ Objectå…·æœ‰å†…ç½®æ–¹æ³•ï¼Œå¦‚constructorï¼ŒtoStringå’ŒvalueOfã€‚å¦‚æžœå…¶ä¸­ä¸€ä¸ªä½œä¸ºå±žæ€§æ·»åŠ ï¼Œåˆ™å¯èƒ½å¯¼è‡´å†²çªã€‚è™½ç„¶æ‚¨å¯ä»¥ä½¿ç”¨Object.create(null)æ¥åˆ›å»ºä¸€ä¸ªè£¸å¯¹è±¡ï¼ˆå®ƒä¸ä»Žobject.prototypeç»§æ‰¿ï¼‰ï¼Œä½†æ˜¯è¿™åªæ˜¯ä¸€ä¸ªå˜é€šæ–¹æ³•ã€‚ MDNå¯¹Mapå®šä¹‰: Mapå¯¹è±¡ä¿å­˜é”®å€¼å¯¹å¹¶è®°ä½é”®çš„åŽŸå§‹æ’å…¥é¡ºåºã€‚ä»»ä½•å€¼ï¼ˆå¯¹è±¡å’ŒåŽŸå§‹å€¼ï¼‰éƒ½å¯ä»¥ç”¨ä½œé”®æˆ–å€¼.å…¶ä¸­keyå€¼çš„å¯¹æ¯”æ˜¯åŸºäºŽä¸€ç§ç±»ä¼¼äºŽ===æ“ä½œç¬¦çš„ç®—æ³•ï¼Œä¸è¿‡NaNè¢«è®¤ä¸ºä¸Žè‡ªèº«ç›¸ç­‰ï¼ˆå°½ç®¡JSä¸­NaN!==NaNï¼Œå› æ­¤Mapä¸­å¯ä»¥ä½¿ç”¨NaNä½œä¸ºkey;&nbsp;Mapä¸­çš„é”®å€¼å¯¹æ˜¯æœ‰åºçš„,å› æ­¤åœ¨è¿­ä»£æ—¶çš„é¡ºåºä¸Žæ’å…¥æ—¶ä¸€è‡´ã€‚ æˆ‘ä»¬å¯ä»¥è½»æ¾åˆ›å»ºMapï¼Œæ·»åŠ /åˆ é™¤å€¼ï¼Œè¿­ä»£è®¿é—®é”®/å€¼å¹¶æœ‰æ•ˆç¡®å®šå…¶å¤§å°ã€‚ 1234567891011121314151617181920212223242526272829303132333435363738394041424344// new Map([iterable])let recipeMap = new Map([ ['Cucumber', '500 gr'], ['Tomatoes', '350 gr'],]);// Sets the value for the key in the Map object. Returns the Map object.recipeMap = recipeMap.set('Sour cream', '50 gr');// Returns a boolean asserting whether a value has been associated to the key in the Map object or not.console.log(recipeMap.has('Cucumber')); // true// loop by keysfor(let fruit of recipeMap.keys()) &#123; console.log(fruit); // Cucumber // Tomatoes // Sour cream&#125;// loop by values [key, value]for(let amount of recipeMap.values()) &#123; console.log(amount); // 500 gr // 350 gr // 50 gr&#125;// loop by recoedsfor(let entry of recipeMap) &#123; // same like recipeMap.entries() console.log(entry); // ["Cucumber", "500 gr"] // ["Tomatoes", "350 gr"] // ["Sour cream", "50 gr"]&#125;// Returns true if an element in the Map object existed and has been removed, or false if the element does not exist.console.log(recipeMap.delete('paopaolee')); // false // Removes all key/value pairs from the Map object.recipeMap.clear(); // Returns the number of key/value pairs in the Map object.console.log(recipeMap.size === 0); // True SetMDNå¯¹Mapå®šä¹‰: Setç®€å•æ¥è¯´å°±æ˜¯ä¸åŒ…å«é‡å¤é¡¹çš„å€¼çš„æœ‰åºé›†åˆï¼Œå®ƒå…è®¸æ‚¨å­˜å‚¨ä»»ä½•ç±»åž‹ï¼Œæ— è®ºæ˜¯åŽŸå§‹å€¼è¿˜æ˜¯å¯¹è±¡å¼•ç”¨ï¼Œä¸åƒæ•°ç»„é‚£æ ·ä½¿ç”¨ç´¢å¼•ï¼ŒSetä½¿ç”¨Keyè®¿é—®é›†åˆã€‚Setå·²ç»å­˜åœ¨äºŽJavaï¼ŒRubyï¼ŒPythonå’Œè®¸å¤šå…¶ä»–è¯­è¨€ä¸­ã€‚ ES6çš„Setä¸Žå…¶ä»–è¯­è¨€ä¹‹é—´çš„ä¸€ä¸ªåŒºåˆ«åœ¨äºŽES6ä¸­çš„Setæ˜¯æœ‰åºçš„ã€‚ 123456789101112131415161718const planetsOrderFromSun = new Set();planetsOrderFromSun.add('Mercury');planetsOrderFromSun.add('Venus').add('Earth').add('Mars'); // Chainable Methodconsole.log(planetsOrderFromSun.has('Earth')); // TrueplanetsOrderFromSun.delete('Mars');console.log(planetsOrderFromSun.has('Mars')); // Falsefor (const x of planetsOrderFromSun) &#123; console.log(x); // Same order in as out - Mercury Venus Earth&#125;console.log(planetsOrderFromSun.size); // 3planetsOrderFromSun.add('Venus'); // Trying to add a duplicateconsole.log(planetsOrderFromSun.size); // Still 3, Did not add the duplicateplanetsOrderFromSun.clear();console.log(planetsOrderFromSun.size); // 0 å¼±é›†åˆï¼Œå†…å­˜å’Œåžƒåœ¾å›žæ”¶JavaScriptåžƒåœ¾å›žæ”¶æœºåˆ¶æ˜¯ä¸€ç§å†…å­˜ç®¡ç†å½¢å¼ï¼Œå¯ä»¥è‡ªåŠ¨åˆ é™¤ä¸å†å¼•ç”¨çš„å¯¹è±¡å¹¶å›žæ”¶å…¶èµ„æºã€‚ JSä¸­ï¼Œå½“ä¸€ä¸ªå¯¹è±¡è¢«å¼•ç”¨çš„æ—¶å€™ï¼Œå¾€å¾€æ„å‘³ç€å®ƒæ­£åœ¨è¢«ä½¿ç”¨ï¼Œæˆ–è€…åœ¨å°†æ¥æœ‰å¯èƒ½ä¼šè¢«ä½¿ç”¨ã€‚æ­¤æ—¶å¯¹è±¡æ‰€å ç”¨çš„å†…å­˜ä¸ä¼šè¢«åžƒåœ¾å›žæ”¶æœºåˆ¶å›žæ”¶æŽ‰ã€‚Mapå’ŒSetæ‰€å¼•ç”¨çš„å¯¹è±¡ä¼šè¢«ä¿ç•™ï¼Œä¸å…è®¸è¿›è¡Œåžƒåœ¾å›žæ”¶ã€‚å¦‚æžœMapå’ŒSetå¼•ç”¨ç€ä¸å†éœ€è¦çš„å¤§å¯¹è±¡ï¼ˆä¾‹å¦‚å·²ç»ä»ŽDOMä¸­åˆ é™¤çš„DOMå…ƒç´ ï¼‰ï¼Œè¿™å¯èƒ½ä¼šæ¶ˆè€—å¤§é‡å†…å­˜ã€‚ &nbsp; ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒES6è¿˜å¼•å…¥äº†ä¸¤ä¸ªåä¸ºWeakMapå’ŒWeakSetçš„æ–°å¼±é›†åˆã€‚è¿™äº›ES6é›†åˆæ˜¯â€œå¼±â€çš„ï¼Œå› ä¸ºå®ƒä»¬å…è®¸ä»Žå†…å­˜ä¸­æ¸…é™¤ä¸å†éœ€è¦çš„å¯¹è±¡ã€‚ &nbsp;å¼±å¼•ç”¨åˆ™å¯ä»¥ç†è§£ä¸ºâ€œå¼•ç”¨äº†å¯¹è±¡ï¼Œä½†æ˜¯ä¸å½±å“å®ƒçš„åžƒåœ¾å›žæ”¶â€ï¼Œä¸¾ä¸ªðŸŒ°: 1234567var obj = &#123;&#125;;var wm = new WeakMap();wm.set(obj, 1);wm.get(obj); // 1......obj = null;wm.get(obj); // è¿™å¥æ²¡æœ‰æ„ä¹‰ åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼ŒWeakMapå®žä¾‹wmï¼ˆå¼±ï¼‰å¼•ç”¨äº†objå¯¹è±¡ï¼ˆç©ºå¯¹è±¡ï¼‰ï¼ŒæŽ¥ç€ä¸‹æ–¹ä»£ç é‡Šæ”¾äº†å¯¹ç©ºå¯¹è±¡çš„å¼•ç”¨ï¼ˆobj = nullï¼‰ï¼Œæ­¤æ—¶å’Œä¸Šä¾‹ä¸€æ ·ï¼Œç©ºå¯¹è±¡å°†è¢«åžƒåœ¾å›žæ”¶ã€‚ä¹Ÿå³wmä¸­æŒæœ‰çš„ç©ºå¯¹è±¡ï¼ˆå¼±ï¼‰å¼•ç”¨å¹¶ä¸å½±å“å¯¹å¯¹è±¡æœ¬èº«çš„åžƒåœ¾å›žæ”¶ã€‚è¿™å°±æ˜¯WeakMapä¸­â€œå¼±å¼•ç”¨â€çš„å«ä¹‰ã€‚ WeakMapMDNå¯¹Mapå®šä¹‰: WeakMapæ˜¯ä¸€ç§å¼±å¼•ç”¨keyçš„é”®å€¼å¯¹ï¼ˆkey/valueï¼‰é›†åˆï¼Œå…¶é”®ï¼ˆkeyï¼‰å¿…é¡»æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œå€¼ï¼ˆvalueï¼‰å¯ä»¥ä¸ºä»»æ„ç±»åž‹ã€‚æ­£ç”±äºŽè¿™æ ·çš„å¼±å¼•ç”¨ï¼ŒWeakMapçš„keyæ˜¯æ— æ³•æžšä¸¾çš„ (å³æ— æ³•åˆ—ä¸¾æ‰€æœ‰çš„key)ã€‚å¦‚æžœkeyæ˜¯å¯æžšä¸¾çš„è¯ï¼Œå…¶åˆ—è¡¨å°†ä¼šå—åžƒåœ¾å›žæ”¶æœºåˆ¶çš„å½±å“ï¼Œä»Žè€Œå¾—åˆ°ä¸ç¡®å®šçš„ç»“æžœã€‚æ‰€ä»¥æ— æ³•ä½¿ç”¨forâ€¦inæˆ–è€…forâ€¦ofç­‰è¯­å¥è¿­ä»£ã€‚ WeakMapä½¿ç”¨åœºæ™¯&nbsp;WeakMapsæœ‰å‡ ä¸ªæµè¡Œçš„ç”¨ä¾‹ã€‚å®ƒä»¬å¯ç”¨äºŽä¿æŒå¯¹è±¡çš„ç§æœ‰æ•°æ®ç§æœ‰åŒ–ï¼Œå®ƒä»¬è¿˜å¯ç”¨äºŽè·Ÿè¸ªDOMèŠ‚ç‚¹/å¯¹è±¡ã€‚ åœºæ™¯ä¸€ä½¿ç”¨WeakMapç®€åŒ–äº†ä¿æŒå¯¹è±¡æ•°æ®ç§æœ‰çš„è¿‡ç¨‹ã€‚privateDataå¯ä»¥å¼•ç”¨Personå¯¹è±¡ï¼Œä½†ä¸å…è®¸åœ¨æ²¡æœ‰ç‰¹å®šPersonå®žä¾‹çš„æƒ…å†µä¸‹è®¿é—®ï¼Œè€Œä¸”éšPersonå®žä¾‹å¯¹è±¡çš„é”€æ¯è€Œæ¶ˆå¤±ã€‚ 123456789101112var Person = (function() &#123; var privateData = new WeakMap(); function Person(name) &#123; privateData.set(this, &#123; name: name &#125;); &#125; Person.prototype.getName = function() &#123; return privateData.get(this).name; // åªèƒ½é€šè¿‡Personå®žä¾‹è®¿é—®å¯¹åº”çš„name &#125;; return Person();&#125;()); åœºæ™¯äºŒä½¿ç”¨WeakMapå¤„ç†äº‹ä»¶ç»‘å®š,åœ¨Reactä¸­å¦‚æžœç”¨åˆ°äº‹ä»¶ç›‘å¬å¤„ç†ï¼Œé€šå¸¸æˆ‘ä»¬å¿…é¡»è¦åœ¨å¯¹åº”çš„ç”Ÿå‘½å‘¨æœŸä¸­ç›¸åº”çš„è¿›è¡Œäº‹ä»¶ç»‘å®šæˆ–è§£é™¤ï¼Œä»¥é˜²æ­¢å†…å­˜æ³„æ¼ã€‚ç„¶è€Œå¦‚æžœä½¿ç”¨WeakMapï¼Œæˆ‘å¯ä»¥ä¸ç”¨æ‹…å¿ƒè¿™äº›é—®é¢˜ã€‚ 123456789101112131415161718192021222324var listeners = new WeakMap();// ç›‘å¬äº‹ä»¶function on(object, event, fn)&#123; var thisListeners = listeners.get(object); if(!thisListeners) thisListeners = &#123;&#125;; if(!thisListeners[event]) thisListeners[event] = []; thisListeners[event].push(fn); listeners.set(object, thisListeners);&#125;// è§¦å‘äº‹ä»¶function emit(object, event)&#123; var thisListeners = listeners.get(object); if(!thisListeners) thisListeners = &#123;&#125;; if(!thisListeners[event]) thisListeners[event] = []; thisListeners[event].forEach(function(fn)&#123; fn.call(object, event); &#125;);&#125;// ä½¿ç”¨var obj = &#123;&#125;;on(obj, 'hello', function()&#123; console.log('hello');&#125;);emit(obj, 'hello'); åœºæ™¯ä¸‰ä½¿ç”¨WeakMapè·Ÿè¸ªDOMèŠ‚ç‚¹ç¼–è¾‘ï¼Œåˆ é™¤å’Œæ›´æ”¹ã€‚ä¾‹å¦‚ï¼ŒGoogleçš„Polymeré¡¹ç›®åœ¨ä¸€æ®µåä¸ºPositionWalkerçš„ä»£ç ä¸­ä½¿ç”¨äº†WeakMap PositionWalker keeps track of a position within a DOM subtree, as a current node and an offset within that node. 12345678910111213141516171819202122_makeClone() &#123; this._containerClone = this.container.cloneNode(true); this._cloneToNodes = new WeakMap(); this._nodesToClones = new WeakMap(); ... let n = this.container; let c = this._containerClone; // find the currentNode's clone while (n !== null) &#123; if (n === this.currentNode) &#123; this._currentNodeClone = c; &#125; this._cloneToNodes.set(c, n); this._nodesToClones.set(n, c); n = iterator.nextNode(); c = cloneIterator.nextNode(); &#125;&#125; WeakSetMDNå¯¹Mapå®šä¹‰: WeakSetæ˜¯å¼±å¼•ç”¨çš„Setï¼Œå½“ä¸å†éœ€è¦å®ƒä»¬å¼•ç”¨çš„å¯¹è±¡æ—¶ï¼Œå®ƒä»¬çš„å…ƒç´ å¯ä»¥è¢«åžƒåœ¾æ”¶é›†ã€‚ WeakSetä¸å…è®¸è¿­ä»£ã€‚ 123456789101112var ws = new WeakSet();var foo = &#123;&#125;;var bar = &#123;&#125;;ws.add(foo);ws.add(bar);ws.has(foo); // truews.has(bar); // truews.delete(foo); // removes foo from the setws.has(foo); // false, foo has been removed WeakSetä½¿ç”¨åœºæ™¯WeakSetä½¿ç”¨åœºæ™¯ç›¸å½“æœ‰é™ï¼ˆè‡³å°‘ç›®å‰ä¸ºæ­¢ï¼‰ã€‚å¤§å¤šæ•°æ—©æœŸé‡‡ç”¨è€…éƒ½è¯´WeakSetå¯ç”¨äºŽæ ‡è®°å¯¹è±¡è€Œä¸ä¼šæ”¹å˜å®ƒä»¬ã€‚ES6-Features.orgæœ‰ä¸€ä¸ªæ·»åŠ å’Œåˆ é™¤WeakSetä¸­å…ƒç´ çš„ç¤ºä¾‹ï¼Œä»¥ä¾¿è·Ÿè¸ªå¯¹è±¡æ˜¯å¦å·²è¢«æ ‡è®°: 12345678910111213141516171819202122232425262728293031323334353637let isMarked = new WeakSet()let attachedData = new WeakMap()export class Node&#123; constructor(id)&#123; this.id = id; &#125; mark()&#123; isMarked.add(this); &#125; unmark()&#123; isMarked.delete(this); &#125; marked()&#123; return isMarked.has(this); &#125; set data(data)&#123; attachedData.set(this, data); &#125; get data()&#123; return attachedData.get(this); &#125;&#125;let foo = new Node("foo")JSON.stringify(foo) === '&#123;"id":"foo"&#125;'foo.mark()foo.data = "bar"foo.data === "bar"JSON.stringify(foo) === '&#123;"id":"foo"&#125;'isMarked.has(foo) === trueattachedData.has(foo) === truefoo = null /* remove only reference to foo */attachedData.has(foo) === falseisMarked.has(foo) === false å‚è€ƒæ–‡ç«  ES6 Collections: Using Map, Set, WeakMap, WeakSet ES2015 WeakMapçš„å­¦ä¹ å’Œä½¿ç”¨ JavaScript (ES-2015) Set, Map, WeakSet and WeakMap V8: Optimizing hash tables: hiding the hash code]]></content>
      <categories>
        <category>web</category>
      </categories>
      <tags>
        <tag>ES6</tag>
        <tag>JS</tag>
        <tag>Map</tag>
        <tag>Set</tag>
        <tag>WeakMap</tag>
        <tag>WeakSet</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[æ¼«è°ˆWeb--JWT]]></title>
    <url>%2Fweb%2FLP20190709A%2F</url>
    <content type="text"><![CDATA[â€œThe most amazing achievement of the computer software industry is its continuing cancellation of the steady and staggering gains made by the computer hardware industry.â€ â€”Henry Petroski å‰è¨€éšç€æŠ€æœ¯çš„å‘å±•ï¼Œåˆ†å¸ƒå¼webåº”ç”¨çš„æ™®åŠï¼Œé€šè¿‡sessionç®¡ç†ç”¨æˆ·ç™»å½•çŠ¶æ€æˆæœ¬è¶Šæ¥è¶Šé«˜ï¼Œå› æ­¤æ…¢æ…¢å‘å±•æˆä¸ºtokençš„æ–¹å¼åšç™»å½•èº«ä»½æ ¡éªŒï¼Œç„¶åŽé€šè¿‡tokenåŽ»å–redisä¸­çš„ç¼“å­˜çš„ç”¨æˆ·ä¿¡æ¯ï¼Œéšç€ä¹‹åŽjwtçš„å‡ºçŽ°ï¼Œæ ¡éªŒæ–¹å¼æ›´åŠ ç®€å•ä¾¿æ·åŒ–ï¼Œæ— éœ€é€šè¿‡redisç¼“å­˜ï¼Œè€Œæ˜¯æ‰€æœ‰æ•°æ®éƒ½ä¿å­˜åœ¨å®¢æˆ·ç«¯ï¼Œæ¯æ¬¡è¯·æ±‚éƒ½å‘å›žæœåŠ¡å™¨ï¼ŒéšåŽæœåŠ¡å™¨ç›´æŽ¥æ ¹æ®tokenå–å‡ºä¿å­˜çš„ç”¨æˆ·ä¿¡æ¯ï¼Œä»¥åŠå¯¹tokenå¯ç”¨æ€§æ ¡éªŒï¼Œå•ç‚¹ç™»å½•æ›´ä¸ºç®€å•ã€‚ è¿™ç¯‡æ–‡ç« ä¸­ä¸»è¦è®²è§£äº†å…³äºŽJSON Web Tokensï¼ˆJWTï¼‰çš„åŸºç¡€æ¦‚å¿µï¼Œä»¥åŠè§£é‡ŠJWTä¸ºä»€ä¹ˆä¼šè¢«å¹¿æ³›åº”ç”¨ã€‚JWTæ˜¯ç¡®ä¿åº”ç”¨ç¨‹åºä¿¡ä»»å’Œå®‰å…¨çš„é‡è¦éƒ¨åˆ†ï¼Œå®ƒå…è®¸ä»¥è¯¸å¦‚ç”¨æˆ·æ•°æ®ä¹‹ç±»çš„å®‰å…¨çš„æ–¹å¼å£°æ˜Žè¡¨ç¤ºã€‚ ä¸ºäº†JWTçš„å·¥ä½œåŽŸç†ï¼Œæˆ‘ä»¬å…ˆæ¥çœ‹ä¸€çœ‹å…³äºŽå®ƒçš„æŠ½è±¡å®šä¹‰ï¼š JSON Web Tokenï¼ˆJWTï¼‰æ˜¯ä¸€ç§JSONå¯¹è±¡ï¼Œåœ¨RFC 7519ä¸­å®šä¹‰ä¸ºè¡¨ç¤ºåŒæ–¹ä¹‹é—´çš„ä¸€ç»„ä¿¡æ¯çš„å®‰å…¨æ–¹å¼ï¼›å®ƒç”±å¤´éƒ¨ã€æœ‰æ•ˆè´Ÿè½½å’Œç­¾åä¸‰éƒ¨åˆ†ç»„æˆã€‚ æˆ‘ä»¬å®Œå…¨å¯ä»¥æŠŠJWTç®€å•åœ°çœ‹æˆä»…ä»…æ˜¯ç¬¦åˆä»¥ä¸‹æ ¼å¼çš„å­—ç¬¦ä¸² header.payload.signature Notes: åˆæ³•çš„JSONå¿…é¡»æ˜¯ä½¿ç”¨åŒå¼•å·çš„å­—ç¬¦ä¸² ä¸ºäº†ç†è§£JWTæ˜¯å¦‚ä½•è¢«ä½¿ç”¨çš„ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨Userï¼ˆç”¨æˆ·ï¼‰ã€Application Serverï¼ˆåº”ç”¨æœåŠ¡å™¨ï¼‰ã€Authentication Serverï¼ˆæŽˆæƒæœåŠ¡å™¨ï¼‰3ä¸ªç®€å•çš„å®žä½“åŠ ä»¥è§£é‡Šè¯´æ˜Žã€‚å…¶ä¸­Authentication Serverå°†æä¾›JWTç»™ç”¨æˆ·ï¼Œç”¨æˆ·æ‹¿åˆ°JWTåŽå°±å¯ä»¥å’Œåº”ç”¨ï¼ˆapp/websiteï¼‰å®‰å…¨åœ°é€šä¿¡ã€‚ ä¸Šå›¾ä¸­ï¼ŒUseræºå¸¦ç”¨æˆ·å/å¯†ç ç­‰å¯è¯æ˜Žèº«ä»½çš„å†…å®¹åŽ»æŽˆæƒæœåŠ¡å™¨èŽ·å–JWTä¿¡æ¯ï¼Œæ¯æ¬¡æœåŠ¡éƒ½æºå¸¦è¯¥Tokenå†…å®¹ä¸Žåº”ç”¨æœåŠ¡å™¨è¿›è¡Œäº¤äº’ï¼Œç”±åº”ç”¨æœåŠ¡å™¨æ¥éªŒè¯Tokenæ˜¯å¦æ˜¯æŽˆæƒç³»ç»Ÿå‘æ”¾çš„æœ‰æ•ˆTokenï¼Œæ¥éªŒè¯å½“å‰ä¸šåŠ¡æ˜¯å¦è¯·æ±‚æ˜¯å¦åˆæ³•ã€‚ æŽ¥ä¸‹æ¥æˆ‘ä»¬æ·±å…¥ç†è§£JWTæ˜¯å¦‚ä½•æž„é€ ä»¥åŠå¦‚ä½•éªŒè¯çš„ã€‚ ç¬¬ä¸€æ­¥ åˆ›å»ºå¤´éƒ¨ï¼ˆheaderï¼‰JWTçš„å¤´éƒ¨åŒ…å«äº†JWTè‡ªèº«çš„ç­¾åç®—æ³•ä¿¡æ¯ï¼Œå®ƒæ˜¯ä¸€ä¸ªå…·æœ‰å¦‚ä¸‹æ ¼å¼çš„JSONå¯¹è±¡ï¼š 1234&#123; "typ": "JWT", "alg": "HS256"&#125; è¿™ä¸ªJSONä¸­, typå±žæ€§è¡¨ç¤ºä»¤ç‰Œçš„ç±»åž‹ï¼ŒJWTä»¤ç‰Œç»Ÿä¸€å†™ä¸ºJWTã€‚algå±žæ€§è¡¨ç¤ºç­¾åä½¿ç”¨çš„ç®—æ³•ï¼Œé»˜è®¤ä¸ºHMAC SHA256ï¼ˆå†™ä¸ºHS256ï¼‰ ç¬¬äºŒéƒ¨ åˆ›å»ºæœ‰æ•ˆè½½è·ï¼ˆpayloadï¼‰JWTçš„æœ‰æ•ˆè½½è·å³æ˜¯JWTçš„ä¸»ä½“å†…å®¹éƒ¨åˆ†,åŒ…å«äº†éœ€è¦ä¼ é€’çš„æ•°æ®ï¼ˆè¿™äº›æ•°æ®ä¹Ÿè¢«ç§°ä¸ºJWTçš„å£°æ˜Žï¼‰ã€‚åœ¨æˆ‘ä»¬çš„ðŸŒ°ä¸­ï¼ŒJWTä¸­å­˜å‚¨äº†ç”¨æˆ·IDä¿¡æ¯ã€‚ 123&#123; "userId": "b08f86af-35da-48f2-8fab-cef3904660bd"&#125; ä¸Šé¢çš„ðŸŒ°ä¸­ï¼Œæˆ‘ä»¬çš„JWTä»…ä»…å­˜å‚¨äº†ä¸€ä¸ªä¿¡æ¯ã€‚ç„¶è€ŒJWT è§„å®šäº†7ä¸ªå®˜æ–¹å­—æ®µï¼Œä¾›é€‰ç”¨ iss (issuer)ï¼šç­¾å‘äºº exp (expiration time)ï¼šè¿‡æœŸæ—¶é—´ sub (subject)ï¼šä¸»é¢˜ aud (audience)ï¼šå—ä¼— nbf (Not Before)ï¼šç”Ÿæ•ˆæ—¶é—´ iat (Issued At)ï¼šç­¾å‘æ—¶é—´ jti (JWT ID)ï¼šç¼–å· å½“ç„¶é™¤äº†å®˜æ–¹å­—æ®µï¼Œä½ è¿˜å¯ä»¥åœ¨è¿™ä¸ªéƒ¨åˆ†å®šä¹‰ç§æœ‰å­—æ®µï¼Œè¯¸å¦‚ï¼š 12345&#123; "sub": "1234567890", "name": "John Doe", "admin": true&#125; å€¼å¾—æ³¨æ„çš„æ˜¯æœ‰æ•ˆè½½è·çš„å­˜å‚¨æ•°æ®çš„å¤§å°ä¼šå½±å“æ•´ä¸ªJWTçš„å¤§å°ï¼Œä¸€èˆ¬æ¥è¯´å¯¹JWTçš„å¤§å°æ²¡æœ‰é™åˆ¶ä½†æ˜¯è¿‡å¤§çš„JWTå¯èƒ½ä¼šå½±å“æ€§èƒ½æˆ–é€ æˆæ½œåœ¨çš„é—®é¢˜ã€‚ ç¬¬ä¸‰æ­¥ åˆ›å»ºç­¾åï¼ˆsignatureï¼‰ç­¾åæ˜¯ä¸ºäº†é˜²æ­¢æ•°æ®è¢«ç¯¡æ”¹ã€‚ JWTçš„ç­¾åä½¿ç”¨ä»¥ä¸‹ä¼ªä»£ç å®žçŽ°ï¼š 1234// signature algorithmdata = base64urlEncode( header ) + â€œ.â€ + base64urlEncode( payload )hashedData = hash( data, secret )signature = base64urlEncode( hashedData ) è¯¥ç®—æ³•æ‰€åšçš„ä½¿ç”¨base64urlEncodeå¯¹åœ¨ç¬¬ä¸€æ­¥åˆ›å»ºçš„å¤´éƒ¨å’Œç¬¬äºŒéƒ¨ä¸­çš„æœ‰æ•ˆè´Ÿè½½åˆ†åˆ«è¿›è¡Œç¼–ç å¹¶ç”¨â€.â€å·æ‹¼æŽ¥æˆå­—ç¬¦ä¸²ã€‚éšåŽä½¿ç”¨JWTå¤´ä¸­æŒ‡å®šçš„æ•£åˆ—ç®—æ³•å¯¹å­—ç¬¦ä¸²ä½¿ç”¨å¯†é’¥è¿›è¡Œæ•£åˆ—ã€‚æœ€åŽå†ä½¿ç”¨base64urlEncodeå¯¹ç”Ÿæˆçš„æ•£åˆ—æ•°æ®è¿›è¡Œç¼–ç ä»¥äº§ç”ŸJWTç­¾åã€‚ï¼ˆå¯†é’¥åªæœ‰æœåŠ¡å™¨æ‰çŸ¥é“ï¼Œä¸èƒ½æ³„éœ²ç»™ç”¨æˆ·ï¼‰ è¿™ç¯‡æ–‡ç« ä¸­ï¼Œä½¿ç”¨base64urlEncodeå¯¹headerå’Œpayloadè¿›è¡Œç¼–ç åŽå¾—åˆ°å¦‚ä¸‹ç»“æžœï¼š 1234567891011// headerbase64urlEncode(&#123; "typ": "JWT", "alg": "HS256"&#125;)eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9// payload// base64urlEncode(&#123; "userId": "b08f86af-35da-48f2-8fab-cef3904660bd"&#125;)eyJ1c2VySWQiOiJiMDhmODZhZi0zNWRhLTQ4ZjItOGZhYi1jZWYzOTA0NjYwYmQifQ ç„¶åŽå°†ç»“æžœä»£å…¥ä¸Šé¢çš„ä¼ªä»£ç ä¼šå¾—åˆ°å¦‚ä¸‹ç­¾åï¼š 12// signature-xN_h82PHVTCMA9vdoHrcZxH-x5mb11y1537t3rGzcM ç¬¬å››æ­¥ ç”ŸæˆJWTçŽ°åœ¨æˆ‘ä»¬å·²ç»åˆ›å»ºå®Œæˆäº†JWTçš„headerã€payloadã€signature3ä¸ªéƒ¨åˆ†ï¼Œé‚£ä¹ˆå†æŒ‰ç…§ header.payload.signature çš„æ ¼å¼å°†3ä¸ªéƒ¨åˆ†ç»„åˆèµ·æ¥å°±æ˜¯æ‰€è°“çš„JWTäº†ã€‚å¦‚ä¸‹å°±æ˜¯æˆ‘ä»¬ðŸŒ°ä¸­çš„JWT 12// JWTeyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJ1c2VySWQiOiJiMDhmODZhZi0zNWRhLTQ4ZjItOGZhYi1jZWYzOTA0NjYwYmQifQ.-xN_h82PHVTCMA9vdoHrcZxH-x5mb11y1537t3rGzcM åœ¨JWTå®˜æ–¹ç½‘ç«™ï¼Œä½ å¯ä»¥å°è¯•åˆ›å»ºè‡ªå·±çš„JWTã€‚ å›žåˆ°æˆ‘ä»¬çš„æ¡ˆä¾‹ï¼Œè¿™ä¸ªAuthentication Server å·²ç»åˆ›å»ºäº†ä¸€ä¸ªJWTï¼Œå¹¶ä¸”å‘ç»™äº†ç”¨æˆ·ã€‚ JWTæ˜¯æ€Žä¹ˆä¿æŠ¤æ•°æ®çš„æ³¨æ„ï¼Œè¿™é‡Œç»å¸¸ä¼šæœ‰ä¸€ä¸ªè¯¯åŒºï¼ŒJWTæœ¬èº«å’Œå®‰å…¨æ²¡å…³ç³»ï¼Œå®ƒå°±ä»…ä»…åªæ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œä½¿ç”¨å®ƒæ¥åšå®‰å…¨è¿œä¸å¦‚ç±»ä¼¼äºŽRSA2è¿™æ ·çš„éžå¯¹ç§°åŠ å¯†çš„å½¢å¼æ¥çš„å®žåœ¨ï¼Œç”±äºŽå®¢æˆ·ç«¯çš„ç¨‹åºå¯¹ç”¨æˆ·å‡ ä¹Žå®Œå…¨é€æ˜Žï¼ŒéªŒç­¾çš„è¿‡ç¨‹å¯¹äºŽä»–ä»¬æ¥è®²ä¹Ÿæ˜¯é€æ˜Žçš„ï¼Œæ‰€ä»¥å®‰å…¨æ€§è‚¯å®šä¸ä¼šé è¿™ä¸ªæ¥å®žçŽ°ï¼Œå¦‚æžœå®žåœ¨æ€•JWTçš„è¢«ç›—å–ï¼Œå¯ä»¥è€ƒè™‘åœ¨Payloadéƒ¨åˆ†åŠ å…¥ä¸€äº›å®¢æˆ·ç«¯ç‹¬æœ‰çš„éžæ•æ„Ÿä¿¡æ¯ï¼Œç”¨äºŽåœ¨æœåŠ¡ç«¯æ¥è¿›è¡Œæ ¸éªŒï¼Œæ¯”å¦‚ä½¿ç”¨MAC-Message Authentication Codeã€æˆ–è€…å…¬é’¥ä¹‹ç±»çš„ç­‰ç­‰; æˆ–è€…å¹²è„†å°±æŠŠç”Ÿæ•ˆæ—¶é—´è®¾ç½®çš„çŸ­ä¸€äº›ï¼Œä¹Ÿå¯ä»¥å‡å°‘æš´éœ²çš„é£Žé™©ã€‚ JWTçš„æ•°æ®è¢«ç¼–ç å’Œè¢«ç­¾åï¼Œä½†æ˜¯æ²¡æœ‰è¢«åŠ å¯†ã€‚ç¼–ç çš„ç›®çš„æ˜¯è½¬åŒ–æ•°æ®ç»“æž„ï¼Œç­¾åæ˜¯ä¸ºäº†æ•°æ®çš„æŽ¥æ”¶è€…éªŒè¯æ•°æ®çš„æƒå¨æ€§ã€‚æ‰€ä»¥ç¼–ç å’Œç­¾åå¹¶ä¸ä¼šä¿æŠ¤æ•°æ®çš„å®‰å…¨æ€§ã€‚è€ŒåŠ å¯†çš„ä¸»è¦ç›®çš„æ‰æ˜¯ä¸ºäº†ä¿æŠ¤æ•°æ®å®‰å…¨é˜²æ­¢æœªæŽˆæƒè®¿é—®ã€‚å¯¹äºŽè¯¦ç»†æè¿°ç¼–ç ä¸ŽåŠ å¯†çš„åŒºåˆ«ï¼Œå¯ä»¥å‚è€ƒè¿™ç¯‡æ–‡ç« ã€‚ Since JWT are signed and encoded only, and since JWT are not encrypted, JWT do not guarantee any security for sensitive data. ç”±äºŽJWTä»…ä»…è¢«ç¼–ç å’Œç­¾åè€Œæ²¡æœ‰è¢«åŠ å¯†è¿‡çš„ï¼Œæ‰€ä»¥å®ƒæ— æ³•ä¿è¯ä»»ä½•æ•æ„Ÿä¿¡æ¯çš„å®‰å…¨æ€§ã€‚ ç¬¬äº”æ­¥ éªŒè¯JWTç¬¬å››æ­¥ä¸­æˆ‘ä»¬å·²ç»çŸ¥é“JWTçš„ç­¾åç”Ÿæˆéœ€è¦ç”¨å¯†é’¥ï¼ˆsecretï¼‰ï¼Œè¿™ä¸ªå¯†é’¥åªæœ‰æŽˆæƒæœåŠ¡å™¨çŸ¥é“ã€‚åº”ä¸ŽæœåŠ¡å™¨å¼€å¯è®¤è¯å¤„ç†æ—¶ï¼Œéœ€è¦ä»ŽæŽˆæƒæœåŠ¡å™¨èŽ·å–æ­¤å¯†é’¥ã€‚æ­¤åŽå½“ç”¨æˆ·æºå¸¦JWTè®¿é—®åº”ç”¨æœåŠ¡å™¨æ—¶ï¼Œåº”ç”¨æœåŠ¡å™¨æ‹¿åˆ°JWTåŽå¯ä»¥é€šè¿‡ç±»ä¼¼ç¬¬ä¸‰æ­¥çš„æ–¹æ³•ç”Ÿæˆä¸€ä¸ªç­¾åï¼Œç„¶åŽä¸Žç”¨æˆ·æºå¸¦çš„JWTçš„ç­¾åè¿›è¡Œå¯¹æ¯”ä»Žè€ŒéªŒè¯ç”¨æˆ·JWTæ˜¯å¦æœ‰æ•ˆã€‚ ç»“æŸè¯­æœ¬æ–‡ä¸­æè¿°çš„JWTè®¤è¯è®¾ç½®ä½¿ç”¨å¯¹ç§°å¯†é’¥ç®—æ³•ï¼ˆHS256ï¼‰ã€‚æ‚¨ä¹Ÿå¯ä»¥ä½¿ç”¨éžå¯¹ç§°ç®—æ³•ï¼ˆä¾‹å¦‚RS256ï¼‰ï¼Œå³æŽˆæƒæœåŠ¡å™¨å…·æœ‰å¯†é’¥ï¼Œå¹¶ä¸”åº”ç”¨ç¨‹åºæœåŠ¡å™¨å…·æœ‰å…¬é’¥ã€‚äº†è§£ä½¿ç”¨å¯¹ç§°å’Œéžå¯¹ç§°ç®—æ³•ä¹‹é—´å·®å¼‚çš„è¯¦ç»†åˆ†ç±»ã€‚ è¿˜åº”è¯¥æ³¨æ„ï¼ŒJWTåº”è¯¥é€šè¿‡HTTPSè¿žæŽ¥ï¼ˆè€Œä¸æ˜¯HTTPï¼‰å‘é€ã€‚HTTPSæœ‰åŠ©äºŽé˜²æ­¢æœªç»æŽˆæƒçš„ç”¨æˆ·çªƒå–æ‰€å‘é€çš„JWTï¼Œä»Žè€Œæ— æ³•æ‹¦æˆªæœåŠ¡å™¨å’Œç”¨æˆ·ä¹‹é—´çš„é€šä¿¡ã€‚ åŒæ—¶ï¼ŒJWTåº”è¯¥è®¾ç½®æœ‰æ•ˆæœŸï¼Œå¹¶ä¸”æœ‰æ•ˆæœŸä¸è¦å¤ªé•¿ã€‚]]></content>
      <categories>
        <category>web</category>
      </categories>
      <tags>
        <tag>JWT</tag>
        <tag>HTTPS</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[JSè¿›é˜¶--bindå‡½æ•°]]></title>
    <url>%2Fweb%2FLP20190705A%2F</url>
    <content type="text"><![CDATA[â€œProgrammers are in a race with the Universe to create bigger and better idiot-proof programs, while the Universe is trying to create bigger and better idiots. So far the Universe is winning.â€ â€”Rich Cook å®˜æ–¹æè¿°é¦–å…ˆæˆ‘ä»¬å…ˆæ¥çœ‹çœ‹MDNä¸Šå¯¹äºŽbindå‡½æ•°çš„å®šä¹‰ï¼Œä¸»è¦æœ‰ä¸‰ä¸ªç‰¹ç‚¹: bindå‡½æ•°ä¼šåˆ›å»ºä¸€ä¸ªæ–°å‡½æ•°ï¼ˆç§°ä¸ºç»‘å®šå‡½æ•°ï¼‰ï¼Œæ–°å‡½æ•°ä¸ŽåŽŸå‡½æ•°å…·æœ‰ç›¸åŒçš„å‡½æ•°ä½“ï¼ˆåœ¨ ECMAScript 5 è§„èŒƒä¸­å†…ç½®çš„callå±žæ€§ï¼‰ å½“ç”Ÿæˆçš„æ–°å‡½æ•°è¢«è°ƒç”¨æ‰§è¡Œæ—¶ï¼Œå…¶thiså€¼å§‹ç»ˆæŒ‡å‘bindå‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°ä¸”æ— æ³•æ”¹å˜ binå‡½æ•°å¯ä»¥æŽ¥å—é¢„è®¾çš„å‚æ•°ï¼Œè¯¥å‚æ•°æœ€ç»ˆæä¾›ç»™åŽŸå‡½æ•° æ–°å‡½æ•°ä¹Ÿèƒ½ä½¿ç”¨newæ“ä½œç¬¦åˆ›å»ºå¯¹è±¡,è¿™ç§è¡Œä¸ºå°±åƒæŠŠåŽŸå‡½æ•°å½“æˆæž„é€ å™¨ã€‚æä¾›çš„ thiså€¼è¢«å¿½ç•¥ï¼ŒåŒæ—¶è°ƒç”¨æ—¶çš„å‚æ•°è¢«æä¾›ç»™æ¨¡æ‹Ÿå‡½æ•° ç”¨ä¾‹è¯´æ˜Žä¼—æ‰€å‘¨çŸ¥ï¼ŒJSä¸­å‡½æ•°(ES6ç®­å¤´å‡½æ•°é™¤å¤–)çš„thisæŒ‡å‘æ˜¯åœ¨å‡½æ•°æ‰§è¡Œæ—¶åŠ¨æ€ç»‘å®šçš„ï¼Œå‡½æ•°å®šä¹‰å’Œå®žé™…è¿è¡Œæ—¶çš„æ‰€å¤„çš„çŽ¯å¢ƒä¸ä¸€æ ·ï¼Œå¾€å¾€å¯¼è‡´æœªçŸ¥çš„bugã€‚ å°¤å…¶æ˜¯åœ¨Reactç»„ä»¶ä¸­ï¼Œç»å¸¸ä¼šç”±äºŽthisæŒ‡å‘é—®é¢˜å¯¼è‡´æ— æ³•è°ƒç”¨åˆ°å‡½æ•°ï¼Œæ‰€ä»¥é€šå¸¸æˆ‘ä»¬ä¼šåœ¨constructorå‡½æ•°ä¸­ä½¿ç”¨bindå‡½æ•°æ¥ç»‘å®šthis(å½“ç„¶ä¸€èˆ¬æˆ‘ä»¬éƒ½ä¼šä½¿ç”¨ç®­å¤´å‡½æ•°æ¥é¿å…æ­¤ç±»æƒ…å†µ)ã€‚ 123456789101112131415var name = "paopaolee"function test()&#123; console.log(this.name)&#125;var obj = &#123; name: "lepaopao", print: test,&#125;test(); // paopaoleeobj.print(); // lepaopaovar obj1 = &#123; name: 'xxxxxx', print: test.bind(this) // è¿”å›žäº†ä¸€ä¸ªæ–°å‡½æ•°å¹¶ä¸”thisæŒ‡å‘window&#125;obj1.print(); // paopaolee åŠ¨æ‰‹å®žçŽ°ç¬¬ä¸€ç‰ˆç›®æ ‡ï¼šå®žçŽ°æè¿°ä¸­çš„ç‰¹å¾1ã€2ã€3 åˆ†æžï¼šè¿”å›žçš„ç»“æžœæ˜¯ä¸€ä¸ªå‡½æ•°ï¼›æ–°å‡½æ•°è°ƒç”¨æ—¶thisæŒ‡å‘ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œ å¯ä»¥é€šè¿‡call/applyå‡½æ•°è§£å†³ï¼Œcall/applyå‡½æ•°çš„åŒºåˆ«åœ¨äºŽå‚æ•°ä¼ é€’ï¼Œå‰è€…éœ€é€ä¸€åˆ—å‡ºï¼ŒåŽè€…å¯ä»¥ä¼ é€’æ•°ç»„ï¼›bindå‡½æ•°å¯æŽ¥å—é¢„è®¾å‚æ•°æœ€ç»ˆæä¾›åŽŸå‡½æ•°ï¼Œç”±äºŽå‚æ•°ä¸ç¡®å®šï¼Œæ‰€ä»¥é€‰ç”¨applyå®žçŽ°ã€‚ å®žçŽ°ï¼š 12345678Function.prototype.paopaoleeBind = function (Othat) &#123; var slice = Array.prototype.slice; var self = this; //æ™®é€šè°ƒç”¨æ—¶ï¼Œ thisæŒ‡å‘bindè°ƒç”¨è€… var args = slice(arguments, 1); return function () &#123; self.apply(Othat, args); &#125;&#125; ç¬¬äºŒç‰ˆé—®é¢˜ï¼šç¬¬ä¸€ç‰ˆä¸­åˆæ­¥å®žçŽ°äº†å‰ä¸‰ä¸ªç‰¹å¾ï¼Œå½“ç„¶è¿˜æœ‰è¯¸å¤šé—®é¢˜ï¼Œä¾‹å¦‚å¦‚æžœæ–°å‡½æ•°æ‰§è¡Œæ—¶éœ€è¦æœ‰è¿”å›žå€¼ã€ç¬¬ä¸€ç‰ˆä¸­å®žçŽ°äº†ç»‘å®šæ—¶ä¼ å‚ï¼Œé‚£æ–°å‡½æ•°è°ƒç”¨æ—¶ä¼ å‚æ•°å‘¢ï¼Ÿä»¥åŠbindå‡½æ•°è°ƒç”¨ä¸æ­£ç¡®ç­‰ç­‰ã€‚ ä¼˜åŒ–ï¼š 1234567891011121314Function.prototype.paopaoleeBind = function (Othat) &#123; var slice = Array.prototype.slice; var toString = Array.portotype.toString; var self = this; // è§£å†³: éžæ³•è°ƒç”¨ if(typeof self !=== 'function' || toString(self) !== [object Function])&#123; throw new TypeError("incorrectly call"); &#125; var args = slice(arguments, 1); return function () &#123; // è§£å†³: æ–°å‡½æ•°æ‰§è¡Œæ—¶returnè¿”å›žå€¼ return self.apply(Othat, args.concat(slice.call(arguments))); // è§£å†³: æ–°å‡½æ•°æ‰§è¡Œå¯æŽ¥å—å‚æ•° &#125;&#125; ç¬¬ä¸‰ç‰ˆç›®æ ‡ï¼š è§£å†³bindå‡½æ•°çš„ç¬¬ä¸‰ä¸ªç‰¹å¾: ä¸€ä¸ªç»‘å®šå‡½æ•°ä¹Ÿèƒ½ä½¿ç”¨newæ“ä½œç¬¦åˆ›å»ºå¯¹è±¡ï¼šè¿™ç§è¡Œä¸ºå°±åƒæŠŠåŽŸå‡½æ•°å½“æˆæž„é€ å™¨ã€‚æä¾›çš„ this å€¼è¢«å¿½ç•¥ï¼ŒåŒæ—¶è°ƒç”¨æ—¶çš„å‚æ•°è¢«æä¾›ç»™æ¨¡æ‹Ÿå‡½æ•°ã€‚ ä¹Ÿå°±æ˜¯è¯´bindæ‰§è¡Œè¿”å›žçš„æ–°å‡½æ•°ä½œä¸ºæž„é€ å‡½æ•°æ‰§è¡Œæ—¶ï¼Œbindæ—¶æŒ‡å®šçš„å¯¹è±¡(å‚æ•°Othat)ä¼šå¤±æ•ˆï¼Œä½†æ˜¯ä¼ å…¥çš„å‚æ•°ä¾ç„¶æœ‰æ•ˆã€‚ ä¸¾ä¸ªðŸŒ°ï¼š 123456789101112131415161718var vaule = 2var obj = &#123; value: 1&#125;function female(name, age)&#123; this.favorite = 'shopping'; console.log(this.value); console.log(name, age);&#125;female.prototype.husband = 'leepaopao';var boundFunc = female.bind(obj, 'paopaolee');var p = new bindedFunc(23);// undefined// paopaolee 23consple.log(p.habit); // shoppingconsple.log(p.husband); // leepaopao å°½ç®¡åœ¨windowä»¥åŠobjä¸­éƒ½å£°æ˜Žäº†valueå€¼ï¼Œä½†æœ€ç»ˆ(this.value)ä¾ç„¶è¿”å›žäº†undefinedï¼Œè¯´æ˜Žæ­¤æ—¶thiså³ä¸æŒ‡å‘windowä¹Ÿä¸æŒ‡å‘objï¼Œbindæ—¶ç»‘å®šçš„thisï¼ˆobjï¼‰å¤±æ•ˆäº†ã€‚æ‰€ä»¥æ­¤æ—¶thisçœŸæ­£æŒ‡å‘çš„æ˜¯femaleçš„å®žä¾‹ã€‚ åˆ†æžï¼š è¦åˆ¤æ–­æ–°å‡½æ•°è°ƒç”¨æ—¶æ˜¯å¦ä¸ºnewæž„é€ å‡½æ•°è°ƒç”¨ï¼Œå¯ä»¥é€šè¿‡thisæ˜¯å¦ä¸ºæ–°å‡½æ•°çš„å®žä¾‹,æ‰€ä»¥æˆ‘ä»¬æŠŠè¿”å›žçš„åŒ¿åå‡½æ•°æ¢æˆå…·åå‡½æ•°ï¼Œä»¥ä¾¿åˆ¤æ–­ã€‚ å®žçŽ° 1234567891011121314151617Function.prototype.paopaoleeBind = function (Othat) &#123; var slice = Array.prototype.slice; var toString = Array.portotype.toString; var self = this; // è§£å†³: éžæ³•è°ƒç”¨ if(typeof self !=== 'function' || toString(self) !== [object Function])&#123; throw new TypeError("incorrectly call"); &#125; var args = slice(arguments, 1); function boundFunc() &#123; // åˆ¤æ–­thisæ˜¯å¦ä¸ºboundFuncå®žä¾‹ï¼Œå¦‚æžœæ˜¯è¯´æ˜Žæ˜¯newæž„é€ å‡½æ•°è°ƒç”¨ï¼Œå¦åˆ™æ˜¯æ™®é€šè°ƒç”¨ var Othis = this instanceof boundFunc ? this : Othat; // è§£å†³: æ–°å‡½æ•°æ‰§è¡Œæ—¶returnè¿”å›žå€¼ return self.apply(Othis, args.concat(slice.call(arguments))); // è§£å†³: æ–°å‡½æ•°æ‰§è¡Œå¯æŽ¥å—å‚æ•° &#125; return boundFunc;&#125; ç¬¬å››ç‰ˆé—®é¢˜ï¼š ç¬¬ä¸‰ç‰ˆä¸­ï¼Œæˆ‘ä»¬è§£å†³äº†bindå‡½æ•°çš„ç¬¬4ä¸ªç‰¹å¾ï¼Œä½†æ˜¯ä½¿ç”¨newæ“ä½œç¬¦åˆ›å»ºå¯¹è±¡æ—¶ï¼ŒthisæŒ‡å‘çš„æ˜¯boundFuncçš„å®žä¾‹ï¼Œæ— æ³•ç»§æ‰¿åŽŸå‡½æ•°çš„åŽŸåž‹ä¸­çš„å±žæ€§ï¼ŒåŽŸåž‹é“¾é­åˆ°ç ´åã€‚ ç›®æ ‡ï¼šé‡å¡‘åŽŸåž‹é“¾ å®žçŽ°ï¼š 123456789101112131415161718Function.prototype.paopaoleeBind = function (Othat) &#123; var slice = Array.prototype.slice; var toString = Array.portotype.toString; var self = this; // è§£å†³: éžæ³•è°ƒç”¨ if(typeof self !=== 'function' || toString(self) !== [object Function])&#123; throw new TypeError("incorrectly call"); &#125; var args = slice(arguments, 1); function boundFunc() &#123; // åˆ¤æ–­thisæ˜¯å¦ä¸ºboundFuncå®žä¾‹ï¼Œå¦‚æžœæ˜¯è¯´æ˜Žæ˜¯newæž„é€ å‡½æ•°è°ƒç”¨ï¼Œå¦åˆ™æ˜¯æ™®é€šè°ƒç”¨ var Othis = this instanceof boundFunc ? this : Othat; // è§£å†³: æ–°å‡½æ•°æ‰§è¡Œæ—¶returnè¿”å›žå€¼ return self.apply(Othis, args.concat(slice.call(arguments))); // è§£å†³: æ–°å‡½æ•°æ‰§è¡Œå¯æŽ¥å—å‚æ•° &#125; boundFunc.prototype = this.portotype; return boundFunc;&#125; ä¸Šè¿°ä»£ç ï¼Œé‡å¡‘åŽŸåž‹é“¾çš„åšæ³•æ˜¯ç›´æŽ¥å°†boundFunc.prototype = this.prototypeï¼Œç›¸å½“äºŽç›´æŽ¥ç”¨åŽŸå‡½æ•°çš„prototypeè¦†ç›–æŽ‰äº†boundFuncå‡½æ•°åŽŸæ¥çš„prototypeï¼Œè¿™æ ·å¦‚æžœæˆ‘ä»¬æ›´æ”¹boundFunc.prototypeä¸­çš„å±žæ€§æ˜¯ä¹Ÿä¼šå½±å“åŽŸå‡½æ•°çš„prototypeä¸Šçš„å±žæ€§ã€‚ æœ€ç»ˆç‰ˆ12345678910111213141516171819202122232425Function.prototype.paopaoleeBind = function (Othat) &#123; var slice = Array.prototype.slice; var toString = Array.portotype.toString; var self = this; // è§£å†³: éžæ³•è°ƒç”¨ if(typeof self !=== 'function' || toString(self) !== [object Function])&#123; throw new TypeError("incorrectly call"); &#125; var args = slice(arguments, 1); function boundFunc() &#123; // åˆ¤æ–­thisæ˜¯å¦ä¸ºboundFuncå®žä¾‹ï¼Œå¦‚æžœæ˜¯è¯´æ˜Žæ˜¯newæž„é€ å‡½æ•°è°ƒç”¨ï¼Œå¦åˆ™æ˜¯æ™®é€šè°ƒç”¨ var Othis = this instanceof boundFunc ? this : Othat; // è§£å†³: æ–°å‡½æ•°æ‰§è¡Œæ—¶returnè¿”å›žå€¼ return self.apply(Othis, args.concat(slice.call(arguments))); // è§£å†³: æ–°å‡½æ•°æ‰§è¡Œå¯æŽ¥å—å‚æ•° &#125; // é‡å¡‘åŽŸåž‹é“¾: æ–¹æ³•ä¸€ boundFunc.prototype = Object.create(this.portotype); // é‡å¡‘åŽŸåž‹é“¾: æ–¹æ³•äºŒ /**** function fNOP ()&#123;&#125; fNOP.prototype = this.prototype; fbound.prototype = new fNOP(); ****/ return boundFunc;&#125;]]></content>
      <categories>
        <category>web</category>
      </categories>
      <tags>
        <tag>JavaScript</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[JSè¿›é˜¶--Iterator and Generator]]></title>
    <url>%2FWeb%2FLP20180917A%2F</url>
    <content type="text"><![CDATA[â€œThe best programmers are not marginally better than merely good ones. They are an order-of-magnitude better, measured by whatever standard: conceptual creativity, speed, ingenuity of design, or problem-solving ability.â€ â€”Randall E. Stross å‰è¨€å¤§å¤šæ•°ç¼–ç¨‹è¯­è¨€å·²ç»ä»Žä½¿ç”¨forå¾ªçŽ¯ï¼ˆéœ€è¦åˆå§‹åŒ–å˜é‡ä»¥ä¾¿è·Ÿè¸ªæ•°æ®åœ¨é›†åˆä¸­çš„ä½ç½®ï¼‰è½¬è€Œä½¿ç”¨ä»¥ç¼–ç¨‹æ–¹å¼è¿”å›žé›†åˆä¸­ä¸‹ä¸€é¡¹çš„è¿­ä»£å™¨å¯¹è±¡æ¥è¿­ä»£æ•°æ®ã€‚ å°½ç®¡è¿­ä»£å™¨ä½¿å¾—å¤„ç†æ•°æ®é›†åˆæ›´åŠ å®¹æ˜“,ä½†æ˜¯ç”±äºŽéœ€è¦æ˜¾å¼åœ°ç»´æŠ¤å…¶å†…éƒ¨çŠ¶æ€ï¼Œå› æ­¤å®ƒä»¬çš„åˆ›å»ºéœ€è¦è°¨æ…Žçš„ç¼–ç¨‹ã€‚ç”Ÿæˆå™¨å‡½æ•°æä¾›äº†ä¸€ä¸ªå¼ºå¤§çš„é€‰æ‹©ï¼šå®ƒä»¬å…è®¸æ‚¨é€šè¿‡ç¼–å†™ä¸€ä¸ªæ‰§è¡Œä¸è¿žç»­çš„å‡½æ•°æ¥å®šä¹‰è¿­ä»£ç®—æ³•ã€‚ å¾ªçŽ¯é—®é¢˜å¦‚æžœä½ ä½¿ç”¨JavaScript(ES5)æ¥ç¼–å†™è¿‡ç¨‹åºï¼Œé‚£ä½ å¾ˆå¯èƒ½å†™ç±»ä¼¼ä¸€ä¸‹å­çš„ä»£ç ï¼š 1234var colors = ["red", "green", "blue"];for(var i = 0; i &lt; colors.length; i++)&#123; console.log(colord[i]);&#125; è¿™ç§æ ‡å‡†çš„forå¾ªçŽ¯ä¸­ï¼Œä½¿ç”¨å˜é‡iæ¥è¿½è¸ªcolorsæ•°ç»„çš„ç´¢å¼•ä½ç½®ï¼Œå˜é‡içš„å€¼ä¼šéšç€æ¯æ¬¡è¿­ä»£è€Œé€’å¢žç›´åˆ°å®ƒå¤§äºŽæ•°ç»„çš„é•¿åº¦å€¼ã€‚è™½ç„¶ä¸Šé¢çš„å¾ªçŽ¯ååˆ†ç®€å•ï¼Œä½†æ˜¯å½“ä½ åµŒå¥—å¾ªçŽ¯å¹¶ä¸”éœ€è¦è·Ÿè¸ªå¤šä¸ªå˜é‡æ—¶ï¼Œå¾ªçŽ¯ä¼šå˜å¾—å¤æ‚ã€‚é¢å¤–çš„å¤æ‚æ€§å¯èƒ½å¯¼è‡´é”™è¯¯ï¼Œå¹¶ä¸”forå¾ªçŽ¯çš„æ ·æ¿æ€§è´¨ä¼šå¯¼è‡´æ›´å¤šé”™è¯¯ï¼Œå› ä¸ºç±»ä¼¼çš„ä»£ç å†™åœ¨å¤šä¸ªåœ°æ–¹ã€‚è€Œè¿­ä»£å™¨æ—¨åœ¨è§£å†³è¿™äº›é—®é¢˜ã€‚ å¯è¿­ä»£åè®®ä¼—æ‰€å‘¨çŸ¥ï¼Œåœ¨JavaScriptä¸­éåŽ†æ•°ç»„ä¸­çš„æ¯ä¸€ä¸ªå…ƒç´ æ˜¯ä¸€ä»¶å¾ˆç®€å•çš„äº‹æƒ…ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡æœ€åŽŸå§‹çš„forã€whileå¾ªçŽ¯ï¼Œæˆ–ES6ä¸ºæˆ‘ä»¬æä¾›çš„for-ofä¹‹ç±»çš„ä¼—å¤šæ–¹æ³•æ¥å®žçŽ°ã€‚ä½†æ˜¯åœ¨å®žé™…ç¼–ç¨‹å·¥ä½œä¸­ï¼Œæˆ‘ä»¬é™¤äº†ä¼šä½¿ç”¨æ•°ç»„è¿™æ ·çš„æ•°æ®ç»“æž„ä¹‹å¤–ï¼Œè¿˜ä¼šå¤§é‡ä½¿ç”¨è‡ªå®šä¹‰æ•°æ®ç»“æž„ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¦‚ä½•åŽ»éåŽ†æˆ–è€…è¯´ä½¿è¿™äº›è‡ªå®šä¹‰æ•°æ®ç»“æž„èƒ½å¤Ÿè¢«å¾ªçŽ¯è¿­ä»£å‘¢ï¼Ÿå¯è¿­ä»£åè®®å…è®¸JavaScriptå¯¹è±¡å®šä¹‰æˆ–è‡ªå®šä¹‰å…¶è¿­ä»£è¡Œä¸ºï¼Œä¾‹å¦‚åœ¨for..ofæž„é€ ä¸­å¾ªçŽ¯çš„å€¼ï¼›ä¸ºäº†å®žçŽ°å¯è¿­ä»£æ€§ï¼Œå¯¹è±¡(æˆ–å…¶åŽŸåž‹ä¸Š)å¿…é¡»å®žçŽ°Symbol.iteratoræ–¹æ³•ï¼Œè¯¥æ–¹æ³•è¿”å›žä¸€ä¸ªå«åšè¿­ä»£å™¨çš„å¯¹è±¡ã€‚ å®žçŽ°123456789101112131415161718192021222324252627const iterable = &#123; [Symbol.iterator]()&#123; let step = 0; const iterator = &#123; next()&#123; if(step &lt; 3)&#123; step++; return (&#123; value: step, done: false, &#125;); &#125; return &#123; value: step, done: true, &#125; &#125; &#125;; return iterator; &#125;&#125;;const iterator = iterable[Symbol.iterator]();iterator.next() // &#123;value: 1, done: false&#125;iterator.next() // &#123;value: 2, done: false&#125;iterator.next() // &#123;value: 3, done: false&#125;iterator.next() // &#123;value: 3, done: true&#125; åº”ç”¨JavaScriptä¸­ä¸€äº›å†…ç½®æ•°æ®ç±»åž‹æ˜¯å…·æœ‰é»˜è®¤è¿­ä»£è¡Œä¸ºçš„å†…ç½®å¯è¿­ä»£ç±»åž‹ï¼Œä¾‹å¦‚Stringã€Arrayã€MapyåŠSetï¼Œå› ä¸ºå®ƒä»¬çš„åŽŸåž‹ä¸Šå®žçŽ°äº†[Symbol.iterator]æ–¹æ³•ã€‚å½“ç„¶è¿˜æœ‰å¾ˆå¤šåœ°æ–¹ä½¿ç”¨äº†å¯è¿­ä»£æ€§ï¼Œæœ‰çš„å¯èƒ½ä¸å¤ªæ˜Žæ˜¾ï¼Œæ¯”å¦‚ï¼š for-ofå¾ªçŽ¯ æ•°ç»„ç»“æž„ ES6æ‰©å±•è¿ç®—ç¬¦ Mapå’ŒSetçš„æž„é€ å‡½æ•°è¦æ±‚æ˜¯å¯è¿­ä»£å¯¹è±¡Iteratorï¼ˆè¿­ä»£å™¨ï¼‰å®šä¹‰MDNå®šä¹‰ï¼š è¿­ä»£å™¨ä»…ä»…æ˜¯å…·æœ‰ä¸ºè¿­ä»£è®¾è®¡çš„ç‰¹å®šæŽ¥å£çš„å¯¹è±¡ã€‚æ‰€æœ‰çš„è¿­ä»£å™¨å¯¹è±¡éƒ½æœ‰ä¸€ä¸ªâ€œnext()â€æ–¹æ³•,è¿™ä¸ªæ–¹æ³•è¿”å›žä¸€ä¸ªå«æœ‰valueå’Œdoneä¸¤ä¸ªå­—æ®µçš„å¯¹è±¡ï¼Œå…¶ä¸­valueå­—æ®µçš„å€¼å°±æ˜¯å½“å‰ä»Žæ•°æ®é›†åˆä¸­è¿­ä»£å‡ºçš„å€¼ï¼›è€Œdoneå­—æ®µçš„æ˜¯ä¸€ä¸ªå¸ƒå°”å€¼ï¼Œç”¨æ¥è¡¨ç¤ºè¿­ä»£æ˜¯å¦å·²ç»å®Œæˆã€‚è¿­ä»£å™¨ä¸€æ—¦è¢«åˆ›å»ºï¼Œ æˆ‘ä»¬å°±èƒ½é€šè¿‡é‡å¤è°ƒç”¨â€œnext()â€æ–¹æ³•æ¥è¿­ä»£å®ƒï¼Œåœ¨äº§ç”Ÿç»ˆæ­¢å€¼åŽç»§ç»­è°ƒç”¨next()æ–¹æ³•åº”è¯¥å§‹ç»ˆè¿”å›ž{done: true} æ¡ˆä¾‹123456789101112131415161718192021222324252627282930function makeRangeIterator&lt;T&gt;(dataCollection: Array&lt;T&gt;, start=0, step=1,end=Infinity,)&#123; const len = dataCollection.length; let nextIndex = start; let iterationValue: T; return &#123; next: function (param?: any): &#123;value: T, done: boolean&#125; &#123; if(nextIndex &lt; end &amp;&amp; nextIndex &lt; len)&#123; iterationValue = dataCollection[nextIndex]; nextIndex += step; return &#123; value: iterationValue, done: false, &#125; &#125; return &#123; value: iterationValue, done: true, &#125; &#125; &#125;&#125;var iterator = makeRangeIterator(["s",3,&#123;name: 'paopaolee'&#125;],0,1,3);console.log(JSON.stringify(iterator.next())); // &#123;"value":"s","done":false&#125;console.log(JSON.stringify(iterator.next()));// &#123;"value":3,"done":false&#125;console.log(JSON.stringify(iterator.next()));// &#123;"value":&#123;"name":"paopaolee"&#125;,"done":false&#125;console.log(JSON.stringify(iterator.next()));// &#123;"value":&#123;"name":"paopaolee"&#125;,"done":false&#125; ä¸‹é¢è¿™å¼ å›¾å¯ä»¥å¸®ç»„æˆ‘ä»¬å»ºç«‹å¯è¿­ä»£æ€§ã€è¿­ä»£å™¨ã€nextä¹‹é—´çš„å…³ç³»ï¼š Generatorï¼ˆç”Ÿæˆå™¨ï¼‰è™½ç„¶è‡ªå®šä¹‰è¿­ä»£å™¨æ˜¯ä¸€ä¸ªååˆ†æœ‰ç”¨çš„å·¥å…·ï¼Œä½†æ˜¯ä»Žä¸Šé¢ä»£ç å¯ä»¥çœ‹å‡ºç”±äºŽéœ€è¦åŽ»æ˜¾ç¤ºç»´æŠ¤å…¶å†…éƒ¨çŠ¶æ€ï¼Œæ‰€ä»¥åˆ›å»ºè¿­ä»£å™¨éœ€è¦è°¨æ…Žçš„ç¼–ç¨‹ã€‚ç”Ÿæˆå™¨æ˜¯ä¸€ä¸ªå¼ºæœ‰åŠ›çš„æ›¿ä»£å·¥å…·ï¼Œå®ƒä½¿å¾—æˆ‘ä»¬å¯ä»¥æ›´ç®€å•çš„åˆ›å»ºè¿­ä»£å™¨å¯¹è±¡ã€‚ å®šä¹‰MDNå®šä¹‰: ç”Ÿæˆå™¨æ˜¯ä¸€ä¸ªè¿”å›žè¿­ä»£å™¨çš„å‡½æ•°ï¼Œå®ƒå…è®¸é€šè¿‡ç¼–å†™ä¸€ä¸ªéžè¿žç»­æ‰§è¡Œçš„å‡½æ•°æ¥å®šä¹‰è¿­ä»£ç®—æ³•ã€‚å®ƒçš„çš„è¯­æ³•ä¸ºâ€œfunction* FuncName(){ }â€ã€‚é¦–æ¬¡è°ƒç”¨æ—¶ï¼Œç”Ÿæˆå™¨å‡½æ•°ä¸æ‰§è¡Œä»»ä½•ä»£ç ï¼Œè€Œæ˜¯è¿”å›žä¸€ç§ç§°ä¸ºGeneratorçš„è¿­ä»£å™¨ã€‚é€šè¿‡è°ƒç”¨ç”Ÿæˆå™¨çš„â€œnextâ€æ–¹æ³•æ¶ˆè€—å€¼æ—¶ï¼ŒGeneratorå‡½æ•°å°†æ‰§è¡Œï¼Œç›´åˆ°é‡åˆ°yieldå…³é”®å­—ã€‚ ç®€è€Œè¨€ä¹‹ï¼ŒJavaScriptä¸­ç”Ÿæˆå™¨æ˜¯ä¸€ä¸ªè¿”å›žå€¼ä¸ºè¿­ä»£å™¨çš„å‡½æ•°ï¼Œä¸Žæ™®é€šå‡½æ•°ä¸åŒçš„æ˜¯ï¼Œç”Ÿæˆå™¨å‡½æ•°åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­å¯ä»¥ä¸­æ–­å¹¶ä¸”èƒ½ä»Žä¸­æ–­çš„åœ°æ–¹ç»§ç»­æ‰§è¡Œã€‚ä¸‹é¢çš„è¿™å¼ å›¾å¯¹æ¯”äº†æ™®é€šå‡½æ•°ä¸Žç”Ÿæˆå™¨å‡½æ•°æ‰§è¡Œè¿‡ç¨‹ï¼š ä¸¾ä¾‹è¯´æ˜Ž123456789101112131415function* generatorFunction()&#123; // line 1 console.log('This will be executed first.') yield 'Hello,'; // line 2 console.log('Iwill be printed after the pause.'); yield 'World!'; &#125;const generatorObject = generatorFunction(); // line 3console.log(generatorObject.next().value); // line 4// This will be executed first.// Hello, console.log(generatorObject.next().value); // line 5// I will be printed after the pause// World!console.log(generatorObject.next().value); // line 6// undefined ä¸Šé¢ä»£ç ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨äº†function* çš„è¯­æ³•åˆ›å»ºäº†ä¸€ä¸ªç”Ÿæˆå™¨å‡½æ•°ï¼ˆline 1ï¼‰ï¼Œåœ¨å‡½æ•°å†…éƒ¨æˆ‘ä»¬ä½¿ç”¨äº†å¦ä¸€ä¸ªå…³é”®å­—yieldï¼ˆline 2ï¼‰ï¼Œå®ƒåªèƒ½åœ¨ç”Ÿæˆå™¨ä¸­ä½¿ç”¨ã€‚ç”Ÿæˆå™¨å‡½æ•°åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ä¸€æ—¦è¿è¡Œåˆ°yieldå…³é”®å­—æ—¶ï¼Œä¼šç«‹å³â€œè¿”å›žâ€å®šä¹‰åœ¨å®ƒåŽé¢çš„å€¼å¹¶ä¸­æ–­å‡½æ•°çš„æ‰§è¡Œï¼Œæ³¨æ„æ­¤å¤„çš„è¿”å›žè·Ÿæ™®é€šå‡½æ•°çš„returnä¸åŒï¼Œåœ¨ç”Ÿæˆå™¨ä¸Šä¸‹æ–‡ä¸­ï¼Œæˆ‘ä»¬å«ï¼ˆyieldï¼‰äº§å‡ºæŸå€¼ã€‚ 12345function * generatorFunc() &#123; yield 'a'; return 'b'; // Generator ends here. yield 'a'; // Will never be executed. &#125; åœ¨ï¼ˆline 3ï¼‰ä¸­æˆ‘ä»¬é€šè¿‡åˆ›å»ºäº†generatorObjectå¯¹è±¡ï¼Œè¿™çœ‹èµ·æ¥è²Œä¼¼ç”Ÿæˆå™¨å‡½æ•°â€œgeneratorFunctionâ€å†…éƒ¨çš„è¯­å¥åº”è¯¥å·²ç»æ‰§è¡Œï¼Œä½†æ˜¯ç¥žå¥‡çš„æ˜¯ç¬¬ä¸€å¥console.logä¸ºå•¥å¹¶æ²¡æœ‰æ‰“å°è¾“å‡ºå‘¢ï¼ŸåŽŸæ¥æ˜¯ï¼Œå½“ç”Ÿæˆå™¨å‡½æ•°æ‰§è¡Œæ—¶æ€»æ˜¯ç®€å•çš„è¿”å›žä¸€ä¸ªè¿­ä»£å™¨å¯¹è±¡ï¼Œç„¶åŽé€šè¿‡è°ƒç”¨è¿™ä¸ªè¿­ä»£å™¨å¯¹è±¡çš„nextæ–¹æ³•ï¼Œç”Ÿæˆå™¨å‡½æ•°å†…éƒ¨è¯­å¥æ‰ä¼šå¼€å§‹æ‰§è¡Œï¼› æ‰€ä»¥ï¼ˆline 3 ä¸­ï¼‰generatorObjectå°±æ˜¯ä¸€ä¸ªè¿­ä»£å™¨å¯¹è±¡ï¼Œç„¶åŽæˆ‘ä»¬é€šè¿‡è°ƒç”¨å®ƒçš„nextæ–¹æ³•ï¼ˆline 4ï¼‰,è¿™æ—¶ç”Ÿæˆå™¨â€œgeneratorFunctionâ€æ‰å¼€å§‹çœŸæ­£æ‰§è¡Œï¼Œæ‰“å°å‡ºâ€This will be executed first.â€œï¼›æŽ¥ç€æ‰§è¡Œä¸‹ä¸€è¡Œä»£ç ï¼ˆline 2ï¼‰ï¼Œè¿™æ—¶é‡åˆ°äº†yieldå…³é”®å€¼ï¼Œå°†å…¶åŽå®šä¹‰çš„â€˜Helloâ€™å­—ç¬¦ä¸²ä½œä¸ºå€¼ï¼Œäº§å‡ºâ€œ{value: â€˜Helloâ€™, done: false}â€å¯¹è±¡,åŒæ—¶ä¼šè¢«æš‚æ—¶ä¸­æ–­æŒ‚èµ·ï¼Œç›´åˆ°è¿­ä»£å™¨å†æ¬¡è°ƒç”¨nextæ–¹æ³•ï¼› åœ¨line 5ä¸­ï¼Œæˆ‘ä»¬å†æ¬¡è°ƒç”¨äº†nextï¼Œè¿™æ—¶ç”Ÿæˆå™¨å‡½æ•°è¢«å”¤é†’å¹¶ä»Žä¸Šä¸€æ¬¡æŒ‚èµ·çš„åœ°æ–¹ç»§ç»­å¼€å§‹æ‰§è¡Œï¼Œæ‰€ä»¥æ‰“å°å‡ºâ€I will be printed after the pauseâ€œï¼ŒæŽ¥ç€åˆé‡åˆ°äº†yieldå…³é”®å­—ï¼Œäº§å‡ºâ€{value: â€˜Worldï¼â€™, done: false}â€åŽå†æ¬¡æŒ‚èµ·ï¼› åœ¨line 5ä¸­ï¼Œæˆ‘ä»¬åˆå†ä¸€æ¬¡è°ƒç”¨äº†nextï¼Œè¿™æ¬¡ç”Ÿæˆå™¨å‡½æ•°è¢«å”¤é†’åŽå‘çŽ°æ²¡æœ‰è¯­å¥å¯ä»¥æ‰§è¡Œäº†ï¼Œè®°ä½å¦‚æžœå‡½æ•°æ²¡æœ‰returnè¯­å¥ï¼Œé»˜è®¤è¿”å›žundefined,å› æ­¤ç”Ÿæˆå™¨å‡½æ•°ä¼šäº§å‡ºâ€{value: undefined, done: true}â€,å±žæ€§å€¼doneè¢«è®¾ç½®ä¸ºtrueï¼Œè¿™å°±æ„å‘³ç€ç”Ÿæˆå™¨å‡½æ•°æ‰§è¡Œç»“æŸäº†ã€‚ åº”ç”¨åœºæ™¯ä¸€ . å®žçŽ°å¯è¿­ä»£å‰é¢æœ‰æåˆ°è¦å®žçŽ°å¯è¿­ä»£æ€§ï¼Œå¯¹è±¡(æˆ–å…¶åŽŸåž‹ä¸Š)å¿…é¡»å®žçŽ°[Symbol.iterator]æ–¹æ³•æ¥è¿”å›žä¸€ä¸ªæˆ‘ä»¬è‡ªå·±ç¼–å†™çš„è¿­ä»£å™¨ï¼Œè¿™ä½¿å¾—å®žçŽ°è¿‡äºŽå¤æ‚ï¼Œè€Œç”Ÿæˆå™¨å‡½æ•°å¯ä»¥ä½¿æˆ‘ä»¬æ›´ç®€å•çš„åˆ›å»ºè¿­ä»£å™¨å¯¹è±¡ã€‚æŽ¥ä¸‹æ¥æˆ‘ä»¬åˆ†åˆ«ä½¿ç”¨è‡ªå®šä¹‰è¿­ä»£å™¨å’Œç”Ÿæˆå™¨æ¥å®žçŽ°å¯è¿­ä»£è¡Œå¯¹è±¡ã€‚è‡ªå®šä¹‰è¿­ä»£å™¨ï¼š 12345678910111213141516171819const iterableObj = &#123; [Symbol.iterator]: () =&gt; &#123; let step = 0; return &#123; next: () =&gt; &#123; step++; if (step === 1) &#123; return &#123; value: 'This', done: false&#125;; &#125; else if (step === 2) &#123; return &#123; value: 'is', done: false&#125;; &#125; else if (step === 3) &#123; return &#123; value: 'iterable.', done: false&#125;; &#125; return &#123; value: '', done: true &#125;; &#125; &#125;; &#125;&#125;;[...iterableObj] // ["This", "is", "iterable."] ç”Ÿæˆå™¨ 1234567function * generatorFunc() &#123; yield 'This'; yield 'is'; yield 'iterable.'&#125;const iterableObj = generatorFunc();[...iterableObj] // ["This", "is", "iterable."] ä½ å¯ä»¥æ¯”è¾ƒä¸¤ä¸ªç‰ˆæœ¬ï¼Œå®ƒå¯ä»¥è¯´æ˜Žç”Ÿæˆå™¨å¸¦æ¥çš„è¯¸å¤šå¥½å¤„ï¼š æˆ‘ä»¬ä¸éœ€è¦å…³å¿ƒSymbol.iterator æˆ‘ä»¬ä¸å†å¿…é¡»å®žçŽ°nextæ–¹æ³• æˆ‘ä»¬ä¸å†å…³å¿ƒå¿…é¡»åƒåœ¨nextæ–¹æ³•ä¸­è¿”å›ž{value: â€˜Thisâ€™, done: false}è¿™æ ·çš„å¯¹è±¡ç»“æž„ æˆ‘ä»¬ä¸ç”¨åŽ»ç»´æŠ¤è¿­ä»£å™¨å†…éƒ¨çš„çŠ¶æ€ äºŒ. å¼‚æ­¥ä»»åŠ¡å¤„ç†ç”Ÿæˆå™¨æœ€è®©äººå…´å¥‹çš„åœ°æ–¹ä¸Žå¼‚æ­¥ç¼–ç¨‹ç›¸å…³ã€‚ JavaScriptä¸­çš„å¼‚æ­¥ç¼–ç¨‹æ˜¯ä¸€æŠŠåŒåˆƒå‰‘ï¼šç®€å•çš„å¼‚æ­¥ä»»åŠ¡å¾ˆå®¹æ˜“å®Œæˆï¼Œè€Œå¤æ‚çš„å¼‚æ­¥ä»»åŠ¡æˆä¸ºä»£ç ç»„ç»‡çš„ä¸€ä¸ªè‹¦å·®äº‹ã€‚ç„¶è€Œç”Ÿæˆå™¨å…è®¸æ‚¨åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­æœ‰æ•ˆåœ°æš‚åœä»£ç ï¼Œå› æ­¤å®ƒä»¬å¼€è¾Ÿäº†è®¸å¤šä¸Žå¼‚æ­¥å¤„ç†ç›¸å…³çš„å¯èƒ½æ€§ã€‚ è§£å†³å¼‚æ­¥ä»»åŠ¡çš„ä¼ ç»Ÿæ–¹æ³•æ˜¯å›žè°ƒå‡½æ•°ï¼Œè¿™ç§æ–¹æ³•èƒ½å¤Ÿå¾ˆå¥½åœ°è§£å†³ç®€å•çš„ä¸šåŠ¡ï¼Œä½†æ˜¯ä¸€æ—¦ä¸šåŠ¡è¿‡äºŽå¤æ‚ï¼Œè¿™ç§æ–¹æ³•å¾€å¾€ä½¿å¾—åµŒå¥—å¤šå±‚ä»£ç é€ æˆå›žè°ƒåœ°ç‹±ã€‚å¾—ç›ŠäºŽyieldå…³é”®å­—å¯ä»¥ä¸­æ–­æŒ‚èµ·å‡½æ•°ç›´åˆ°nextæ–¹æ³•çš„è°ƒç”¨ï¼Œæˆ‘ä»¬å¯ä»¥ä¸éœ€è¦ç®¡ç†å›žè°ƒå‡½æ•°å°±èƒ½å®žçŽ°å¼‚æ­¥ç¼–ç¨‹ã€‚ é«˜çº§è¿­ä»£å™¨åŠŸèƒ½ä¼ é€’å‚æ•°åˆ°è¿­ä»£å™¨åœ¨ä¸Šè¿°è¿­ä»£å™¨çš„æ¡ˆä¾‹ä»£ç ä¸­å¯ä»¥å‘çŽ°ï¼Œè¿­ä»£å™¨çš„nextæ–¹æ³•å…¶å®žå¯ä»¥æŽ¥å—å‚æ•°ã€‚åœ¨ç”Ÿæˆå™¨å‡½æ•°ä¸­ï¼Œå°†å‚æ•°ä¼ é€’ç»™nextï¼ˆï¼‰æ–¹æ³•æ—¶ï¼Œè¯¥å‚æ•°å°†æˆä¸ºç”Ÿæˆå™¨å†…yieldè¯­å¥çš„å€¼ã€‚æ­¤åŠŸèƒ½å¯¹äºŽæ›´é«˜çº§çš„åŠŸèƒ½ï¼ˆå¦‚å¼‚æ­¥ç¼–ç¨‹ï¼‰éžå¸¸é‡è¦ã€‚è¿™æ˜¯ä¸€ä¸ªåŸºæœ¬çš„ä¾‹å­ï¼š 123456789101112131415function * createIterator()&#123; let first = yield 1; // line 1 let seccond = yield first + 2; // line 2 yield second + 3; // line 3&#125;const iterator = createIterator();console.log(iterator.next()); // line 4// "&#123; value: 1, done: false &#125;"console.log(iterator.next(4)); // line 5// "&#123; value: 6, done: false &#125;"console.log(iterator.next(5)); // line 6 // "&#123; value: 8, done: false &#125;"console.log(iterator.next()); // "&#123; value: undefined, done: true &#125;" ä¸Šé¢ä»£ç ä¸­ï¼Œæˆ‘ä»¬åœ¨ç¬¬ä¸€æ¬¡è°ƒç”¨nextæ–¹æ³•æ—¶ï¼ˆline 4ï¼‰ï¼Œç”Ÿæˆå™¨å‡½æ•°å†…éƒ¨å¼€å§‹æ‰§è¡Œï¼ˆline 1ï¼‰ï¼Œæ‰§è¡Œè¿‡ç¨‹ä¸­ç”±äºŽèµ‹å€¼è¯­å¥æ˜¯ä»Žå³å¾€å·¦æ‰§è¡Œçš„ï¼Œä¸€å¼€å§‹å°±é‡åˆ°yieldå…³é”®å€¼ï¼Œäº§å‡ºâ€{value: 1, done: flase}â€,ç„¶åŽä¸­æ­¢æŒ‚èµ·å‡½æ•°ç­‰å¾…ä¸‹ä¸€æ¬¡nextæ–¹æ³•è°ƒç”¨ï¼Œæ³¨æ„æ­¤æ—¶å˜é‡firstè¿˜æ²¡æœ‰è¢«èµ‹å€¼ï¼›å½“æˆ‘ä»¬å†æ¬¡è°ƒç”¨ï¼ˆline 5ï¼‰nextæ–¹æ³•ï¼ˆå€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œæ­¤æ¬¡è°ƒç”¨nextæ–¹æ³•æ—¶è¿˜ä¼ å…¥äº†å‚æ•°4ï¼‰ï¼Œå‡½æ•°ä»Žä¸Šä¸€æ¬¡ä¸­æ­¢çš„åœ°æ–¹ï¼ˆline 1 è¡¨è¾¾å¼å³è¾¹ï¼‰è¢«å”¤é†’ç»§ç»­æ‰§è¡Œï¼Œæ­¤æ—¶å‚æ•°4ä¼šè¢«å½“ä½œyieldè¯­å¥çš„æ‰§è¡Œç»“æžœèµ‹å€¼ç»™å˜é‡firstï¼ŒæŽ¥ç€æ‰§è¡Œä¸‹ä¸€è¡Œï¼ˆline 2ï¼‰ç›´åˆ°é‡åˆ°yieldï¼Œäº§å‡ºâ€{value: 6(4+2), done: false}â€ç„¶åŽä¸­æ­¢ï¼›ç»§ç»­æˆ‘ä»¬ç¬¬ä¸‰æ¬¡è°ƒç”¨nextï¼ˆline 6ï¼‰ï¼Œè¿™æ¬¡yieldæŽ¥å—å‚æ•°5èµ‹ç»™å˜é‡secondï¼Œäº§å‡ºâ€{value: 8(5+3), done: false}â€åŽå†æ¬¡ä¸­æ–­æŒ‚èµ·ï¼›æœ€åŽä¸€æ¬¡è°ƒç”¨nextï¼Œå‡½æ•°è¢«å”¤é†’åŽå‘çŽ°æ²¡æœ‰è¯­å¥å¯ä»¥æ‰§è¡Œï¼Œä¸”å‡½æ•°æ²¡æœ‰returnè¯­å¥ï¼ˆå³é»˜è®¤è¿”å›žundefinedï¼‰ï¼Œæ‰€ä»¥é»˜è®¤è¿”å›žâ€{value: undefined, done: true}â€; æ³¨æ„ï¼Œé¦–æ¬¡è°ƒç”¨nextæ–¹æ³•ä¼ å…¥çš„å‚æ•°æ˜¯æ— æ•ˆçš„ï¼Œä¼šè¢«å‡½æ•°å®Œå…¨å¿½ç•¥æŽ‰ã€‚å³ä¸Šé¢(line 4)ä»£ç ä¸­çš„nextå‡½æ•°ä¸­ä¼ å…¥ä»»ä½•å‚æ•°éƒ½æ˜¯æ— æ•ˆçš„ã€‚ åœ¨ç”Ÿæˆå™¨ä¸­æŠ›å‡ºå’Œæ•èŽ·é”™è¯¯æˆ‘ä»¬é€šè¿‡è¿­ä»£å™¨çš„nextæ–¹æ³•ä¸ä»…èƒ½ä¼ é€’æ•°æ®ï¼Œè€Œä¸”è¿˜èƒ½ä¼ é€’Errorä¿¡æ¯ã€‚è¿­ä»£å™¨å¯ä»¥é€‰æ‹©å®žçŽ°ä¸€ä¸ªthrowï¼ˆï¼‰æ–¹æ³•ï¼Œè¯¥æ–¹æ³•æŒ‡ç¤ºè¿­ä»£å™¨åœ¨æ¢å¤æ—¶æŠ›å‡ºé”™è¯¯ã€‚ function * createIterator(){ let first = yield 1; // line 1 let seccondï¼› try{ second = yield first + 2; }catch(error){ second = 6; } yield second + 3; // line 3 } let iterator = createIterator(); console.log(iterator.next()); // "{ value: 1, done: false }" console.log(iterator.next(4)); // "{ value: 6, done: false }" console.log(iterator.throw(new Error("Boom"))); // "{ value: 9, done: false }" console.log(iterator.next()); // "{ value: undefined, done: true åœ¨ç”Ÿæˆå™¨å‡½æ•°ä¸­ä½¿ç”¨returnè¯­å¥æˆ‘ä»¬è¯´è¿‡ç”Ÿæˆå™¨å°±æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œæˆ‘ä»¬å¯ä»¥åƒæ™®é€šå‡½æ•°é‚£æ ·åœ¨ç”Ÿæˆå™¨ä¸­ä½¿ç”¨returnè¯­å¥ï¼Œå®ƒé»˜è®¤ä¼šå°†è¿”å›žå€¼ä¸­çš„doneå±žæ€§è®¾ç½®ä¸ºtrueï¼Œä¹Ÿå°±æ„å‘³ç€ä½ å¯ä»¥é€šè¿‡ä½¿ç”¨returnè¯­å¥æå‰é€€å‡ºå‡½æ•°æˆ–ä¸ºå®šä¹‰æœ€åŽä¸€æ¬¡è°ƒç”¨nextæ–¹æ³•çš„äº§å‡ºå€¼ã€‚ function * createIterator(){ let first = yield 1; // line 1 let seccond = yield first + 2; // line 2 return 1000; yield second + 3; // line 3 } ä¸Šé¢ä»£ç ä¸­ï¼Œç¬¬ä¸‰æ¬¡è°ƒç”¨nextæ–¹æ³•åŽï¼Œäº§å‡ºå€¼ä¸ºâ€{value: 1000, done: true}â€,å¹¶ä¸”å‡½æ•°ä¼šé€€å‡ºã€‚ ç‰¹æ®Šåœ°ï¼ŒES6ä¸­çš„æ‰©å±•è¿ç®—ç¬¦å’Œfor-ofæ“ä½œç¬¦ä¼šå¿½ç•¥æŽ‰ä»»ä½•returnè¯­å¥å®šä¹‰çš„å€¼ã€‚å› ä¸ºå®ƒä»¬é¦–å…ˆæ£€æŸ¥å¯¹è±¡ä¸­çš„doneå±žæ€§æ˜¯å¦ä¸ºtrueï¼Œä¸€æ—¦doneä¸ºtrueä¾¿ä¸ä¼šåœ¨è¯»å–valueå±žæ€§ã€‚]]></content>
      <categories>
        <category>Web</category>
      </categories>
      <tags>
        <tag>JavaScript</tag>
        <tag>ES6</tag>
      </tags>
  </entry>
</search>
